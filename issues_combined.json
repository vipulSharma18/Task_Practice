{"3395": "With rucio.rse.protocols.posix.Default implementation the replicas with file schema always have port  in them eg  file  tmp testfile Override  in the posix protocol. I will submit a pull request for this shortly. ", "3388": "Chained subscription use case for Belle II RAW data produce at   subscription exports the RAW to one DATADISK at site A  subscription exports the RAW from DATADISK at site A to DATATAPE at the same site ", "3383": "Currently Rucio WebUI does not offer a user the possibility to choose how they authenticate before authorized to use the WebUI. The WebUI authentication method has to be pre defined in the rucio.cfg file. changes in code under rucio lib rucio web ui ", "3377": "The current ways of specifying a client config file are not very flexible and don t make it easy to use two different rucio systems from the same machine. Use an environment variable like RUCIO CFG to specify a config file and add a command line option like c CONFFILE . ", "3365": "rucio get metadata  K  llhoft     leads to the following rucio list file replicas  K  llhoft   SCOPE NAME FILESIZE  RSE REPLICA  K  llhoft    MB   . Because there are no letters the client interprets the string as a number in scientific notation next to last character is an e . ", "3360": "Upgrade of dependencies. pip requires client setuptools   change to setuptools    only  compatible argcomplete   change to argcomplete   requests   change to requests      change to    dogpile.cache   comment that  is only     change to    six   change to six      change to    pip requires SQLAlchemy  change to SQLAlchemy  alembic  change to alembic  jsonschema  change to jsonschema  python dateutil  change to python dateutil  stomp.py  change to stomp.py    change to   redis  change to redis  numpy  change to numpy   only   did not work. Using  again since numpy is not that critical paramiko  change to paramiko  ", "3350": "Move the config.yml file from its current place at . lib rucio transfertool to . etc where the other Rucio configuration files are stored. Modify the code and documentation that references the location of config.yml . lib rucio transfertool globusLibrary.py . doc source configure globus transfertool.rst ", "3347": "The setup.py for the main Rucio package is not Python  compatible. Fix compatibility Add  Test for server to travis ", "3346": "Allow client to query globus storage via rse protocol wrapper Adding list and exists methods to GlobusRSEProtocol ", "3340": "This should not be done in reverse but in a normal sort. Remove reverse True ", "3311": "The reaper seems to skip the deletion of the collection replica when the last replica of a dataset is deleted on a RSE ", "3283": "The configuration set method doesn t work properly if . is provided as a value rucio admin config set section automatix option separator value . But when trying to retrieve it Wed Feb      info pid  tid  client   mod wsgi pid  process application rucio server int  config Loading WSGI script usr lib  site packages rucio web rest config.py . Wed Feb      error pid  tid  NoneType object has no attribute lower Wed Feb      error pid  tid  type exceptions.AttributeError Wed Feb      error pid  tid  Traceback most recent call last Wed Feb      error pid  tid  File usr lib  site packages rucio web rest common.py line  in decorated Wed Feb      error pid  tid  return f args kwargs Wed Feb      error pid  tid  File usr lib  site packages rucio web rest common.py line  in decorated Wed Feb      error pid  tid  return f args kwargs Wed Feb      error pid  tid  File usr lib  site packages rucio web rest config.py line  in GET Wed Feb      error pid  tid  for item in config.items section issuer ctx.env.get issuer Wed Feb      error pid  tid  File usr lib  site packages rucio api config.py line  in items Wed Feb      error pid  tid  return config.items section Wed Feb      error pid  tid  File usr lib  site packages retrying.py line  in wrapped f Wed Feb      error pid  tid  return Retrying dargs dkw .call f args kw Wed Feb      error pid  tid  File usr lib  site packages retrying.py line  in call Wed Feb      error pid  tid  return attempt.get self. wrap exception Wed Feb      error pid  tid  File usr lib  site packages retrying.py line  in get Wed Feb      error pid  tid  six.reraise self.value  self.value  self.value  Wed Feb      error pid  tid  File usr lib  site packages retrying.py line  in call Wed Feb      error pid  tid  attempt Attempt fn args kwargs attempt number False Wed Feb      error pid  tid  File usr lib  site packages rucio db sqla session.py line  in new funct Wed Feb      error pid  tid  return function args kwargs Wed Feb      error pid  tid  File usr lib  site packages rucio core config.py line  in items Wed Feb      error pid  tid  return item  convert type item  for item in items Wed Feb      error pid  tid  File usr lib  site packages rucio core config.py line  in convert type Wed Feb      error pid  tid  if value.lower in true yes on Wed Feb      error pid  tid  AttributeError NoneType object has no attribute lower The value is converted to None. The value is set properly if one use directly the set value in core. Problem probably at the REST level ", "3261": "The resolve query takes a lot of time in cases where the RSE is not connected. Need to introduce thresholds to speed up the query. ", "3260": "It s impossible to figure out if rucio clients are hanging due to external libraries e.g. libgfal.so . Make the client forcefully kill  itself upon repeated presses of CTRL C. ", "3254": "This needs to be changed in various parts of the code from third party copy to use third party copy read and third party copy write . In a later feature release the third party copy column can then be removed. ", "3250": "Following an example of download add tests of upload to the list of tests add site name to the test rses important for client location and lan wan decissions almost copy paste download it is already using upload functionality enhance that for several test settings fake file fake site corrupted file etc. ensure that it is running under both travis docker and dev docker env. ", "3249": "In order to avoid an upload with .rucio.upload tmp name extension we need to be able to set it in protocol extended attributes at rse level. It is not causing direct issue now since  sets renaming attr. by default but this is bit implicit. Once somebody changes this all switch impl. to gfal.py uploads to rses where overwrite is not allowed will fail. if extended attributes in protocol attr self.renaming protocol attr extended atributes .get renaming False ", "3235": "I would like to make the following suggestions  Use the synchronous API in case the number of files is below some thresholds. We had a case where a request to mark a large amount of files as temporarily unavailable was causing long delays for single file requests which should have had higher priority.  Change the message to something other than replicas successfully declared . This is misleading as the PFNs could be invalid and the user will move on thinking that everything is done.  Do some checking on the PFNs at the very least that they are valid URLs. It should be noted that on the side of Minos this isn\u2019t handled gracefully. Traceback most recent call last File usr lib  site packages rucio daemons badreplicas minos.py li ne  in minos dict rse rse id .extend tmp dict rse rse id File usr lib  site packages retrying.py line  in wrapped f return Retrying dargs dkw .call f args kw File usr lib  site packages retrying.py line  in call return attempt.get self. wrap exception File usr lib  site packages retrying.py line  in get six.reraise self.value  self.value  self.value  File usr lib  site packages retrying.py line  in call attempt Attempt fn args kwargs attempt number False File usr lib  site packages rucio db sqla session.py line  in new funct return function args kwargs File usr lib  site packages rucio core replica.py line  in ge t pfn to rse split se surl.split  .split ", "3200": "I have set myself  quota on type DATADISK but the CLI cannot show it. rucio list account usage dcameron RSE USAGE LIMIT QUOTA LEFT CERN PROD SCRATCHDISK  kB  TB  TB NDGF  DATADISK  MB  MB  MB NO NORGRID  LOCALGROUPDISK  MB  TB  TB SE SNIC  LUND LOCALGROUPDISK  kB  B  B        ERROR Access to the requested resource denied. Details Account dcameron can not list global account usage. ", "3199": "Running as an unprivileged user it is expected that this fails but the exception should not be an internal server error c.set global account limit dcameron type DATADISK  Traceback most recent call last File stdin line  in module File home dcameron dev ddm rucio lib rucio client accountlimitclient.py line  in set global account limit raise exc cls exc msg rucio.common.exception.RucioException An unknown exception occurred. Details no error information passed status code  internal server error server error o    The exception should be the same as I see when setting local account limits c.set local account limit dcameron NDGF  DATADISK  Traceback most recent call last File stdin line  in module File home dcameron dev ddm rucio lib rucio client accountlimitclient.py line  in set local account limit raise exc cls exc msg rucio.common.exception.AccessDenied Access to the requested resource denied. Details Account dcameron can not set account limits. ", "3164": "The Bring online parameter is the timeout for the FTS polling to check that the file is online. The current default value defined in Rucio is   h. At the last data carousel exercice many transfers reached this timeout and the corresponding FTS requests failed error message in Rucio Stage was cancelled . Such staging request are then rescheduled on the same site participating to the long tail effect. Based on the values in FTS about the max staging request pers site e.g.  requests the avg file size  GB and the observed throughput e.g. from  MB s to  s the timeout value of  hours is too small and lead to some unnecessary overheads and scheduling operations. I would suggest either to Increase the bring online timeout to reflect the storage tape performance wrt the number of queued staging request or set to the rule lifetime with some potential renormalisation or set it to a bigger constant value for all staging requests. ", "3148": " decommission mode not fully correctly working  DB access vs. dumps  configuration several things hardcoded at the time being  logging needs to be correctly implemented  oop  evolved into quite complex tool. We might start to think about upgrading it. add  Difficult issue see some limiting factors here ", "3147": " we are maintaing two independent codes at the moment clients and rsemgr. The aim is to have as much as possible at single place clients.  the rsemgr evolved organically cleanup is needed.  preparation for new features like bulk mode  moving upload functionality to clients  several small updates  commissioning and testing in parallel with the old rsemgr checking if functionality is conserved. ", "3135": "rucio list rules history cms ttZJets  madgraphMLM     asymptotic   NANOAODSIM             ERROR expected string or buffer Martin Barisits   AM I think this is due to missing quote plus on Maybe you can try to do this similar to quote plus around scope and name ", "3124": "Currently the monitor module only supports statsd but the CERN Kubernetes clusters come with a Prometheus server that can also be used for auto scaling. Make the monitor module configurable to either report to statd or to prometheus. ", "3115": "The  decoder requires width padded strings i.e. some strings need extra padding elements in the string. Some keygens don t add them. Properly handle this corner case. ", "3103": "Decommissioning of sites with problems take too much human intervention. Automation is needed to cover the corner cases around  of rules fail not because the site to be decommissioned but for other factors . New daemon service that keep track of the rules and transfers exiting the site to be decommissioned. ", "3101": "As of today one can pass a reference to a list where the traces from Rucio can be uploaded. If the other party already provided some traces we have no way to update them so far they would need to update the traces according to the information we provided. There is an option for trace pattern that can be used for traces that Rucio is producing but thah seems to be an option only for a single trace. This is matter of discussion. Either the other party provides list of references that they created and Rucio just updates them or Rucio send a traces and the other party merges them with the parts of traces coming from Rucio. ", "3097": "Quite often people ask DDM support what happened to my dataset? for datasets that have been deleted. It would be good to be able to query the metadata of these datasets eg time it was deleted. Add an option to the CLI like deleted to query the deleted DIDs table. ", "3096": "Currently there are several interfaces to address metadata in Rucio. This should be unified into one interface which intelligently selects which backend to use. Currently Hardcoded columns or JSON columns In the future this enables us to extend Rucio to external metadata catalogs which are accessed via the unified frontend. ", "3084": "Some usless duplicate functionality. Rather keeping in the Client. Keeping basic functinalities but  removing the file loop  duplicate check for existence of a file  renaming we can do better duplicate code  adding proper exceptions  input validation ", "3076": "Error is thrown when fts hosts is empty string. The fts attribute is empty for Globus transfers resulting in an error. I made  changes to fix here but cannot sure if they re ideal for FTS transfers. ", "3042": "Currently DESY ZN DATADISK is blacklisted for deleting but the Dark Reaper does not take that information into account.         WARNING Dark Reaper   Deletion NOACCESS of         as davs lcg   pnfs ifh.de data atlas atlasdatadisk rucio           on DESY ZN DATADISK The requested service is not available at the moment. Mimic the behaviour of the regular Reaper. ", "3031": "rucio download is not able to download files if the scope or name contains ", "3023": "Transfers with the source files on tape are done in several steps by FTS The staging and then the transfers to the final destinations. Now only the later it is reported in Rucio. It might be be good to add the beginning and end of the staging as reported by FTS in order to do further analysis e.g. staged at staging at. Both values are reported as staging finished and staging start by FTS when querying the file transfer statuses. ", "2983": " is still the default version on many distributions so we cannot force upgrade to  Make it compatible with both version. ", "2973": "The implementation here can be simplified This should not be done until GFAL  reaches EPEL. Do not make a separate call to GFAL to create the destination path. Use the create parent transfer parameter instead. ", "2961": "From Rod See This file     CosmicCalo.merge.RAW.  SFO ALL.  has  tape replicas plus in an archive on tape and disk. rucio list file replicas shows only the replica from the staged zip file on  CC DATADISK not the archive on  CC DATATAPE and not the  constituent replicas on tape. The see the latter again no resolve archives The python client shows all  replicas. I don t think it will break prod just confusing. I had another example with no replicas before adding no resolve archives   Background.merge.RAW.  SFO   Cheers Rod. ", "2926": "rucio upload rse  scope mock file mock ds rucio upload rse  scope mock  mock ds rucio download mock ds mock  The replica of mock  seems to be added to list replicas twice. ", "2915": "Traceback Thu Sep      error pid  tid  client   Traceback most recent call last Thu Sep      error pid  tid  client   File usr lib  site packages web application.py line  in process Thu Sep      error pid  tid  client   return self.handle Thu Sep      error pid  tid  client   File usr lib  site packages web application.py line  in handle Thu Sep      error pid  tid  client   return self. delegate fn self.fvars args Thu Sep      error pid  tid  client   File usr lib  site packages web application.py line  in delegate Thu Sep      error pid  tid  client   return handle class cls Thu Sep      error pid  tid  client   File usr lib  site packages web application.py line  in handle class Thu Sep      error pid  tid  client   return tocall args Thu Sep      error pid  tid  client   File usr lib  site packages rucio web rest account.py line  in POST Thu Sep      error pid  tid  client   raise Duplicate error.args  Thu Sep      error pid  tid  client   File usr lib  site packages rucio common utils.py line  in Thu Sep      error pid  tid  client   if len str exc msg  Thu Sep      error pid  tid  client   UnicodeEncodeError ascii codec can t encode character u xed in position  ordinal not in range  Thu Sep      error pid  tid  client   ", "2881": "After recreating an Identity using the following steps the RUCIO allows the token creation using Creating the test identity fernando rucio admin identity add account carlos type USERPASS id fernando email cgamboa bnl.gov password secret Added new identity to account fernando carlos Listing identities for account carlos root  rucio rucio admin account list identities carlos Identity fernando type USERPASS Deleting the Identity recently created root  rucio rucio admin identity delete account carlos type USERPASS id fernando Deleted identity fernando Creating same Identity with a different password rucio admin identity add account carlos type USERPASS id fernando email cgamboa bnl.gov password othersecret I can still connect using the old password the one set when the identity was created. Token is created for the this password. The token is not created for the identity that was deleted and then reused recreated with a different password. We are using RUCIO  ", "2830": "", "2827": "psycopg throws new kinds of exceptions when running on  ", "2770": "All three methods below should work equivalently root  rucio rucio S userpass u asdf pwd zxcv whoami cannot get auth token        ERROR Cannot authenticate. Details userpass authentication failed root  rucio RUCIO ACCOUNT mario rucio S userpass u asdf pwd zxcv whoami cannot get auth token        ERROR Cannot authenticate. Details userpass authentication failed root  rucio rucio account mario S userpass u asdf pwd zxcv whoami status ACTIVE account mario account type USER created at      updated at      suspended at None deleted at None email None ", "2714": "Some function based indexes are missing in models.py. For example the index for REPLICAS STATE IDX is missing while it is defined in the schema.sql for oracle. For other indices this exists. e.g. REPLICAS TOMBSTONE IDX is available although it is function based.  Need to check which function based indices are missing in the models.py  They need at least to be added non function based to the models.py  Investigate if it is possible to add function based indices with SQLAlchemy if yes all of them need to be re written. ", "2706": "To help tape systems with colocation we will pass two metadata hints per file storage class classname as a single value and group hints mostimportant . leastimportant as an ordered list of string values. ", "2703": "Would be great to support text file upload or command line method to submit exceptions for the lifetime model. Currently it requires user to pick up samples one by one with wildcard but still not that convenient which is low efficient and very easily to introduce mistakes there. ", "2686": "One cannot see the parameters used in the POST PUT requests making it very difficult for debugging ", "2639": "Creation date of rule in the future injector will only inject it then. ", "2637": "A way to track visualise what happened to a did. Check historic information Transfers etc. ", "2636": "As discussed at the Community workshop. We want to establish some kind of repository for operator documentation recipes which allows convenient ways of contribution Wiki or similar ", "2635": "Overview ticket for Multi VO development. ", "2634": "I have noticed that in several places on CERN intranet and presentations slides there is a link to Rucio HOWTO page which does not exist anymore. If the page has been moved or replaced it would be nice to have a redirect to a new location. Also the output from rucio list file replicas help shows a link to that page is not there too. ", "2631": "Documentation page listing all possible config table and RSE attribute functional parameters. ", "2630": " Need to specify a policy about which information goes where.  Needs to be enforced an current inconsistencies need to be removed.  We need to write down in a concise documentation page what are the optional configuration parameters for both .cfg and config table Also need a page for functional RSE attributes ", "2621": "Most likely because activity shares is missing here ", "2613": "From Rod Hi I was recently introduced to where I can manually declare suspicious files bad which is required for last replicas. It is nice but I have a couple of feature requests.  select all button and ideally select range with shift key. prodtask dev can do this.  link to dashbd transfer errors for each file example below.  a filed with the last data.reason text from the dashbd Cheers Rod. ", "2582": "ericvaandering I am using the CMS rucio dev instance. I have a couple of test RSEs which are not controlled by any centralised scripts. The only changes to these RSEs should be manual changes. However the distance ranking values between my RSEs and others seem to be lost in between sessions. I cannot view them using get distance or add a rule making a file transfer between them until I have used update distance to redefine the values. rucio admin rse get distance  FR  Disk Test  CH CERN EOS Test d format a number is required not NoneType This means the parameter you passed has a wrong type. Nevertheless the distance ranking is still set in some form as I cannot use add distance . rucio admin rse add distance distance  ranking   FR  Disk Test  CH CERN EOS Test An object with the same identifier already exists. Details Distance from  to  already exists! This means that you are trying to add something that already exists. Within the same session these values seem to persist but next time they need redefining again. ", "2543": "Upgrade version of pyflakes  pycodestyle and pylint ", "2542": "There are multiple throttler tickets for different use cases FIFO x throttle per activity source RSE  x throttle per activity destination RSE throttle per activity destination and source RSE  x throttle per all activities destination RSE  x throttle per all activities source RSE  throttle per all activities source and destination RSE  Grouped FIFO x throttle per all activities destination RSE  x throttle per all activities source RSE  throttle per all activities destination and source RSE  ", "2517": "The list replica command when no replicas are there matching the requirements returns a generator with  element which is an empty string list rcli.list replicas name ST t channel top  InclusiveDecays  PSweights  powheg      realistic   AODSIM      scope cms rse expression  FR GRIF IRFU u I may be wrong but I think it used to return an empty generator in previous versions current  return an empty list ", "2459": "Given that a Rucio dataset corresponds to a CMS block it would be extremely helpful if the rucio clients list dataset replicas API would accept a list of dataset names such that we can fetch all CMS block replicas that belong to a CMS dataset in a single call thus having a better performance at multiple layers . For the record I ve placed the same issue under the CMSRucio project FYI ericvaandering Support a list of datasets in the list dataset replicas API from the rucio clients package. ", "2417": "The query to get suspicious files is not optimal. Sometimes Oracle switch from Nested Loop to Hash Join that can result to a huge slowing down of the query. Use the following query WITH bad repl AS SELECT scope name rse id COUNT FROM atlas rucio.bad replicas WHERE created at created at  GROUP BY scope name rse id HAVING COUNT count  SELECT cardinality bad repl  INDEX replicas replicas pk atlas rucio.replicas.scope AS atlas rucio replicas sco  atlas rucio.replicas.name AS atlas rucio replicas nam  atlas rucio.replicas.rse id AS atlas rucio replicas rse  MIN atlas rucio.replicas.created at AS min  FROM atlas rucio.replicas bad repl WHERE atlas rucio.replicas.scope bad repl.scope AND atlas rucio.replicas.name bad repl.name AND atlas rucio.replicas.rse id bad repl.rse id GROUP BY atlas rucio.replicas.scope atlas rucio.replicas.name atlas rucio.replicas.rse id ", "2414": "The current configuration template for atlas at etc rucio.cfg.atlas.client.template doesn t work out of the box. A working template client section only client rucio host auth host ca cert client cert  USER PROXY client key  USER PROXY client  proxy  USER PROXY request retries  auth type  It would also be good to explain the configuration in the docs I couldn t find anything about it there. ", "2410": "Right now Rucio only supports  and  checksums via two specific columns for these checksums. This creates problems if a community has different checksums e.g. CMS historically used crc checksums and wants to store them. On the dev meeting on it was discussed to extend Rucio with a generic checksum column of string type. Multiple checksums can be added comma separated to this column always specifying the checksum type. E.g.     crc  We would have to specify a strategy in migrating to this new checksum column. ", "2393": "It might be desirable to recreate the original dataset from the zip files or at least amusing in a low priority kind of way. All the metadata for constituent files and dataset exists. rucio client pulls the zip file unpacks verifies and then stores the constituent replicas. It would take the constituent dataset as the argument and cycle over the zip files so as to not use too much disk space. It should be recursive so only recovering the files without a replica. To do this at scale would need some prodsys development but I am not sure we will ever need that. Some way to do it manually might come in handy though. Cheers Rod ", "2387": "The tests right now the database testing workflow foresee the following  Setup database with current models.py  Do full downgrade all revisions with alembic  Do full upgrade all revisions with alembic  Run the actual test cases Now the fact that the tests run through point to the fact that the database is actually equal to the one defined in the current models.py . However it is not guaranteed. What we would need is an extra step which compares the database schema before and after. How this actual check works is a bit difficult though. It could be a table describe for each table and then just compare strings but this would require the order of constraints indices etc. to be kept the same. ", "2356": "We sometimes have problem with sites running dual stack   storage. Sometimes the  interface is broken whereas the  works. One would need a switch e.g. RSE attribute to force the use of  ", "2330": "Default alembic.ini location should not be main rucio directory but should point to etc alembic.ini like the rest of the configuration. Remove tox everything is properly covered by Travis Some hosts are pointing to cern.ch servers in the default template replace with fake hostnames Remove useless scripts from tools e.g. sweep srm conftest ", "2325": "The current main page of the WebUI is a generic one. It would be useful to have a main page that shows the most interesting informations for the end user. Non exhaustive list Table with available space and quotas and or bar chart showing the available space by RSE List of replicating stuck rules List of requests for exceptions to the lifetime model ", "2318": "DPA needs a too to get the history of bad files ", "2312": "This is an overview ticket for the Rucio redirector. Need to assess the status of the service Need to expand tests to ensure usability ", "2311": "At the moment we only have very limited upload download tests either using mock calls or direct posix protocols. One possibility to expand these to actualy functional tests would be to use xrootd docker containers and start up two xrootd storages in the test environment. This would allow us to test upload download also with different protocols such as gfal which would also help enormously to validate gfal for python  ", "2310": "Some users provided feedback to improve the suspicious files view in the WebUI If the RSE pattern is not OK do not run the loop forever. Instead break with clear pattern that RSE expression is wrong I have declared some files as bad. After Could you put a flag to declare that the file was declared lost. ", "2282": "The log files that have been declared suspicious a lot of times can be safely declared BAD . For now this is done as a probe but eventually it must be done by a dedicated daemon that apply different policies based on the project datatype nb replicas. ", "2264": "The demo image contains reference to service hosted at CERN. Need to be removed ", "2263": "Currently the Auditor expects to be able to list directory entries in order to identify the latest dump. This is not possible on object storages. Investigate and implement an alternative such as  Try the last n days based on the pattern  Use another file as an index  Use a static location and obtain the date from its metadata ", "2258": "Since the merge of  rucio list rse attributes crashes for staging endpoints   twegner  rucio version rucio    twegner  rucio v list rse attributes TAIWAN  TAPE STAGING        DEBUG Traceback most recent call last File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  bin rucio line  in new funct return function args kwargs File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  bin rucio line  in list rse attributes print tabulate.tabulate table tablefmt plain File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  lib  site packages tabulate.py line  in tabulate for c ct fl fmt miss v in zip cols coltypes float formats missing vals File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  lib  site packages tabulate.py line  in format return format float val floatfmt ValueError invalid literal for float True        ERROR invalid literal for float True        ERROR Strange error No section policy ", "2254": "We tried to switch implementation for xrootd protocol at ral echo scratchdisk and it didn t work from obvious reasons.  and not startswith root needs to be added to line  stat method returning checksum needs to be implemented mlassnig  xrdfs root eosatlas.cern.ch  query checksum eos atlas atlasdatadisk rucio         ", "2232": "Whenever a lock is being repaired this lock repair cnt is incremented by  As a second condition Next to the  week timeout the repairer can then also SUSPEND rules based on the lock repair cnt . ", "2218": "This would be a possibility to test new releases without having to deploy them on CVMFS. ", "2216": "from rucio.daemons.auditor import process output process output \u2026 Traceback most recent call last File stdin line  in module File usr lib  site packages rucio daemons auditor init .py line  in process output lost pfns r rses rse  for r in list replicas lost replicas File usr lib  site packages rucio db sqla session.py line  in new funct raise DatabaseException str error DatabaseException Database exception. Details cx Oracle.DatabaseError ORA  internal error code arguments   SQL u SELECT INDEX DIDS DIDS PK atlas rucio.dids.scope AS atlas rucio dids scope \u2026 Note that this is not an ordinary case. The file used in this example has about  lost files. Originally I was chunking on the Auditor\u2019s side but I was recommended against that. ", "2213": "When the last replica of a file is removed in the reaper it should only be removed from the dataset if it is not a constituent of an existing archive replica. This also implies if a archive replica is removed and there are no replicas on the constituents the constituents need to be removed from their parent datasets. ", "2159": "Currently it is not clear why a certain request is REPLICATING but did not issue a FTS transfer yet. We should expose that a request is in WATING or even MISMATCH state. What would also be good to maybe show the queue length although this might be more difficult as it is depending on throttle configuration. ", "2143": "Zenodo is a research data repository especially nice for linking publications to the datasets they used. Investigating integration interfacing with Zenodo might be useful. ", "2104": "There are double counts in the lost files reports when the same lost file is in many datasets. easy ", "2063": "There are currently  history tables which are defined by using the SQLA model base Versioned . The advantage of this is that the history table does not have to be created by hand but it is just mirrored by the primary base. However by doing this we loose full control about the indices and primary keys of the history table as it is also just mirrored from the primary model. This already creates inconsistencies as the history tables we define on oracle do not have indices and primary keys. Two possibilities Find a way to adapt indices PKs for versioned tables AFAIK not possible Do not use Versioned at all and define the history tables explicitly This is already done for some tables anyway. ", "2029": "Assuming that the DID exists this command returns a broken XML where the closing tag is missing. It is caused by using a RSE expression that returns no RSEs shell ReplicaClient .list replicas name file LMXZHCXRHS scope  hip rse expression test True metalink True ?xml version  encoding UTF  ? n metalink xmlns urn ietf params xml ns metalink n ", "1923": "Wrong title in lifetime exception should be fixed Need a button to bulk update the WAITING requests ", "1911": "Even on a bad installation or typos in the configuration system rucio help ought to work. The current version of rucio imports the DownloadClient at the module level. If there is an error in the rucio.cfg that causes the DownloadClient constructor to throw an exception you can t get to help . Example rucio help Traceback most recent call last File home  bbockelm software rucio doma bin rucio line  in module from rucio.client.downloadclient import DownloadClient File home  bbockelm projects rucio lib rucio client downloadclient.py line  in module client Client stack trace goes on for miles File home  bbockelm software rucio doma lib  site packages requests adapters.py line  in send self.cert verify conn request.url verify cert File home  bbockelm software rucio doma lib  site packages requests adapters.py line  in cert verify invalid path  .format cert loc IOError Could not find a suitable TLS CA certificate bundle invalid path etc ca.crt In my case the problem was caused by an invalid path in rucio.cfg for the CA bundle. Failures to create the clients should be swallowed until they are actually used. Potentially we shouldn t even import the clients until needed. ", "1895": "This is needed to let the development of user data transfers code separated from the RUCIO one. Talking in particular of using importlib using configuration param for the following methods user to DN mapping myproxy interactions I would go with importing just the methods since the case of mapping a user to a DN and then retrieving the corresponding proxy may have a more general use. In any case a feedback on this is very welcome. ", "1867": "The calculation does not take into account the replicas that are already available on the destination. Use rucio.core.replica.list replicas . The operation can be expensive but since it\u2019s not done frequently it should be fine. ", "1860": "For rules on containers when datasets are detached from the container the respective DATASET LOCK does not seem to be removed properly. There were some cases found where this was the case. Needs to be investigated and fixed. TBD ", "1839": "It\u2019s difficult memorising command line options when they are named differently across commands. delete rule uses rse expression list file replicas has both rse and expression with different meaning get has rse but it actually takes an RSE expression. First it has to be decided whether it\u2019s worth breaking the current CLI interface to fix this. ", "1834": "The tracer server accepts any kind of json send to it and expects clients to send the information using the correct schema. Sometimes a bug in a client can lead to an invalid trace that then can break any of the systems using the traces monitoring Kronos etc. Add a validator that listens on the ActiveMQ topic and constantly checks that necessary fields are set correctly or set at all. If something doesn t match the schema send out notifications. ", "1830": "Separate logfile for dataset and file thread. ", "1829": "A run once unittest by mocking pre filling an activeMQ queue to consume from. ", "1817": "The Flask API has problems with dealing exceptions when using JSON streaming. This should be fixed as it is essential for handling lot of data. See for implementing JSON streaming to change the Flask API. Investigate how to deal with exceptions. ", "1808": "The LIGO and Virgo communities are stepping into Rucio to manage ste storage elements of their infrastructures. While LIGO is provided of proprietary HPC clusters Virgo isn t and instead relies on a set of academic computing centers. The characteristics of the latter as well as some previous choices strongly point to a wide adoption of DIRAC in Virgo while the interoperability with LIGO requires Rucio as storage manager orchestrator. After some discussion we maybe found a nice solution. Instead of developing a DIRAC plugin able to interface it to Rucio in a POSIX like manner we think the best option is to create a DIRAC mode for the Rucio catalog. This argument follows a comment of many people DIRAC was born to create a uniform interface to different GRID implementations but ended up managing both Computing Elements CE and Storage Elements SE . This choice was taken to make DIRAC aware of the geographical data position in order to minimize the data transfers. Since DIRAC is used by a rather small community not a lot of organizations might be interested in stepping in the development of an integration. Instead Rucio is much more appealing and finding a way to keep in the Rucio s external catalog enough topological information to make DIRAC happy and efficient might be the way. In addition we discovered that DIRAC allows to pass it a custom catalog and some Virgo people has already performed some tests in that sense creating an LFC catalog dump and running a DIRAC instance on that data. In fact such solution might scale up to decoupling the DIRAC storage function from the computing function giving lots of benefits even to the DIRAC product. This could bring in some of their developers to assist in the process. Worth mentioning that DIRAC jobs can be any kind of executable from an sh script to an executable available cluster s wide e.g. firefox . Since the read from Rucio managed files should be supported OOTB by DIRAC the need of a plugin is needed only to register on Rucio the output files of the jobs. However since DIRAC can run basic scripts at first the registration of output files on Rucio might be handled by by hand calls to the Rucio API from within the DIRAC job. If we think about a C compiled executable which produces a myfile.root file running on a shell myexe myfile.root . Wrapping the same in something like myexe myfile.root rucio API call myfile.root should do the basic tricks. ", "1806": "The default transfer submission flow is based on the assumption that the proxy has already been delegated by an external script. For user transfers an integrated delegation is already in like And a standalone method in the transfertool is already available A similar solution can be implemented also for the default submission avoiding to keep a cron script doing the delegation externally. This new behavior must be optional and available through a configuration parameter.  steps needed here align the fts transfertool code to use python bindings. Followed on  check for response equivalence w.r.t. REST response mock  may be needed for a proper testing do FTS job submission with the integrated delegation check available by a configuration parameter ", "1801": "The defaults we have for a couple of options could be different between VOs e.g. rucio list dids filter type ALL . Investigate VO specific defaults for the clients. ", "1797": "Concern by CMS that data which is only on the tape buffer may not be migrated to tape before additional disk copies are deleted which could result in the loss of data. Undetermined but as I understand it Add a new optional state Waiting for tape check FTS transfers to tape systems are put in this state when the transfer finishes A new daemon checks the state with the storage system moves state to the one which can be picked up by the finisher ", "1773": "For some use cases the default of exracting metadata for specific file extensions is undesired. E.g. to use rucio upload with ROOT files within an standalone container image that does not have the software of a specific experiment installed. partly discussed here allow to add configuration optiosn in the cfg file that list the file extensions for which metadata extraction should be performed. the defaults would stay as it is extract GUID for root files but it could be switched off ", "1771": "Sorting of column of type datetime is broken datatable. The sorting is done alphabetically and not based on the date ", "1760": "during last days always when  statrted to rebalanced othe activities were completely suppressed  lower the share rebalancing is of  highest priority now  distribute the rebalancing over a day. Use case for delayed rule. ", "1759": "I ve recently started seeing various mysql exceptions. First listing file replicas in a dataset gives a database exception message in the client ligo rucio \u279c rucio list file replicas  L  R         ERROR Database exception. Details mysql exceptions.ProgrammingError  Commands out of sync you can t run this command now SQL u SELECT rses.id AS rses id rses.rse AS rses rse rses.rse type AS rses rse type rses. deterministic AS rses deterministic rses.volatile AS rses volatile rses.staging area AS rses staging area rses.city AS rses city rses.region code AS rses region code rses.country name AS rses country name rses.continent AS rses continent rses.time zone AS rses time zone rses. ISP AS rses ISP rses. ASN AS rses ASN rses.longitude AS rses longitude rses.latitude AS rses latitude rses.availability AS rses availability rses.updated at AS rses updated at rses.created at AS rses created at rses.deleted AS rses deleted rses.deleted at AS rses deleted at nFROM rses nWHERE rses.deleted false AND rses.rse s parameters LIGO WA Background on this error at Next the judge cleaner log shows the following message several times a second         DEBUG rule cleaner   index query time  fetch size is          INFO rule cleaner   Deleting rule  with expression UNL         DEBUG Deleting lock  H  R   for rule  Exception mysql exceptions.InterfaceError  in bound method SSCursor. del of MySQLdb.cursors.SSCursor object at  ignored raised as a result of Query invoked autoflush consider using a session.no autoflush block if this flush is occurring prematurely mysql exceptions.ProgrammingError  Commands out of sync you can t run this command now SQL u DELETE FROM locks WHERE locks.scope s AND locks.name s AND locks.rule id s AND locks.rse id s parameters  H  R   xeb      xcd     NI t xdc           Background on this error at         ERROR Traceback most recent call last File usr lib  site packages rucio daemons judge cleaner.py line  in rule cleaner delete rule rule id rule id nowait True File usr lib  site packages rucio db sqla session.py line  in new funct raise DatabaseException str error DatabaseException Database exception. Details raised as a result of Query invoked autoflush consider using a session.no autoflush block if this flush is occurring prematurely mysql exceptions.ProgrammingError  Commands out of sync you can t run this command now SQL u DELETE FROM locks WHERE locks.scope s AND locks.name s AND locks.rule id s AND locks.rse id s parameters  H  R   xeb      xcd     NI t xdc           Background on this error at Finally the reaper log shows the following message which may or may not be related         INFO Reaper   Running on RSE LIGO CIT ARCHIVE None         DEBUG Reaper   list unlocked replicas on LIGO CIT ARCHIVE for None bytes in  seconds  replicas         CRITICAL Traceback most recent call last File usr lib  site packages rucio daemons reaper reaper.py line  in reaper prot rsemgr.create protocol rse info delete scheme scheme File usr lib  site packages rucio rse rsemanager.py line  in create protocol protocol attr select protocol rse settings operation scheme domain File usr lib  site packages rucio rse rsemanager.py line  in select protocol candidates get possible protocols rse settings operation scheme domain File usr lib  site packages rucio rse rsemanager.py line  in get possible protocols found s. str rse settings RSEProtocolNotSupported RSE does not support requested protocol. Details No protocol for provided settings found third party copy protocol  rse type DISK domain lan wan availability delete True delete protocol  rse u LIGO CIT ARCHIVE deterministic True write protocol  read protocol  staging area False  algorithm ligo availability write True volatile False availability read True credentials None verify checksum True id  protocols extended attributes None hostname u ldas  prefix u hdfs frames domains wan read  write  third party copy  delete  lan read  write  delete  scheme u gsiftp port  impl u  . Note that these errors only seem to be affecting deletion of rules and replicas actual transfer operations appear to be unaffected. ", "1752": "While working with Rucio data records I found that their structure is not static in terms of data attributes. By that I mean that returned dictionary contains dynamic set of keys plus it mixed pre defined attributes names with attribute values. To demonstrate this I ll take one particular record from replicas API e.g. curl H Accept application json H X Rucio Auth Token token This API returns the following records states  US Nebraska AVAILABLE pfns   name store data  Charmonium MINIAOD         rses  US Nebraska scope cms bytes   null states  US Nebraska AVAILABLE pfns   name store data  Charmonium MINIAOD         rses scope cms bytes   null These records contain static attribute names such as states  scope etc. and within states part of the records they contain dynamic keys in this case both records return  US Nebraska but in general it would be name of the rse. As you can see the record keys attributes will be different in different type of queries since you used rse values as record key attribute of states data structure. This is represent certain problem to treat these records in generic way e.g. I can t map a record into static data structure since records keys will be dynamic. Instead rucio should return static data strictures all the times. For instance the states sub structure may be represented as following states rse  US Nebraska state AVAILABLE or to be generic for multiple rses as states rse  US Nebraska state AVAILABLE rse  XXX state STATE OF RSE In this case the states has static data structure where all keys attributes are well defined i.e. in this example there are two keys rse and state and such structures will remain static for infinitive number of RSE STATE values. I wonder how many APIs inherit this behavior and how hard easy will be to fix them. I also need to know how many of such dynamic structures exists in Rucio APIs output. Another issue with such dynamic data structures affects long term analytics if we plan to do it where records keys will grow over time and will not represent finite set of attributes. For the record this issue is very critical for CMS Data Aggregation System which will consume this data and need to aggregate it with rest of CMS data service records. In order to do aggregation several issues should be solve including this particular one. I m CCing ericvaandering Eric to follow up this issue. Eric Rucio falls into the same trap as many other CMS data services by using key attribute values as keys of the underlying python dict keys. This represent issue with developing generic parser of Rucio records. ", "1746": "I m struggle to understand the difference between these two API calls replicas scope name replicas scope name datasets In both cases the output seems identical while the API description is different. The former list all replicas for data identifier while the later is list dataset replicas. What s the difference? Here is my calls to CMS rucio server this API replicas cms Charmonium    MINIAOD      returns states  US Nebraska AVAILABLE pfns   name store data  Charmonium MINIAOD         rses scope cms bytes   null this API replicas cms Charmonium    MINIAOD      datasets returns states  US Nebraska AVAILABLE pfns   name store data  Charmonium MINIAOD         rses scope cms bytes   null in both cases we have  returned documents. Also I want to get replicas only for a given name and RSE pair and so far I can t find API I need. The only way to do this is to get list of all replicas for a given name and filter the RSE I m interested in. Would it be more efficient to pass RSE as a parameter to replicas API to fetch only subset of them on that given RSE? For example replicas scope name rse ", "1667": "With a volatile RSE that is outside of Rucio s control it can happen that the whole cache is wiped or publishing breaks or for some other reason the files are deleted without the ability to tell Rucio what has been deleted. This means that replicas will stay forever in the catalog. In this case it would be good to tell Rucio to wipe all replicas from the RSE then the site can start the publishing from scratch. Of course this is rather dangerous so care should be taken to restrict this operation to volatile RSEs admin accounts etc. ", "1648": "The probe doesn t set properly the RSE TYPE need first to implement  . Moreover it should set a default distance for all the new RSEs. ", "1636": "Email discussion with ATLAS  btw the double slash is always necessary for root. it works for add replica so there must be something different in the method add files to dataset On      PM Tomas Javurek wrote Trying to register with add add files to dataset that Luc is using RSE does not support requested protocol. while when I set the protocol it works fine. So we need to keep it there for now. However please keep it with srm for now because it did work for me only with srm when I tried with root protocol it failed with the same error. And I tried both root  freiburg.de  pnfs bfg.uni freiburg.de data atlasdatadisk rucio user ddmadmin \u2018 root  freiburg.de  pnfs bfg.uni freiburg.de data atlasdatadisk rucio user ddmadmin On  Sep  at   Tomas Javurek Tomas.Javurek cern.ch mailto Tomas.Javurek cern.ch wrote I couldn\u2019t find the place where we subtract the protocol part from path when registering to replicas. But I\u2019ll try brute force. Just preparing a script that would imitate Lucs needs and see whether I can register without protocol part. ", "1583": "Request from dCache via Paul Millar. Use case is for Atlas to pass the dataset of a file to dCache which would enable optimisations colocation on a small set of tapes and bulk operations bringonline dataset amongst other possibilities. Associated FTS ticket ", "1558": "To protect from deletions for files which might still be in the processing in other daemons. ", "1504": "Contention between the undertaker and the conveyor can occur in case the undertaker tries to delete some files that are being transfered in particular if the transfers have been submitted to a slow responding FTS server. Indeed the undertaker locks the corresponding rows in replicas and requests table before sending the cancel request to FTS. The cancel request did must propagate a timeout to FTS right now there is none. In addition I would propose to add a new state for the request BeingDeleted similar to the one we have for the replica. Doing that way the conveyor would not try to update the requests that are being deleted by the undertaker . ", "1431": "When deleting the last replica of a file reaper deletes the file logically as well but does not delete the contents in the archive contents table. This causes a foreign key constraint error and the reaper gets stuck. There are three changes needed in total for this. x  When deleting the file logically the rows from the archive contents table need to be deleted too The just deleted archive content rows have to be added to the archive contents history table For the files whose archive just got deleted it needs to be checked if they do not have any other replicas in which case they need to be removed logically If there are no rules on them which is actually a bit pointless  When the last replica of a file is removed in the reaper it should only be removed from the dataset if it is not a constituent of an existing archive replica. This also implies if a archive replica is removed and there are no replicas on the constituents the constituents need to be removed from their parent datasets. ", "1393": "Trailing in Rucio are not part of the DID name however the historic ATLAS naming did include them such as      DYmumu       For most commands REST endpoints including the DID are used where this trailing resulted in a in the URL. This is interpreted as one in and thus the command did still deliver a result. However since the  clients both scope and name get escaped using urllib.quote plus . This way the name gets transformed in e.g.    DYmumu        and the lookup fails. Possible solutions  Use urllib.quote plus s to declare as a safe character. This should work but for commands which do not use the did in the REST call the trailing of a container was and will still be a problem. E.g. list dids with a filter attach dids container to container detach dids container from container etc. This also fails for communites using in their naming scheme  Filter trailing completely in the client. Might be problematic for communities  Ask external applications to filter trailing on their side. ", "1382": "The Replicas controller creates the metalink output differently than the ListReplicas controller. ", "1351": "the rucio rucio atlas docker images are excellent to do basic get put operations within a minimal environment. However uploading ROOT files fails because the pool extractFileIdentifier is not found. I m cross referencing an issue on the ATLAS JIRA were I asked whether we can provide a statically linked version of it If we can get a statically linked binary presumably one could just add it to the image. ", "1304": "If the UploadClient is used to upload a new replica of a file DID no dataset given that is already registered no rule will be updated or added. ", "1248": "At the moment it tries to insert replicas to RSEs but has PK failures due to the already existing replicas in state BEING DELETED. ", "1245": "when I declare bad a huge amount of files for example when a machine cannot be recovered it takes several hours and it is not possible to understand at what stage the declaration is. On occasion not all the files get declared as it has happened with Glasgow. Files were declared lost in December but some of them were still there yesterday and deletion failed and I had to reduclare lost   files. It would be useful if this tool left wrote a log file with the number of files declared if the admin wants to or wrote to the output as part of the verbose when it does a commit. So if it declares lost  files at the time it writes it has done those and if something fails it logs that too. So that it is possible to rerun only on the missing files instead of going through the whole lot. A summary at the end would also be useful. For example as I imagine yesterday went from the output  processed  uknown replicas  already declared  declared bad ", "1213": "The recovery doesn t take into account the replicas on sites blacklisted for read. If a file is declared bad and is not recoverable because the only remaining site where it is located is blacklisted for read the necromancer should declare the file as recoverable and not as definitely lost. ", "1202": "Currently it is possible to directly download single files from RSEs using the webui if the RSE is webdav enabled. Furthermore the webui can also create metalink files for datasets. This metalink file can then be used in a download manager to download the full dataset. But the problem is that there are no extensions that are able to handle the certificate authentication. So the browser will ask the user every time to provide a valid certificate. Development of a browser extension that is able to handle the metalink files from rucio and the necessary authentication to the storage elements using a certificate installed in the browser. ", "1157": "Avoid errors when alembic version is not set in the DB Make sure that the server code can understand the DB schema. At start up the RESTful API checks whether the alembic version is in a whitelist or whether the code version is supported. ", "1152": "It looks like when the server times out no exception is raised to the client Raise a new TimeOut exception ", "1114": "In case of open containers the length and events is not recorded as metadata yet but could be recursively calculated from the constituent datasets or even files . The idea is to add a recursive option to rucio get metadata . ", "1109": "The error message shown to unregistered users in the webui always points to ATLAS voms. Make the message configurable. ", "1091": "Archive missing features tracker In this ticket we are tracking discussing the features missing from the Rucio archive support. x Download full archive and extract a single file  x xrdcp transfer a single file part of a zip file  x Transparent list replicas support of zip contents  x Forward of rule creation from constituent to archive  x list dataset replicas should resolve archives as well  x extract flag needs to be added to metalink  x Bug with checksums on xrdcp streamed replicas needs to be fixed  x Checksum checking needs to be enabled again due to fix in  x Forward of constituent rule to archive in case of tape replica  x Client needs to extract files from archive  x Revert xrdcp workaround  Handling archives in the reaper  Handling of lost files in the necromancer Should not be removed if there is a zip replica Full transparent handling of constituents in the judge rules x list replicas should re order zips and prioritise root protocol over everything else  The advantage of the transparent support of replica listing of content archives with the format root supports would be that there is little to do in the actual rucio client as there is no protocol difference between downloading a normal file or a file in a zip file. Other discussions ", "1026": "It would be good to have the tests running against the flask backend in travis with the mode allow failures to expose the errors. With python  it can be even better but would require to have fixed the syntax first. ", "1021": "Install rucio with setup.py pip pip install . oracle postgresql mysql kerberos dev Instead of manual copying and linking. ", "857": "There are some  specific parts in the conveyor mostly job dictionary building and processing of activemq message results which needs to be disentangled from the code and moved to the tranfertool. ", "781": "Right now the status of a replication rule only provides a single high level error summary. For example rucio rule info examine  Status of the replication rule TRANSFER FAILED TRANSFER  TRANSFER CHECKSUM MISMATCH USER DEFINE and SRC checksums are different.  !  STUCK Requests cms store mc  Neutrino E  gun GEN SIM DIGI RAW  correctPU   realistic         RSE  US NERSC REAL Attempts  Last Retry       Last error FAILED Last source  US Nebraska REAL Available sources  US Nebraska REAL Blacklisted sources cms store mc  Neutrino E  gun GEN SIM DIGI RAW  correctPU   realistic       ADDB  RSE  US NERSC REAL Attempts  Last Retry       Last error FAILED Last source  US Nebraska REAL Available sources  US Nebraska REAL Blacklisted sources this particular case goes on for another  files or so However it s not practical to debug this rule because I have no clue what error corresponds to which file. s Two suggestions  In the output of rucio rule info examine . record the last error message per stuck file.  Also record the last FTS job ID where the file failed will probably also need the FTS server URL . ", "736": "Add doc how to configure Rucio rses accounts etc ", "713": "When sorting the rules in  by creation date the result is wrong. Currently this is done using a simple string sorting which is wrong. Change the sorting to correctly sort the dates chronologically. ", "704": "The conveyor receiver incorrectly handles multi source jobs. This is the case for jobs where the first source FAILS and the second one is a success. The poller requests jobs via the transfer tool which does quite a bit of response formatting and checking. In the case of multi source jobs it basically iterates the sources and if one of the sources is in state FTSState.FINISHED it returns the job as SUCCESS. The receiver however does not go via the transfertool as it gets the response directly from activemq. In the case of a job where the first source fails but the second one is a succes the receiver only looks at the t final transfer state which is FTSCompleteState.ERROR. However what it actually should do is to iterate the sources like the conveyor poller. It seems that the t final transfer state field can only be used for bulk transfers not multi source transfers. Factorize the formatting used in the transfer tool and re apply to conveyor receiver code. ", "689": "Bulk updates of Conveyor poller receiver bulk request update Conveyor finisher bulk update requests replicas locks and rules ", "630": "Introduce a backward compatible directory struture to have severl REST backends webpy flask pyramide django lib rucio web rest webpy  init .py lib rucio web rest flask  init .py ", "609": "The SciTokens project aims to build a federated ecosystem for authorization on distributed scientific computing infrastructures. Rucio should be made a full fledged SciTokens issuer to make it easy to integrate with SciTokens enabled storage and SciTokens enabled transfer systems. Since Rucio already supports token based authentication issuing SciTokens would not be too difficult. Expected behavior Clients should be able to ask Rucio for a SciToken next to the X Rucio Auth Token. ", "595": "Currently the web UI needs access to the DB connection to not crash. This may be simply a problem of side effects of importing modules Expected behavior Stand alone web UI with a minimal rucio config and config should be possible. ", "583": "If a user specifies only files in the list of DIDs field  will still create a container and will try to put the files in the container. Check the type of DIDs and create a container of dataset accordingly. ", "536": "For example when decomissioning a site the RSE is already blacklisted so all the rules could be re evaluated . ", "534": "Docstrings and Copyright. ", "528": "If a RSE performs badly on deletion exclude it temporarily to not impact the general deletion rate. ", "527": "Change  algorithm to use distance metrics. ", "526": "Study showed that data is replicated mostly to sites without the necessary computing resources to run jobs there. Rewrite algorithm to also take into account computing resources ", "485": "It seems like things are wrong but in the opposite direction. root  rucio add dataset user.ewv  Added user.ewv  root  rucio list dids user.ewv SCOPE NAME DID TYPE user.ewv  DATASET I m using the latest master for the client and whatever is installed at U Chicago. Expected behavior should not be prepended to the dataset name in this case. ", "479": "One identity can map to multiple accounts. Therefore banning just one account is not enough. Identities that correspond to people banned in voms must be removed. Migrated from ", "461": "I spotted three things wrong with the  transfer tool The  transfer tool code disables TLS verification everywhere. See as an example. The  transfer tool creates a new session TCP connection SSL for every operation and utilizes no session caching. It doesn t seem to actually create any delegation which is necessary for using the JSON interface directly. We absolutely should not disable TLS verification. That should be improved ASAP. The transfer tool should additionally cache reuse keep alive SSL sessions in order to efficiently interact with FTS. Finally the delegation should be done to avoid a cronjob that must be run by the sysadmin. ", "421": "As GSI is starting the long road of phasing out there s increased interest in widening work around capability based authorization for transfers. Capabilities are authorization mechanisms that describe what the bearer is allowed to do rather than who it is . The most common implementation of capabilities is a HTTP bearer token. A token is added to the Authorization header of a HTTP request and the contents of this token prove that the requester is authorized. Done via curl it might look something like this curl H Authorization Bearer        For the WLCG I m aware of three different models around capabilities being investigated  VO issued bearer tokens The VO creates a token authorizing the bearer to perform a certain operation at a site storage service. The storage service verifies the token was signed by the VO and honors the token within the VO s storage area allowing CMS to issue authorizations for CMS data but not ATLAS data . How the VO determines the authorizations and how the VO user retrieves the token is still a bit implementation defined. The token itself is formatted as a JWT the SciTokens implementation of this scheme additionally uses the scp scope claim to specify the authorizations. The WLCG Authorization Task Force is working on an agreed upon profile. Here Rucio would issue a fine grained token signed with Rucio s public key and return the token to the client. The storage services would be configured to trust Rucio as an issuer for a certain area using a standardized REST API to download the set of public keys that the issuer has blessed .  Storage issued bearer tokens A client authenticates with a storage requesting token to access a particular resource. The storage creates the token and returns it to the client. The client can then hand the token to any third party the third party can only perform the specific operation listed in the token. The example implementation here is dCache issued macaroons one would authenticate with dCache via GSI request a macaroon via a dCache specific but relatively generic REST API and hand the returned token to a third party. Here Rucio would retrieve the macaroons from dCache and return it to the client.  Signed URLs AWS allows object owners to pre sign a URL to have a specific authorization. Anyone with possession of the URL would automatically get authorized by the storage service. Note that this is somewhat problematic as URLs are typically treated as public within the WLCG for example  monitoring allows any user to view anyone else s transfer URLs. In the other two schemes the resource being accessed and the capability authorizing the access are managed separately. Rucio would create the pre signed URL with its credentials and return this to the client. In all three cases the user interacts with the storage utilizing non GSI and interaction with Rucio can be done via any of the Rucio supported methods. This is a significant piece of work and ties into lots of external activity WLCG Authorization Task Force and development cycles of various storage projects . It s not a one pull request and done in fact it s likely a bit of a moving target token formats may change over the next  months . However I think there s some commonalities between the approaches that allow us to lay the groundwork  Token approaches are done per RSE protocol. That is each RSE will have a particular style of capabilities they support that can be done as an attribute. This suggests we should reserve an attribute name token type ? unfortunately as we want to support non WLCG storage it is unlikely we ll ever converge to a single token type.  Server side handlers for rucio upload and rucio download should get access to the token type and be able to invoke plugins for each type that issue the corresponding capabilities.  Client code for rucio upload and rucio download should be able to handle both a returned URL and a bearer token in the server response using the bearer token as appropriate.  For VO issued bearer tokens it would make the most sense to have Rucio s current token issuing endpoint issue the tokens. For a python prototype see I have a parallel set of patches for  that allow third party copies using tokens issued with that API. ", "372": "There is a foreign key constraint error in the reaper         WARNING Reaper   DatabaseException Database exception. Details cx Oracle.IntegrityError ORA  integrity constraint ATLAS RUCIO.DATASET LOCKS DID FK violated child record found SQL DELETE INDEX DIDS DIDS PK FROM atlas rucio.dids WHERE atlas rucio.dids.scope scope  AND atlas rucio.dids.name name  OR atlas rucio.dids.scope scope  AND atlas rucio.dids.name name  OR atlas rucio.dids.scope scope  AND atlas rucio.dids.name name  OR atlas rucio.dids.scope scope  AND atlas rucio.dids.name name  parameters name  name  name  name  scope  scope  scope  scope  This basically happens when the reaper trys to delete a dataset which is in a container and there is a rule on the container. Due to this rule there is also a dataset lock for the dataset. The reaper now trys to delete the dataset from the table but it fails because there is a foreign key constraint from dataset locks to dids. The question is if the reaper should just also delete the dataset lock. This might be problematic as then the rule on the container is out of sync. The same issue might also exist for the undertaker but this has to be checked. Migrated from ", "366": "As the paths of tape endpoints don t follow the same conventions used by disk is necessary to test and maybe modify the consistency check module to support tape endpoints. Migrated from ", "354": "rucio.tests.test dumper path parsing.TestPathParsing.test remove prefix ok rucio.tests.test forecast.TestForecast.test predict usr   site packages sqlalchemy sql default comparator.py  SAWarning The IN predicate on requests.source rse id was invoked with an empty sequence. This results in a contradiction which nonetheless can be expensive to evaluate. Consider alternative strategies for improved performance. strategies for improved performance. expr usr   site packages sqlalchemy sql default comparator.py  SAWarning The IN predicate on requests.dest rse id was invoked with an empty sequence. This results in a contradiction which nonetheless can be expensive to evaluate. Consider alternative strategies for improved performance. strategies for improved performance. expr ok Please fix this ", "112": "If we fail on importing necessary dependencies like gfal we end up in very long timeouts later in the workflow. We should exit quickly if dependencies are not available. ", "57": "Right now these stuck rules are repaired in Hard mode meaning all locks are selected while it is actually enough to just select all STUCK locks and their sister locks. Migrated from JIRA ", "54": "Migrated from JIRA ", "53": "Migrated from JIRA ", "43": "Migrated from JIRA ", "38": "Migrated from JIRA ", "36": "Migrated from JIRA ", "35": "Hi A user noticed the following problem when submitting transfer request via  I used with List of DIDs to submit a transfer to CERN PROD PERF IDTRACKING. I included a bunch of containers and one dataset. I submitted this for approval see email below . The  web page gave no clear indication of a problem except I noticed an error message that flashed up after I pressed submit. But it was quickly replaced with something like submitted OK . Once the request had been approved it seems to have disappeared. I therfore resubmitted as two requests one for the containers and one for the dataset and it all worked fine. This was annoying as each request needs to be manually approved which understandably can take some time. If  really can t handle datasets and containers together then it should give an error when selecting DIDs not a brief flash and then nothing when submitting. Thanks Alastair Migrated from JIRA ", "31": "Migrated from JIRA ", "3389": "A hint on REPLICAS PK needs to be added on the query to get the number of replicas in list and mark unlocked replicas ", "3382": "only one storm protocol is defined in AGIS two found in the attributes rucio admin rse info INFN  DATADISK storm extended attributes None hostname storm fe.cr.cnaf.infn.it prefix storage gpfs atlas atlas atlasdatadisk rucio domains u wan u read  u write  u third party copy  u delete  u lan u read  u write  u delete  scheme storm port  impl rucio.rse.protocols.storm.Default strom extended attributes None hostname storm fe.cr.cnaf.infn.it prefix webdav atlas atlasdatadisk rucio domains u wan u read  u write  u third party copy  u delete  u lan u read  u write  u delete  scheme strom port  impl rucio.rse.protocols.storm.Default ", "3381": "Debugging with Katy her attempt to multi hop we noticed that while there is a check in non multihopping code which ignores distances set to None there is no check in the multi hop link finder. We re now running a version which ignores such links in its test. I also noticed the function is using as a default argument which is a python no no. I can make a PR that fixes both issues. Hopefully after we get MH working. ", "3378": "Provide the possibility to specify push or pull mode for WebDAV transfers in conveyor. ", "3371": "We encountered a rule where all but one file had been replicated. The missing file was in a strange state it had a single replica in COPYING state. Trying to identify said file with the following did not work rucio list file replicas missing rse RSE DID Granted this is an exceptional case and requires database access to fix but it should have been possible to identify the file with the client.  missing should imply all states  Make a minor adjustment to the checking logic. ", "3368": "rucio list file replicas rse foo user.mlassnig user.mlassnig.pilot.test.single.hits SCOPE NAME FILESIZE  RSE REPLICA Check the validity of the supplied argument display an error message in case the RSE does not exist. ", "3364": "Traceback         CRITICAL Thread   Traceback most recent call last File usr lib  site packages rucio daemons reaper  line  in reaper delete replicas rse id rse id files deleted files File usr lib  site packages rucio db sqla session.py line  in new funct raise DatabaseException str error DatabaseException Database exception. Details cx Oracle.IntegrityError ORA  integrity constraint ATLAS RUCIO.DATASET LOCKS DID FK violated child record found ", "3361": "For Kubernetes. ", "3355": "The partitioning algorithm is not working correctly for thread id  . It then wrongly goes to a mode assuming there are no partitions. ", "3348": "The templates are currently not automatically included in the packaging. Need to be included. ", "3337": "Fixes to bugs discovered after first deployment. rucio.core.oidc correct a behaviour for Rucio servers opting not to use the OIDC AuthN Z try except around lines   rucio.client.baseclient fixing a bug in import of unavailable libraries remove lines corresponding to core.monitor library bin rucio File usr bin rucio line  in get client oidc issuer args.oidc issuer.lower AttributeError NoneType object has no attribute lower set default to empty string for confing get function when defining oidc issuer in bin rucio investigate reason of internal server error on Rucio DOMA cluster for browser based OIDC logins CLI oidc auto works CLI login with polling works and client fetches a token but browser does not display confirmation message CLI fetch code login method crashes on delivery of the fetchcode and browser displays internal error. ", "3334": "Document how to use Globus Online as a Rucio transfer tool Please include rst file. ", "3324": "The rucio admin script does not call the get account limits with the correct local global locality. Need to implement a wrapper function in order to select the correct option. ", "3320": "Conveyor strict copy mode not properly working ", "3315": "Enable the possibility to specify strict copy needed for object stores ", "3314": "Bug in the selection of compatible checksum in the conveyor If no checksum type is specified as a RSE attribute it assumes that all checksum are supported and it override verify checksum ", "3313": "The current regex doesn t fit to  convention ", "3312": "If the pilot uses the write lan activity to upload a file it will send the corresponding pfn usually an internal proxy to panda which will then fail to add the replica in Rucio because it doesn t match the expected pfn. This is because the checks in add replica are hard coded to use the wan domain The checks should be changed to allow adding replicas with lan domain. ", "3308": "New reaper not handling ConfigNotFound         INFO Thread   Reaper started Exception in thread Thread  Traceback most recent call last File usr   threading.py line  in bootstrap inner self.run File usr   threading.py line  in run self. target self. args self. kwargs File usr lib  site packages rucio daemons reaper  line  in reaper max evaluator backlog count get reaper max evaluator backlog count File usr lib  site packages retrying.py line  in wrapped f return Retrying dargs dkw .call f args kw File usr lib  site packages retrying.py line  in call return attempt.get self. wrap exception File usr lib  site packages retrying.py line  in get six.reraise self.value  self.value  self.value  File usr lib  site packages retrying.py line  in call attempt Attempt fn args kwargs attempt number False File usr lib  site packages rucio db sqla session.py line  in new funct return function args kwargs File usr lib  site packages rucio core config.py line  in get raise ConfigNotFound ConfigNotFound Configuration not found. Configuration not found. ", "3292": "Temporary unavailable replicas CLI bug that declare the files lost ", "3289": "It is no longer possible to upload files to Dynfed because of an attempt to stat non existing file This line doesn t seem to me correct in section related to protocol.renaming False ", "3286": "mlassnig  rucio upload rse CERN PROD SCRATCHDISK scope user.mlassnig protocol gsiftp name  etc hosts        INFO Preparing upload for file hosts        INFO Successfully added replica in Rucio catalogue at CERN PROD SCRATCHDISK        INFO Successfully added replication rule at CERN PROD SCRATCHDISK        INFO Trying upload with gsiftp to CERN PROD SCRATCHDISK        ERROR An unknown exception occurred. Details Checksum not validated This worked alright in  but not anymore since at least  Upload with other protocols is ok mlassnig  rucio upload rse CERN PROD SCRATCHDISK scope user.mlassnig protocol root name  etc hosts        INFO Preparing upload for file hosts        INFO Successfully added replica in Rucio catalogue at CERN PROD SCRATCHDISK        INFO Successfully added replication rule at CERN PROD SCRATCHDISK        INFO Trying upload with root to CERN PROD SCRATCHDISK        INFO Successfully uploaded file hosts ", "3285": "Follow up of issue verification of reliability of the etag retrieval with rquests and davix. implementation of more reliable solution adding logging at the protocol level propagating the command to the pilot log ", "3284": " correctly schedules the RSE for deletion but then finds that it cannot delete these replicas because they are in COPYING but since it should delete the  or whatever it is set bulk size in the loop it goes to other tombstoned replicas. Since the epoche ones in copying don\u2019t suddenly go away it eats into the secondaries further It should not schedule the RSE for deletion due to replicas in this state and secondly in the deletion loop it should still check the watermark levels and see if it needs to delete secondaries. ", "3282": "We noticed in the data carousel that all datasets were going to a single site in each cloud when they should have been distributed by the freespace weight. It looks like inject rule does not use the weight properly. When create locks replicas transfers is called preferred rse ids is empty This eventually goes to rule grouping where if preferred rse ids is empty prioritize order over weight True which means the first RSE in the list is chosen instead of taking the weight into account. The simple modification would be setting preferred rse ids rses in inject rule but there are probably other ways. ", "3275": "The rowcount variable is not properly reinitialized in delete replicas ", "3272": "CMS RSEs will also need these approvals mechanisms ", "3262": " Lack of logging verbosity due to weak handling of return codes and errors  Better timeout handling add  just catch it and propagate it into the log throwing Exception with rcode add  perhaps using a timer solution from TWAtGH def run cmd timeout sec proc Popen shlex.split cmd stdout PIPE stderr PIPE timer Timer timeout sec proc.kill try timer.start stdout stderr proc.communicate finally timer.cancel or proper but complicated solution from vokac see attached file. ", "3258": "What can happen now is that list dataset replicas vp can return virtual replica but when the job runs it can not pull the data since the only copy is for example on TAPE. proper fix would be to check if regular replicas exist with protocol root and if not list dataset replicas vp should return nothing. ", "3257": "when VP replica is not created the list dataset replicas vp should not return anything. Currently it returns regular replicas. It should not return anything if no VP replicas. ", "3253": "As a result  might rebalance again a rule that has already been processed by a previous run. Skip rules that have child rule id set. ", "3236": "The source rse id filling when queuing requests takes an unreasonable amount of time. Disable the functionality until a better way can be found to do that. ", "3228": "Currently the filtering of blacklisted updated dids is done on the daemon side. However for datasets with lots of updated dids in the queue this does not scale well. The blacklisted datasets should be filtered directly in the SQL query. ", "3225": "The submitter crash when enabling multihop mode ", "3209": "PR  causes a regression crash in the server by requiring a client section in the config file for the server. Should use the no exception parameter right? ", "3204": "I recall some recent discussion CHEP or pre GDB? about possibly developing a Rucio CSI plugin for Kubernetes. Are there any plans to do this? If I understand correctly it seems like the right way to stage in data for grid jobs on kubernetes because the staging would occur in the background before the compute job starts running and occupying resources. A user would request a Rucio volume and specify a secret proxy to use and the desired files to download. When the job starts running the files would be downloaded and available in the volume. ", "3201": "Minos Temporary unavailable files in bad pfns not removed if processed after expiration date ", "3196": "", "3193": "The stat command of gfal currently does a checksum call for each checksum in GLOBALLY SUPPORTED CHECKSUMS this currrently results in a very long processing time for SRM which finally times out after  minutes. First try the PREFERRED CHCEKSUM and if this validates successfully don t try the other checksums. ", "3188": "Traceback         CRITICAL Traceback most recent call last File usr lib  site packages rucio daemons badreplicas minos.py line  in minos update replicas states chunk nowait False session session File usr lib  site packages rucio db sqla session.py line  in new funct result function args kwargs File usr lib  site packages rucio core replica.py line  in update replicas states raise exception.ReplicaNotFound No row found for scope s name s rse s replica scope replica name get rse name replica rse id session session ReplicaNotFound Replica not found Details No row found for scope panda name     rse NDGF  SCRATCHDISK ", "3187": "Currently they are allowed to fail should be required ", "3182": " generates some error messages with thread information included ", "3181": "Currently the download is aware of the client location via the list replicas call. A similar workflow must be added to the upload. If the client location sitename is equivalent to the sitename of the upload rse use the lan domain for the upload protocol creation. ", "3178": "After discussion it looks like many people prefer snake case instead of CamelCase for RSE attributes for total and used space. That s obviously a wrong choice similar to choosing emacs instead of vi my  satoshis but since the majority decides let it be ", "3175": "Currently the core.replica.set tombstone method has a session leak since it creates a new session with every method call. This breaks the session hand through logic Rucio usually runs and needs to be fixed. ", "3165": "The  release introduced local and global quotas and broke backwards compatibility to the old clients. ", "3161": "On the request of a more detailed error message from the download client if the DID doesn t exist these lines were patched in for input did in item dids input did str s s input did scope input did name did exists False for file item in file items if input did str file item did or input did str in file item parent dids did exists True break if not did exists logger.error No replicas found for DIDs s input did str file items.append did input did str  None  None sources If the download is called with at least two not existing DIDs it crashes because it adds a source less entry to file items without the parent dids key set. Add by default parent dids set to the source less did entry file items.append did input did str  None  None sources ", "3160": "This appears to be related to the introduction of global quota support. rucio admin account set limits dcameron NO NORGRID  LOCALGROUPDISK  Client object has no attribute set account limit Rucio exited with an unexpected unknown error please provide the traceback below to the developers. Traceback most recent call last File home dcameron dev ddm rucio bin rucio admin line  in new funct return function args kwargs File home dcameron dev ddm rucio bin rucio admin line  in set limits client.set account limit account args.account rse args.rse bytes byte limit AttributeError Client object has no attribute set account limit Update rucio admin to use the proper method. Add necessary support to rucio admin but keep get limits and set limits as aliases. ", "3153": "In the locks overview when requesting the URL to the FTS monitoring the UI will show the message \u2018The request has not yet been submitted\u2019 even if the transfer is done and the Finisher has yet to process it. In addition to SUBMITTED display the FTS URL when the request is either DONE or FAILED . ", "3138": "If the custom checksum support RSE attribute supported checksums is not set the RSE is by default defined compatible with the standard checksum algorithms. Due to how get rse attribute works when supported checksums is not found an empty string containing is returned instead of a None string. The following logic assumed to have an None string instead of a string formatted like that. Update the logic to sense such behavior and return the standard GLOBALLY SUPPORTED CHECKSUMS list in that case. ", "3134": "The idea is to only list files in list replicas which are created after a certain timestamp. This will help workflows such as  which continuously query for new replicas to quickly assess the files added to a dataset. ", "3129": "When accessing the webui for the first time without any cookies set it loads correctly. Then when reloading the page the token is not set in javascript anymore and no requests can be made to Rucio. ", "3128": "The conveyor crashes when multihop is done through a non deterministic endpoint ", "3127": "Due to the change from simple limits usage to local global usage and limits the backwards compatibility for old clients is currently broken. This is due to the fact that the REST endpoints where changed from . limits AccountLimits . limits . AccountLimits . usage  . usage .  to . limits local LocalAccountLimits . limits local . LocalAccountLimits . limits global GlobalAccountLimits . limits global . GlobalAccountLimits thus the required endpoints are missing for old clients. The endpoints need to be re added and pointing to the local version of the usage limit. ", "3121": "Lifetime Model Limit the duration of the extension to one year in the UI ", "3118": "Properly remove leftover stale files when running tests. ", "3111": "Previous PR  introduced this bug related to a missing parentheses at the formatting of a debug output string here Add the parentheses surrounding the formatting elements. ", "3108": "InvalidRequestError This Session s transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session first issue Session.rollback . Original exception was  duplicate key value violates unique cons traint ACCOUNT ATTR MAP PK DETAIL Key account key root jdoe  already exists. SQL INSERT INTO dev.account attr map account key value updated at created at VALUES account s key s value s updated at s created at s parameters value true created at datetime.datetime        account root key jdoe  updated at datetime.datetime        Background on this error at Background on this error at Add new error string handling. ", "3102": "Hi Even with conveyor.retry protocol mismatches set to True the finisher seems to fail to retry protocol mismatch errors at all it just ignores them . This seems to be handled by these lines But it never gets any requests in the MISMATCH SCHEME state seemingly because this constant isn t included in the main database query filter here Would it be possible for this to be fixed? Regards Simon ", "3093": "The following error raised from further testing         CRITICAL Exception happened when trying to get transfer for request  Traceback most recent call last File usr lib  site packages rucio core transfer.py line  in get transfer requests and source replicas source rse checksums get rse supported checksums source rse id session File usr lib  site packages retrying.py line  in wrapped f return Retrying dargs dkw .call f args kw File usr lib  site packages retrying.py line  in call return attempt.get self. wrap exception File usr lib  site packages retrying.py line  in get six.reraise self.value  self.value  self.value  File usr lib  site packages retrying.py line  in call attempt Attempt fn args kwargs attempt number False File usr lib  site packages rucio db sqla session.py line  in new funct return function args kwargs TypeError get rse supported checksums got multiple values for keyword argument session Fix lines  and  in rucio core transfer.py replacing session bu session session in roder to use the wrapper defined DB session. ", "3089": "In the delete replicas method the archive contents clause uses too many bind variables  . Reduce the chunking from  to  ", "3086": "Some minor improvements for multi hop algorithm identified during testing. ", "3085": "The list of RSEs to be processed by a reaper instance is evaluated once at the beginning. Reevaluate the list of RSEs regularly ", "3081": "Tunable values for max threads by host prevent starting new threads in case there is not enough work ", "3078": "        CRITICAL Thread   Traceback most recent call last File usr lib  site packages rucio daemons conveyor submitter.py line  in submitter retry other fts retry other fts File usr lib  site packages rucio daemons conveyor submitter.py line  in get transfers failover schemes failover schemes File usr lib  site packages rucio db sqla session.py line  in new funct result function args kwargs File usr lib  site packages rucio core transfer.py line  in get transfer requests and source replicas new req id new req  id IndexError list index out of range ", "3074": "Currently to transfer files via Globus Online the globusLibrary.py makes explicit path references to config.yml to retrieve client id and refresh token. client id cfg globus apps SDK Tutorial App client id refresh token cfg globus apps SDK Tutorial App refresh token Retrieve globus auth app name in rucio.cfg conveyor property. client id cfg globus apps GLOBUS AUTH APP client id refresh token cfg globus apps GLOBUS AUTH APP refresh token ", "3071": "In the core.replica.set tombstone method a separate connection object is created. This has potential side effects since it could operate in a separate transaction. If the engine object is needed it would be better to resolve this from the session. ", "3070": "check global quota not only when initializing the RSESelector but also when calling the select rse method. update select rse update quota method in the RSESelector ", "3054": "Dependency upgrade for  ", "3053": "Now setting the quota is linked to the country xyz admin attribute. It would be good to have a quota approver on the RSEs similar to rule approver. ", "3050": "When running in a container the name and uid of the local user account are largely arbitrary and meaningless. In commonly used containers the username is often left undefined by convention. However if the Rucio client is used it tries to look up the name of the current user and fails if there is no name. This job is running with uid         Mover.py ERROR Mover get data failed stagein exception caught getpwuid uid not found         Mover.py Traceback most recent call last File tmp workdir condorg FgXUogoB Panda Pilot   PandaJob Mover.py line  in get data new output mover.stagein files files analyjob job.isAnalysisJob File tmp workdir condorg FgXUogoB Panda Pilot   PandaJob movers mover.py line  in stagein transferred files failed transfers self.stagein real files normal files activity pr analyjob analyjob skip transfer failure allowRemoteInputs File tmp workdir condorg FgXUogoB Panda Pilot   PandaJob movers mover.py line  in stagein real self.resolve replicas files do populate fspec.replicas for each entry in files File tmp workdir condorg FgXUogoB Panda Pilot   PandaJob movers mover.py line  in resolve replicas from rucio.client import Client File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  lib  site packages rucio client init .py line  in module from rucio.client.client import NOQA pylint disable wildcard import File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  lib  site packages rucio client client.py line  in module from rucio.client.accountclient import AccountClient File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  lib  site packages rucio client accountclient.py line  in module from rucio.client.baseclient import BaseClient File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  lib  site packages rucio client baseclient.py line  in module class BaseClient object File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  lib  site packages rucio client baseclient.py line  in BaseClient TOKEN PATH PREFIX get tmp dir .rucio File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  lib  site packages rucio common utils.py line  in get tmp dir user getuser File usr   getpass.py line  in getuser return pwd.getpwuid os.getuid  KeyError getpwuid uid not found  This causes jobs to fail when running on Kubernetes. It looks like the Rucio client is just trying to find some descriptive string to name a temporary directory File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  lib  site packages rucio common utils.py line  in get tmp dir user getuser If a username is not defined can it simply use the uid instead when choosing a name for the temporary directory? This would make the Rucio client more container friendly. Thanks. ", "3039": "Some alembic commands do not work with the context outside a callable. Moving them back into the callables. ", "3038": "I had a few issues setting up the dev environment mainly with the documentation at etc docker dev README.rst . docker exec it dev rucio  bin bash has a typo it should be bin bash It should be mentioned that SELinux will block access to the directories mounted inside the container so it should be disabled. logshow doesn t work root rucio rucio logshow multitail  C   by folkert vanheusden.com The following problem occured ttyname  failed. If this is a bug please report the following information The last system call returned  which means No such file or directory Terminated After this the terminal freezes up and the multitail processes have to be forcibly killed from outside the container. The tests create a lot of junk in the database RSEs accounts etc is there a way to reset the database back to a clean state? ", "3035": "cf. Data carousel discussion for the full thread. In summary It appears that the desideredLifetime Copy pin lifetime values in FTS are set to  in FTS. FTS fallbacks to a different default values depending on the FTS settings. This pin lifetime is too small to retain files on the tape buffer which leads to have staged files deleted before being tranfered. Set the desideredLifetime Copy pin lifetime to the same value. The rule lifetime is the most appropriate to express to the sites how much time the file should be kept around and get same value. ", "3032": "Enlarge the clients Python  tests Move CLIENTS  test to main Add CLIENTS  test to allow failures Add CLIENTS  test to allow failures Will probably fail terribly ", "3028": "minos expiration doesn t handle properly ReplicaNotFound ", "3022": "For the decommissioning tool would be nice to have the ability to update the rse configuration directly from rucio admin tool i.e to avoid new data be uploaded to the soon to be decommissioned rse an admin should be able to rucio admin rse update rse RSE NAME parameter availability write value False ", "3019": "When rucio admin config get section rse is used the following error is shown Configuration not found. Details No configuration found for section rse Rucio exited with an unexpected unknown error please provide the traceback below to the developers. Traceback most recent call last File opt rucio bin rucio admin line  in new funct return function args kwargs File opt rucio bin rucio admin line  in get config res client.get config section args.section option args.option File usr lib  site packages rucio client configclient.py line  in get config raise exc cls exc msg ConfigNotFound Configuration not found. Details No configuration found for section rse Include ConfigNotFound exception in the rucio admin exception handler ", "3013": "There are a lot of different ways how dids and there scope and name components are passed and handled. E.g. def attach dids self scope name dids rse None param scope The scope name. param name The data identifier name. param dids The content. def download dids self items num threads  trace custom fields traces copy out None param items List of dictionaries. Each dictionary describing an item to download. Keys did DID string of this file e.g. scope file.name In order to avoid confusion and simplify the code a unified type could be used that also provides utility functionality to work with DID types e.g. did str s s scope name did str str DIDType scope name or for an existing object did str str did scope name split did did str scope did.scope name did.name Implement a prototype for this type and start using it in non API breaking parts ", "3011": "Noticed this going through the requests documentation ", "3006": "Some daemons doesn t have a description in argparse so documentation tool doesn t generate the description accordingly. Include the description of the daemon in the argparse description. ", "2996": "Add some examples of rucio demons to be used in docker dev environment. ", "2993": "For both the MySQL and PostgreSQL database types the hashing algorithm used to partition worker thread responsibilities has the divisor of the modulo operation being incorrectly computed erroneously using total threads  instead of the raw value of total threads. This has the consequence of preventing some threads from ever being assigned work. I will provide a fix for this. I intend to create a function in db sqla util.py to do this as this pattern for workload partitioning is repeated  times throughout the codebase. ", "2992": "There s no difference between the output of rucio list dids empty dataset and rucio list dids nonexisting dataset Outputs should be different or at least drop a warning in the second case. Discussion needed about how to solve this without broke users. ", "2990": "The current development docker compose makes services listen to all incoming IP addresses which is incompatible with security policies at some locations. Provide a separate docker compose file that listens only to the loopback address. ", "2987": "The current docker dev environment is missing any kind of monitoring. Extend the docker compose file to also include an ELK stack and Grafana with some example dashboards. ", "2986": "checksum after download  rucio download should return a clear message if a DID doesn t exist  Remove DownloadClient.download file from archive and rsemanager.download  ", "2980": "At the moment the need to download and upload files one at a time. The reason is that the pilot also needs to handle the traces. I would be usful if either the Rucio client can handle the traces given the correct options or return something that can easily be used to record the traces of a bulk upload. Either introduce code to optionally handle traces in the code of rucio.client.downloadclient rucio.client.uploadclient or format the return data to allow the pilot to construct the trace information from it. ", "2970": "        CRITICAL Thread   Traceback most recent call last File usr lib  site packages rucio daemons reaper  line  in reaper delete replicas rse id rse id files deleted files File usr lib  site packages rucio db sqla session.py line  in new funct raise DatabaseException str error DatabaseException Database exception. Details cx Oracle.IntegrityError ORA  integrity constraint ATLAS RUCIO.SOURCES REPLICAS FK violated child record found SQL DELETE INDEX REPLICAS REPLICAS PK FROM atlas rucio.replicas WHERE atlas rucio.replicas.rse id rse id  AND atlas rucio.replicas.scope scope  AND atlas rucio.replicas.name name  OR atlas rucio.replicas.scope scope  AND atlas rucio.replicas.na me name  OR atlas rucio.replicas.scope scope  AND atlas rucio.replicas.name name  OR atlas rucio.replicas.scope scope  AND atlas rucio.replicas.name name  OR atlas rucio.replicas.scope scope  AND atlas rucio.replicas.name name  OR atlas rucio. replicas.scope scope  AND atlas rucio.replicas.name name  OR atlas rucio.replicas.scope scope  AND atlas rucio.replicas.name name  OR atlas rucio.replicas.scope scope  AND atlas rucio.replicas.name name  OR atlas rucio.replicas.scope scope  AN D atlas rucio.replicas.name name  OR atlas rucio.replicas.scope scope  AND atlas rucio.replicas.name name  parameters u name  DAOD   u name  DAOD   u name  DAOD   u name  DAOD   u name  DAOD    u name  DAOD   u name  DAOD   u scope    u name  DAOD   u name  DAOD   u scope  mc   u scope    u scope    u scope    u scope    u scope    u scope    u name  DAOD   u rse id  read only buffer for   size  offset  at  u scope    u scope    Background on this error at The problem is due to the relaxed constraint to keep files that are being transfered ", "2969": "For example Thread   Deletion NOTFOUND of  as IP HOST PORT PATH on  DATADISK This is different from the previous Reaper implementation. Such traces reduce the deletion efficiency as we are currently calculating it in our monitoring. Is it intentional? Potentially do not submit traces for SourceNotFound . ", "2968": "The traces after the pattern matching and replacement from MONIT is applied look like this Thread   Deletion NOTFOUND of  as IP HOST PORT PATH on  DATADISK The thread information is breaking the classification based on the current patterns but it should probably not be included in the first place. Remove the thread information from the traces. ", "2960": "When a replica has no replicas AVAILABLE and one declare one of these replicas as lost all the requests for the other replicas are canceled but not the one of the file that was declared. ", "2957": "From Diego dciangot Details Account dciangot can not add file replicas on  IT Legnaro Temp Change the permission file for CMS ", "2954": "In some of the permission checks we do if is root issuer or issuer ddmadmin which does not work anymore since we introduced the InternalAccount for the issuers. Change to if is root issuer or issuer.external ddmadmin or add ddmadmin to the is root check ", "2947": "From Tim For the DOMA TPC work we have added a workaround in the external gateways so they strip leading s in the path. I don t think we applied the same hack for access from the worker nodes. If necessary this might be possible but would need careful testing with other VOs so isn t something we can do trivially. Can we fix  to not add the extra ? For interactive use eg. gfal copy we a fix was implemented some time ago but it requires an option to enable. I ll check the details and follow up later. cf. ", "2943": "the  client tests should be activated on next branch ", "2931": "File usr lib  site packages rucio transfertool  line  in submit raise No transfer id returned by s self.external host TypeError exceptions must be old style classes or derived from BaseException not unicode Needs to raise an actual exception class. ", "2925": "Pilots using rucio mover do not report useful information on why a transfer failed. This is because on failure the download and upload client throw an exception with no information inside. The real reason for the error should be propagated better back to the caller of the client. The dowloadclient and uploadclient should return a dictionary of file status containing appropriate error information instead of raising an exception. ", "2924": "The docs at describe using RUCIO ENABLE LOGFILE to enable logging in docker. The starter shows this should be RUCIO ENABLE LOGS . Update documentation ", "2917": "For the add files to datasets call a list of attachments with pfns can be given to Rucio. In the case that these PFNs have different protocols the PFN check fails since the protocol is only initialised once with the last protocol of the list and assumes all PFNs have the same protocol. E.g. scope panda name   dids   name   bytes  pfn srm f   srm  dpm grid.sinica.edu.tw home atlas atlasscratchdisk rucio panda     meta panda id  guid      scope panda   name   bytes  pfn davs f   dpm grid.sinica.edu.tw home atlas atlasscratchdisk rucio panda     meta panda id  guid      scope panda rse TAIWAN  SCRATCHDISK ATLAS JIRA Link PFN check needs to initialise a protocol for each protocol group of PFNs. ", "2916": "Try to reactivate the test bin rucio.py tests in the SUITE CLIENT remove core db function from test bin rucio.py reactivate in .travis.yaml ", "2912": "declare bad file replicas is broken after the move to InternalAccount ", "2911": "Right now there are methods to soft delete an RSE and disable it but no methods to bring it back. Wouldn t it make sense to allow for an RSE to be enabled again without doing manual operations on the database? This might be useful for synchronization with CRIC Add method that sets up deleted RSE as active again. Would a CLI command rucio admin rse recover make sense? ", "2907": "Once the database scheme changes for OIDC authentication are in place see  it will become possible to request a new JWT access token using a JWT refresh token and let Rucio continue acting on behalf of the user even after user session has expired. For this purpose each token will get a boolean refresh state in the DB new column . If this state is set to True e.g. by an anticipated long transfer operation requested by an authenticated user a separate daemon must be watching this state change and get a new access token before the previous access token expires. Also this daemon should be performing deletion of all not only OIDC expired Rucio tokens. new daemon DB scheme change according to  ", "2905": "Expand Rucio support for Globus Online as a transfer tool to support sciences using Rucio as a data management tool but not using FTS to transfer files. Most of the changes are made in the conveyor daemons as well as new libraries for Globus. rucio.daemons.conveyor.submitter rucio.daemons.conveyor.common rucio.core.transfer rucio.daemons.conveyor.poller rucio.rse.protocols.globus.py rucio.transfertool.globus.py rucio.transfertool.globusLibrary.py rucio.transfertool.config.yml ", "2899": "in the new request listing API from  the use of sites does not work properly as the sitename gets resolved to only one RSE. resolve sitename to all RSEs with the site attribute ", "2896": "I was experimenting with the Rucio CRIC integration and while doing so I was disabling and re enabling RSEs. What I noticed is that when the importer tries to configure an RSE that already exists on the database but is marked as Deleted it will throw an error Details RSE with id  cannot be found After further investigation I found out that when the importer sees an RSE on the json it will check if it already exists to avoid creating it again. It does so using the rse module.get rse id method. This method though returns the id even if the RSE is already marked as deleted. Further down on the code that the rse id of the deleted RSE is referenced of course it throws an error. Possible solution Check if the RSE is marked as deleted and enable it again before trying to modify it. ", "2895": "Traceback most recent call last File opt rucio lib rucio daemons  nuclei background rebalance.py line  in module rebalance rse source rse rse max bytes available target rebalance volume dry run False comment Nuclei Background rebalancing force expression destination rse rse File usr lib  site packages rucio db sqla session.py line  in new funct result function args kwargs File usr lib  site packages rucio daemons  common.py line  in rebalance rse for scope name rule id rse expression subscription id bytes length fsize in list rebalance rule candidates rse rse mode mode File usr lib  site packages rucio db sqla session.py line  in new funct result function args kwargs File usr lib  site packages rucio daemons  common.py line  in list rebalance rule candidates models.DatasetLock.accessed at .all File usr   site packages sqlalchemy orm query.py line  in all return list self File usr   site packages sqlalchemy orm query.py line  in iter return self. execute and instances context File usr   site packages sqlalchemy orm query.py line  in execute and instances result conn.execute querycontext.statement self. params File usr   site packages sqlalchemy engine base.py line  in execute return meth self multiparams params File usr   site packages sqlalchemy sql elements.py line  in execute on connection return connection. execute clauseelement self multiparams params File usr   site packages sqlalchemy engine base.py line  in execute clauseelement distilled params File usr   site packages sqlalchemy engine base.py line  in execute context e util.text type statement parameters None None File usr   site packages sqlalchemy engine base.py line  in handle dbapi exception util.raise from cause sqlalchemy exception exc info File usr   site packages sqlalchemy util compat.py line  in raise from cause reraise type exception exception tb exc tb cause cause File usr   site packages sqlalchemy engine base.py line  in execute context context constructor dialect self conn args File usr   site packages sqlalchemy engine default.py line  in init compiled for key in compiled params File usr   site packages sqlalchemy engine default.py line  in genexpr for key in compiled params File usr   site packages sqlalchemy sql type api.py line  in process return impl processor process param value dialect File usr lib  site packages rucio db sqla types.py line  in process bind param raise InvalidType Cannot insert to db. Expected InternalAccount got string type. sqlalchemy.exc.StatementError rucio.common.exception.InvalidType Provided type is considered invalid. Details Cannot insert to db. Expected InternalAccount got string type. SQL SELECT atlas rucio.dataset locks.scope AS atlas rucio dataset lock  atlas rucio.dataset locks.name AS atlas rucio dataset lock  atlas rucio.rules.id AS atlas rucio rules id atlas rucio.rules.rse expression AS atlas rucio rules rse ex  atlas rucio.rules.subscription id AS atlas rucio rules subscr  atlas rucio.dids.bytes AS atlas rucio dids bytes atlas rucio.dids.length AS atlas rucio dids length CASE WHEN atlas rucio.dataset locks.length length  OR atlas rucio.dataset locks.length IS NULL THEN param  ELSE CAST atlas rucio.dataset locks.bytes atlas rucio.dataset locks.length AS INTEGER END AS anon  FROM atlas rucio.dataset locks JOIN atlas rucio.rules ON atlas rucio.rules.id atlas rucio.dataset locks.rule id JOIN atlas rucio.dids ON atlas rucio.dataset locks.scope atlas rucio.dids.scope AND atlas rucio.dataset locks.name atlas rucio.dids.name WHERE atlas rucio.dataset locks.rse id rse id  AND atlas rucio.rules.expires at expires at  OR atlas rucio.rules.expires at IS NULL AND atlas rucio.rules.created at created at  AND atlas rucio.rules.account IN account  account  account  AND atlas rucio.rules.state state  AND atlas rucio.rules.did type did type  AND atlas rucio.rules.copies copies  AND atlas rucio.rules.child rule id IS NULL AND atlas rucio.rules.grouping IN grouping  grouping  AND atlas rucio.dids.bytes IS NOT NULL AND atlas rucio.dids.is open is open  AND atlas rucio.dids.did type did type  AND CASE WHEN atlas rucio.dataset locks.length length  OR atlas rucio.dataset locks.length IS NULL THEN param  ELSE CAST atlas rucio.dataset locks.bytes atlas rucio.dataset locks.length AS INTEGER END param  AND SELECT count AS count  FROM atlas rucio.dataset locks dataset locks  WHERE dataset locks  atlas rucio.dataset locks.scope AND dataset locks  atlas rucio.dataset locks.name AND dataset locks  id atlas rucio.dataset locks.rse id param  ORDER BY CASE WHEN atlas rucio.dataset locks.length length  OR atlas rucio.dataset locks.length IS NULL THEN param  ELSE CAST atlas rucio.dataset locks.bytes atlas rucio.dataset locks.length AS INTEGER END atlas rucio.dataset locks.accessed at parameters ", "2886": "The conversion of issuer into an object is not done at least for the delete replication rule def delete replication rule rule id purge replicas issuer Deletes a replication rule and all associated locks. param rule id The id of the rule to be deleted param issuer The issuing account of this operation raises RuleNotFound AccessDenied kwargs rule id rule id purge replicas purge replicas if not has permission issuer issuer action del rule kwargs kwargs raise AccessDenied Account s can not remove this replication rule. issuer rule.delete rule rule id rule id purge replicas purge replicas soft True It leads to a permission issue when trying to delete a rule. The other methods need to be checked too ", "2882": "The fake storm protocol needs to be included in the list replicas reply. ", "2878": "We need a new API for the network people such that they can query the queued and submitted requests for a given link. The complication comes that the network people basically only have the site name and do not know about RSEs. Suggestion is to create a new endpoint in web request.py request list with the HTTP parameters request state Q S . src rse dst rse src site dst site where if the client uses sites instead of RSEs then they have to be resolved to RSEs internally ", "2877": "The dark reaper crashes with         CRITICAL Traceback most recent call last File usr lib  site packages rucio daemons reaper dark reaper.py line  in reaper lfns scope replica scope .external name replica name path replica path AttributeError NoneType object has no attribute external This is due to the fact that for quarantined replicas the scope and name can sometimes be NULL. But due to the InternalScope change where the external is forcefully read the daemon crashes. This needs to be adapted to handle NULL scopes. ", "2874": "As it is loaded as string instead of int the method crashes on line  config get int should be used here however this method needs to be expanded with the raise Exception and default options similar to config get and config get bool ", "2872": "On next branch the alembic CLI seems to not work anymore with the upgrade from version  to  alembic c etc alembic.ini history File usr lib  site packages alembic util langhelpers.py line  in name error name cls. name NameError Can t invoke function get context as the proxy object has not yet been established for the Alembic EnvironmentContext class. Try placing this code inside a callable. Seems like all the schema declarations have to be moved to the upgrade downgrade functions ", "2866": "Wed Aug      error pid  tid  Traceback most recent call last Wed Aug      error pid  tid  File usr lib  site packages rucio web rest replica.py line  in GET Wed Aug      error pid  tid  for row in list datasets per rse rse rse Wed Aug      error pid  tid  File usr lib  site packages rucio api replica.py line  in list datasets per rse Wed Aug      error pid  tid  if scope in filters Wed Aug      error pid  tid  TypeError argument of type NoneType is not iterable Change filter ", "2865": "We observed some cases where there a replication rules in state REPLICATING with no requests. Per definition of the state machine this should not be possible. The error was tracked down to the workflow of the conveyor finisher which handles FAILED requests differently then DONE requests. For DONE requests the workflow is correct for failed ones in the  failure attempt the procedure is to archive the request first and at the end of the workflow update all failed replicas and their rules . This update is done in a different transactions though. The issue is that if the update fails e.g. due to row locks which is a valid case there is no proper fallback to this since the request has already been archived. The workflow needs to be changed similar to the DONE workflow thus the request should only be archived AFTER the update was successful. ", "2861": "There is a problem with the way Hermes handles broker connections. In some situations at least when used by CMS for instance the connections are not reused and new ones are created. The old connections are then badly closed and generate errors on the messaging brokers        ActiveMQ NIO Worker  WARN Transport Transport Connection to tcp a.b.c.d  failed javax.net.ssl.SSLException Inbound closed before receiving peer s close notify possible truncation attack? Here is a log from Hermes showing that old connections are not reused         DEBUG broker   retrieved  messages         INFO broker   connecting with SSL to          INFO broker   connecting with SSL to          INFO broker   connecting with SSL to          INFO broker   submitted  messages         DEBUG broker   sleeping  seconds         DEBUG broker   using            DEBUG broker   retrieved  messages         INFO broker   submitted  messages         DEBUG broker   sleeping  seconds         DEBUG broker   using            DEBUG broker   retrieved  messages         INFO broker   connecting with SSL to          INFO broker   connecting with SSL to          INFO broker   connecting with SSL to          INFO broker   submitted  messages ", "2858": "In  the conveyor reported a crash with the trace         ERROR Thread   Failed to submit a job with error   is not JSON serializable Traceback most recent call last File usr lib  site packages rucio daemons conveyor common.py line  in submit transfer user transfer job user transfer job File usr lib  site packages rucio core transfer.py line  in submit bulk transfers transfer id  external host external host .submit files job files job params job params timeout timeout File usr lib  site packages rucio transfertool  line  in submit params str json.dumps params dict File usr   json init .py line  in dumps return default encoder.encode obj File usr   json encoder.py line  in encode chunks self.iterencode o one shot True File usr   json encoder.py line  in iterencode return iterencode o  File usr   json encoder.py line  in default raise TypeError repr o is not JSON serializable TypeError   is not JSON serializableh Utilise rucio.common.utils.APIEncoder in the fts transfertools files ", "2855": "It would be desirable to add an  compatible objectstore based on to the development docker compose in addition to the  Xrootd servers currently included. ", "2841": "There is a bug in ValueError too many values to unpack which does not show up in the test. Fix the loop where the ValueError occurs and modify the test in tests test import export.py to have distances to export ", "2840": "Doing rucio add dataset testing test  rucio add did meta did testing test  key MYKEY value MYVALUE rucio erase testing test  Gives me the following error on undertaker   update or delete on table dids violates foreign key constraint DID META FK on table did meta DETAIL Key scope name testing test  is still referenced from table did meta . SQL DELETE FROM dids WHERE dids.scope scope  s AND dids.name name  s AND dids.did type did type  s OR dids.did type did type  s parameters name  test  did type  C scope  testing did type  D Background on this error at         CRITICAL Traceback most recent call last File usr lib  site packages rucio daemons undertaker undertaker.py line  in undertaker logging.error Undertaker s Got database error s. worker number str error UnboundLocalError local variable error referenced before assignment         INFO Undertaker   Live gives nr threads  assign thread          INFO Undertaker  Receive  dids to delete         INFO Removing did testing test  DATASET  update or delete on table dids violates foreign key constraint DID META FK on table did meta DETAIL Key scope name testing test  is still referenced from table did meta . SQL DELETE FROM dids WHERE dids.scope scope  s AND dids.name name  s AND dids.did type did type  s OR dids.did type did type  s parameters name  test  did type  C scope  testing did type  D Background on this error at         CRITICAL Traceback most recent call last File usr lib  site packages rucio daemons undertaker undertaker.py line  in undertaker logging.error Undertaker s Got database error s. worker number str error UnboundLocalError local variable error referenced before assignment Having a look at the code I believe the UnboundLocalError has been already fixed for the next releases. The Foreign key constraint seems to be there. Delete metadata for did which is about to be deleted? I wouldn t mind having a look and doing a pr ", "2835": "", "2823": "Some alembic scripts on next branch are not working in the new dev environment because of a missing dot in the schema identifier In all the alembic files schema context.get context .version table schema if context.get context .version table schema else should be schema context.get context .version table schema . if context.get context .version table schema else where schema is used in a string ", "2822": "In the case where no backend cache is available either locally or remote for Dogpile to communicate with Dogpile will return NO VALUE masking the true connection refused error due to no process actually listening at the given endpoint. Raise an exception or provide a warning when there is no caching service available at the configured endpoint provided to Dogpile. ", "2819": "The current version of the Reaper  will not reap an RSE marked as greedy that does not have MinFreeSpace and MaxBeingDeletedFiles set. MinFreeSpace should not matter for a greedy RSE and MaxBeingDeletedFiles is not used by the Reaper  Move the check for greedy mode in check rse usage to before the acquisition of RSE limits. ", "2812": "The value specifying the address of the caching endpoint used by Dogpile should allow for values other than  so that remote caching services can be used. ", "2805": "Now with new certs FTS and  xrd. ", "2802": "Activate the tests in tests test throttler.py and tests test request.py when using MySQL. ", "2799": "The Storm protocol in RSEManager returns the input lfn as the pfn in  This causes a crash as an InternalScope is then used as a dictionary key in list replicas. The lfns dictionary should be sanitised so that scope is returned as an external string. ", "2788": "There are issues with the release candidate  messages fail to serialize judge hangs on some requests REST list replicas TypeError keys must be a string  messages should be external representations. Judge is hanging as the string type new internaltypes use with the backend db is different. This causes the indexes to be ignored and a query can need to scan the full table. This type needs to be changed from unicode. ", "2787": "Rucio  and earlier when the attribute value is set to an integer e.g. for key tier the value  is displayed as True in the client output. Similarly  is shown as False . According to FIXME comment in this is a temporary work around legacy values in the ATLAS database which should be removed after the database is fixed. ", "2777": "Some usability enhancements for the development environment. ", "2772": "Currently reaper is the only daemon without a specific binary and is instead auto generated. This causes a set of problems especially w.r.t. dockers and needs to be reverted. ", "2771": "The following error occurs in the docker container for setting up rucio demo upon running setup.py PS The docker container was created as instructed INFO alembic.runtime.migration Context impl SQLiteImpl. INFO alembic.runtime.migration Will assume non transactional DDL. INFO alembic.runtime.migration Running stamp revision  RSE does not exist. Details RSE  DISK cannot be found exceptions.ValueError badly formed hexadecimal UUID string SQL SELECT rses.rse AS rses rse FROM rses WHERE rses.id ? AND rses.deleted  parameters Traceback most recent call last File . setup data.py line  in module add protocol  DISK params File usr lib  site packages rucio db sqla session.py line  in new funct result function args kwargs File usr lib  site packages rucio core rse.py line  in add protocol rse get rse name rse id rse id session session include deleted False File usr lib  site packages retrying.py line  in wrapped f return Retrying dargs dkw .call f args kw File usr lib  site packages retrying.py line  in call return attempt.get self. wrap exception File usr lib  site packages retrying.py line  in get six.reraise self.value  self.value  self.value  File usr lib  site packages retrying.py line  in call attempt Attempt fn args kwargs attempt number False File usr lib  site packages rucio db sqla session.py line  in new funct return function args kwargs File usr lib  site packages rucio core rse.py line  in get rse name result query.one  File usr   site packages sqlalchemy orm query.py line  in one ret self.one or none File usr   site packages sqlalchemy orm query.py line  in one or none ret list self File usr   site packages sqlalchemy orm query.py line  in iter return self. execute and instances context File usr   site packages sqlalchemy orm query.py line  in execute and instances result conn.execute querycontext.statement self. params File usr   site packages sqlalchemy engine base.py line  in execute return meth self multiparams params File usr   site packages sqlalchemy sql elements.py line  in execute on connection return connection. execute clauseelement self multiparams params File usr   site packages sqlalchemy engine base.py line  in execute clauseelement distilled params File usr   site packages sqlalchemy engine base.py line  in execute context e util.text type statement parameters None None File usr   site packages sqlalchemy engine base.py line  in handle dbapi exception util.raise from cause sqlalchemy exception exc info File usr   site packages sqlalchemy util compat.py line  in raise from cause reraise type exception exception tb exc tb cause cause File usr   site packages sqlalchemy engine base.py line  in execute context context constructor dialect self conn args File usr   site packages sqlalchemy engine default.py line  in init compiled param.append processors key compiled params key File usr   site packages sqlalchemy sql type api.py line  in process return process param value dialect File usr lib  site packages rucio db sqla types.py line  in process bind param return  uuid.UUID value File usr   uuid.py line  in init raise ValueError badly formed hexadecimal UUID string sqlalchemy.exc.StatementError exceptions.ValueError badly formed hexadecimal UUID string SQL SELECT rses.rse AS rses rse FROM rses WHERE rses.id ? AND rses.deleted  parameters Apparently when the  DISK folder is not created then in usr lib  site packages rucio db sqla types.py  if not isinstance value uuid.UUID  return  uuid.UUID value the variable value is the string  DISK which throws the error. However if I run setup.py again the string in value is changed to  but now it falls prey to sqlalchemy.exc.IntegrityError . sqlalchemy.exc.IntegrityError  columns account rse id are not unique SQL INSERT INTO account usage account rse id files bytes updated at created at VALUES ? ? ? ? ? ? parameters root                Background on this error at Any suggestions around this? ", "2769": "From St\u00e9phane in Hello Currently when a job tries to access a file through rucio mover  or direct access through xcache instead of using xcache and maybe the used protocol will depend on the prefer protocol of the remote site. Could this be corrected ? Thanks St\u00e9phane ", "2764": "The instructions link for setting up docker goes to an external the documentation on setting up the environment has broken links. link for docker compose file is missing which becomes a bit frustrating. As an alternative there s a setting up tutorial in the docs Replaced the external link with internal reference in doc source rucio.demo.rst Expected Result The link for setting up Rucio demo environment should now give reference within the documentation. ", "2763": "The minos temporary expiration daemon does update replica states queries with nowait False it would be better with nowait True . An even better solution might be to change the core query in to not call the successful transfer lock update in case of transition from TEMP UNAVAILABLE to AVAILABLE since no transfers have to be marked. ", "2760": "The dark reaper raises an error in  Fix the query in core quarantined replica.py list rses ", "2755": "Looking at the monitor.py code it s using pystatsd which seems to be abandoned. It appears that is better supported and implements things like the context manager by default. In fact this code looks almost like monitor.py Maybe best to refactor and make monitor a very thing layer over statsd. ", "2754": "Hi jamesp epcc bjwhite fnal reported an issue with the parent directory creation in gfal related to your URL signing commit Looking at the code for  copy in rse protocols gfal.py I see that in Rucio  ctx.mkdir rec str dir name  is still called in order to create the intermediate parent directories for every transfer regardless of protocol. This comes with a comment in the source that This function will be removed soon.  will create parent dir automatically. By Rucio version  this try block to create parent directories has been modified to only be executed for transfers in accordance with this comment. However as far as I can tell the most recent version of   does not create the intermediate directories. This causes Rucio to instead raise a SourceNotFound exception if the parent directories of the destination do not already exist. Is this the expected behavior of Rucio  rucio v upload rse DCACHE BJWHITE START scope test PWD         INFO Preparing upload for file         DEBUG Registering file        DEBUG Skipping dataset registration        INFO File DID already exists        DEBUG local checksum  remote checksum         INFO Trying upload with gsiftp to DCACHE BJWHITE START        ERROR Access to local destination denied. Details Source file not found. Details globus ftp client the server responded with an error  File not found Completed in  sec. Uploading a file to a currently existing directory works as expected with gridFTP at least . You put the parent directory creation directly under the condition of not self.renaming and dest  Is this because you tested and  automatically creates the parents? I was checking in the  changelog but could not  confirm this. ", "2747": "Conveyor submitter raised an error core.transfer.get transfer requests and source replicas Light reaper raised an error Invalid UUID Reorder checks in get transfer requests and source replicas Convert rse name to id in light reaper and dark reaper ", "2737": " missed Kronos calls to touch replica touch collection replicas and touch dataset locks Fix Kronos so that it converts to rse id before making these calls. ", "2736": "Currently it looks like the mode is functional while it isn t. If used at the CLI return NotImplemented error. ", "2732": "Rucio was recently upgraded to use SQLAlchemy  which changed the behavior of SQLAlchemy to raise an exception as opposed to a warning when passing strings as part of a query. Declare text as text to keep SQLAlchemy happy. ", "2731": "I m trying to setup the dev container locally using the default docker compose and run the tests. When I do that it fails with the message Sync rse repository cannot get auth token Traceback most recent call last File tools sync rses.py line  in module c Client File usr lib  site packages rucio client client.py line  in init super Client self . init rucio host rucio host auth host auth host account account ca cert ca cert auth type auth type creds creds timeout timeout user agent user agent File usr lib  site packages rucio client accountclient.py line  in init super AccountClient self . init rucio host auth host account ca cert auth type creds timeout user agent File usr lib  site packages rucio client accountlimitclient.py line  in init auth type creds timeout user agent File usr lib  site packages rucio client metaclient.py line  in init super MetaClient self . init rucio host auth host account ca cert auth type creds timeout user agent File usr lib  site packages rucio client pingclient.py line  in init super PingClient self . init rucio host auth host account ca cert auth type creds timeout user agent File usr lib  site packages rucio client replicaclient.py line  in init super ReplicaClient self . init rucio host auth host account ca cert auth type creds timeout user agent File usr lib  site packages rucio client requestclient.py line  in init auth type creds timeout user agent File usr lib  site packages rucio client rseclient.py line  in init auth type creds timeout user agent File usr lib  site packages rucio client scopeclient.py line  in init super ScopeClient self . init rucio host auth host account ca cert auth type creds timeout user agent File usr lib  site packages rucio client didclient.py line  in init auth type creds timeout user agent File usr lib  site packages rucio client ruleclient.py line  in init super RuleClient self . init rucio host auth host account ca cert auth type creds timeout  wrapper File usr lib  site packages rucio client subscriptionclient.py line  in init super SubscriptionClient self . init rucio host auth host account ca cert auth type creds timeout user agent File usr lib  site packages rucio client lockclient.py line  in init auth type creds timeout user agent File usr lib  site packages rucio client configclient.py line  in init super ConfigClient self . init rucio host auth host account ca cert auth type creds timeout user agent File usr lib  site packages rucio client touchclient.py line  in init super TouchClient self . init rucio host auth host account ca cert auth type creds timeout user agent File usr lib  site packages rucio client importclient.py line  in init auth type creds timeout user agent File usr lib  site packages rucio client exportclient.py line  in init auth type creds timeout user agent File usr lib  site packages rucio client credentialclient.py line  in init auth type creds timeout user agent File usr lib  site packages rucio client baseclient.py line  in init self. authenticate File usr lib  site packages rucio client baseclient.py line  in authenticate self. get token File usr lib  site packages rucio client baseclient.py line  in get token raise CannotAuthenticate userpass authentication failed rucio.common.exception.CannotAuthenticate Cannot authenticate. Details userpass authentication failed Failed to sync! This may be a comparable issue to  but that seems to have been solved months ago so I am not really sure what to do here. Also I think the tests will anyhow fail when one copies the instructions from the manual instructions on the documentation page since that one actually sets the db user and password to rucio while the tests assume mysql root and secret respectively. Either fix the test or the setup so that the authentication works in the test of the dev container. Or tell me what I could be doing better. ", "2730": "add import of user data from CRIC ", "2727": "For the multi VO work we will need to be able to store data on VOs Add table vos with columns vo  char tag for the vo e.g SKA ATL CMS description full name description of vo e.g. Square Kilometre Array ATLAS email Add column vo to RSE table as FK into vos . This will change the unique constraint on RSE table. As  vos should be able to both have an RSE named the same thing ", "2725": "catch exceptions for example if distance gets created where the RSE got deleted before rollback and return error message already done because session handling already rollbacks if there is an exception sort protocols in order to compare the dictionaries in the tests fix tests test import export.py where destination RSE of distances are deleted before distance creation ", "2720": "In each token request the authentication core removes all already expired tokens of the account. For accounts e.g. panda pilot with many tokens this currently leads to deadlocks. It is not clear if there is some query degradation this is currently being investigated. This is the first time we are encountering this issue. To circumvent this issue we currently disabled the token expiration. The tokens lifetime is correctly validated so this only leads to tokens being archived for longer. We should change this expiration to use for update skip locked True or do the token cleanup entirely in a different process. ", "2717": "Currently the  URL signing code uses the hostname plus bucket name to index its credentials. The RSE name should be used for this instead. This will mean adding a new RSE name parameter to the get signed url function. ", "2715": "For  URL signing to work with non AWS hosts it is necessary to pass an endpoint URL when initialising  ", "2707": "Reaper crashes when it tries to delete a DIDs that is a constituent of an archive ", "2702": "This is a prerequisite for issue  Having the deletions occur in a short amount of time might overload the Reaper nodes and the sites. Add a spread period command line option that makes Atropos add a random factor to the lifetime of the rules. ", "2701": "This was first requested during the  CREM requires authentication . The justification is to avoid the partial existence of datasets when the Reaper decides to start deleting the replicas. Add a purge replicas command line option that makes Atropos update the rules accordingly. ", "2691": "Needed by Atropos to delete instead of secondarising when applying the Lifetime Model. Whitelist the option. ", "2681": "The  transfer tools in line  calls whereas the correct one would be policy config get policy permission ", "2678": "Traceback Details u cx Oracle.IntegrityError ORA  unique constraint ATLAS RUCIO.BAD PFNS PK violated Rucio exited with an unexpected unknown error please provide the traceback below to the developers. Traceback most recent call last File usr bin rucio admin line  in new funct return function args kwargs File usr bin rucio admin line  in declare temporary unavailable replicas client.add bad pfns pfns chunk reason args.reason state TEMPORARY UNAVAILABLE expires at expiration date File usr lib  site packages rucio client replicaclient.py line  in add bad pfns raise exc cls exc msg RucioException An unknown exception occurred. Details u cx Oracle.IntegrityError ORA  unique constraint ATLAS RUCIO.BAD PFNS PK violated ", "2672": "        CRITICAL Thread   Traceback most recent call last File usr lib  site packages rucio daemons conveyor submitter.py line  in submitter retry other fts retry other fts File usr lib  site packages rucio daemons conveyor submitter.py line  in get transfers failover schemes failover schemes File usr lib  site packages retrying.py line  in wrapped f return Retrying dargs dkw .call f args kw File usr lib  site packages retrying.py line  in call return attempt.get self. wrap exception File usr lib  site packages retrying.py line  in get six.reraise self.value  self.value  self.value  File usr lib  site packages retrying.py line  in call attempt Attempt fn args kwargs attempt number False File usr lib  site packages rucio db sqla session.py line  in new funct raise DatabaseException str error DatabaseException Database exception. Details cx Oracle.DatabaseError ORA  column ambiguously defined ", "2671": "CLI to declare replicas temporary unavailable ", "2664": "By default typ colection . This means that files are not returned. The example on this line is wrong thouhg. add filter type all ", "2661": "rucio download should return a clear message if a DID doesn t exist rucio download file.that.does.not.exist.txt        INFO Processing  item s for input        INFO Getting sources of DIDs        INFO Using main thread to download  file s        ERROR None of the requested files have been downloaded. ", "2656": "Wrong states on RSE avaiability state in list transfer requests and source replicas ", "2653": "The  rest api package has workarounds in their setup.py which invalidates the dependency selection of  package. Since there is now a new version of  this corrupts the installation of the dependency. Only possible workaround is to update the dependency version to have a consistent installation. In the medium term we should get rid of  rest api and  dependencies. ", "2652": "delete messages crashes when a message longer than  is provided. The problem is in session.bulk insert mappings MessageHistory messages . The payload that is provided by Hermes comes from retrieve messages but in case the payload registered in the DB is nolimit retrieve messages replaces payload with payload nolimit generating a Database exception DatabaseException Database exception. Details cx Oracle.DatabaseError ORA  can bind a LONG value only for insert into a LONG column SQL INSERT INTO atlas rucio.messages history id event type payload updated at created at VALUES id event type payload updated at created at parameters xxxx Background on this error at ", "2649": "Use of the RUCIO ACCOUNT environment variable should override the account specified in the Rucio configuration file. ", "2640": "List of activities the conveyor submitter should not submit. ", "2638": "The xcache URL prefixes stored in the config table need to be populated from the agis probe. ", "2633": "For the source throttling to work the src rse id of transfer requests needs to be filled when queuing the transfer. ", "2632": "For CTA RSEs the conveyor needs to submit multihop transfers. ", "2625": "Double requirement of psyftp blocks build of readthedocs. ", "2622": "Only the final  notification is being sent the intermediate ones are not ", "2620": "If the RSE is non deterministic and a pfn is provided then the client prints Upload with given pfn implies that no register is True except non deterministic RSEs and fails to register the replica. ", "2616": "It turns out that there is a file count issue with transferring rules in Rucio. A transfer rule which is attached to a dataset does not fulfill the file transfer correctly at least according to Rucio catalogue information itself. An example is given here XENONnT  Singularity osgvo xenon latest Development rucio list rules     tpc raw ID ACCOUNT SCOPE NAME STATE OK REPL STUCK RSE EXPRESSION COPIES EXPIRES UTC CREATED UTC  production     tpc raw REPLICATING    CNAF TAPE USERDISK         production     tpc raw OK    NIKHEF USERDISK         production     tpc raw OK    UC OSG USERDISK        This example shows a wrong number of attached files which is in replication state to a certain transfer rule. The wrong file count is responsible that the data set is still in replication mode. A check of the files which are attached to the data set shows XENONnT  Singularity osgvo xenon latest Development rucio list files     tpc raw SCOPE NAME GUID  FILESIZE EVENTS     tpc acquisition monitor data.pickles      ad   MB     tpc eventbuilder.log      ad   MB     tpc pax info.json      ad   kB     tpc trigger monitor data.zip      ad   MB     tpc           ad   GB     tpc           ad   GB     tpc           ad   GB     tpc           ad   GB     tpc           ad   GB     tpc           ad   GB     tpc           ad   GB     tpc           ad   GB     tpc           ad   GB     tpc           ad   GB     tpc           ad   GB     tpc           ad   GB     tpc           ad   GB     tpc           ad   GB     tpc           ad   GB     tpc           ad   GB     tpc           ad   GB     tpc           ad   GB     tpc           ad   GB     tpc           ad   GB     tpc           ad   GB     tpc           ad   GB     tpc           ad   MB We have only  files attached to the data set. And to be  sure the file replicas do also not look bad itself. Each file has three locations what means that the orginal file transfer was successful  files but we have  ghost files which do not vanish. XENONnT  Singularity osgvo xenon latest Development rucio list file replicas     tpc raw SCOPE NAME FILESIZE  RSE REPLICA     tpc acquisition monitor data.pickles  MB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc   acquisition monitor data.pickles     tpc acquisition monitor data.pickles  MB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc   acquisition monitor data.pickles     tpc acquisition monitor data.pickles  MB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc   acquisition monitor data.pickles     tpc eventbuilder.log  MB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc  cf eventbuilder.log     tpc eventbuilder.log  MB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc  cf eventbuilder.log     tpc eventbuilder.log  MB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc  cf eventbuilder.log     tpc pax info.json  kB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc bc  pax info.json     tpc pax info.json  kB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc bc  pax info.json     tpc pax info.json  kB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc bc  pax info.json     tpc trigger monitor data.zip  MB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc  eb trigger monitor data.zip     tpc trigger monitor data.zip  MB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc  eb trigger monitor data.zip     tpc trigger monitor data.zip  MB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc  eb trigger monitor data.zip     tpc       GB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc            tpc       GB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc            tpc       GB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc            tpc       GB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc  cc          tpc       GB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc  cc          tpc       GB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc  cc          tpc       GB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc            tpc       GB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc            tpc       GB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc            tpc       GB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc            tpc       GB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc            tpc       GB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc            tpc       GB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc  fd          tpc       GB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc  fd          tpc       GB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc  fd          tpc       GB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc cc           tpc       GB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc cc           tpc       GB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc cc           tpc       GB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc ce           tpc       GB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc ce           tpc       GB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc ce           tpc       GB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc            tpc       GB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc            tpc       GB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc            tpc       GB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc            tpc       GB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc            tpc       GB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc            tpc       GB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc            tpc       GB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc            tpc       GB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc            tpc       GB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc            tpc       GB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc            tpc       GB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc            tpc       GB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc  cf          tpc       GB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc  cf          tpc       GB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc  cf          tpc       GB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc            tpc       GB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc            tpc       GB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc            tpc       GB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc fe ad          tpc       GB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc fe ad          tpc       GB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc fe ad          tpc       GB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc cd           tpc       GB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc cd           tpc       GB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc cd           tpc       GB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc  ab          tpc       GB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc  ab          tpc       GB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc  ab          tpc       GB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc            tpc       GB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc            tpc       GB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc            tpc       GB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc            tpc       GB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc            tpc       GB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc            tpc       GB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc            tpc       GB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc            tpc       GB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc            tpc       GB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc            tpc       GB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc            tpc       GB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc            tpc       GB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc            tpc       GB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc            tpc       GB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc            tpc       GB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc  ce          tpc       GB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc  ce          tpc       GB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc  ce          tpc       MB  CNAF TAPE USERDISK srm storm fe archive.cr.cnaf.infn.it  srm  xenonTape rucio     tpc            tpc       MB  NIKHEF USERDISK srm   srm  dpm nikhef.nl home xenon.biggrid.nl rucio     tpc            tpc       MB  UC OSG USERDISK gsiftp xenon gridftp.grid.uchicago.edu  xenon rucio     tpc        This error is observed under Rucio server version  A simple solution would be to delete that particular transfer rule and create a new one after a while. But we see this error for  datasets with a certain amount of data which are already moved around. ", "2614": "Rucio currently supports only  authentication. The need is to create a username password authentication for the Web UI Files modified web ui common utils.py web ui main.py web ui static rucio.js . New files web ui static login.js web ui templates login.html ", "2612": "Main motivation to integrate OpenID Connect into Rucio can be found here As a first step Rucio needs to be able to use OIDC protocol as authentication service. It means redirect to an Identity Provider IdP e.g. IAM XDC to login there and if for the first time authorise Rucio to get user information then Rucio checks if the user is known and ask the IdP for an access and refresh tokens. In order to do that Rucio needs to implement a OIDC client cache tokens for their period of validity refresh tokens in case they expire using refresh tokens eventually on behalf of the user perform the requested downstream actions using these tokens implement a OIDC client in the authorisation scheme running on the auth server implement the OpenID information to be recognised and mapped to the rucio accounts identities implement access token refresh mechanism implement token validation checks if not already part of the above implement token caching ", "2611": "The throttler should be able to throttle based on source RSEs and not only destination RSEs. this requires prefilling of source RSEs in the requests as the information is not available yet and the possibility to release datasets after a defined waiting time a way to configure the different modes to switch between source destination and actvity all activities see  ", "2607": "If a site is blacklisted but has a huge number of requests in state Q it can lead to starvation on other RSEs. Exclude RSEs blacklisted for write from the conveyor loop ", "2606": "The STOMP specification indicates that connections should be closed using the DISCONNECT frame and a receipt. It seems that there are  places where STOMP connections are created but not closed explicitly using stomp.py s disconnect lib rucio core trace.py lib rucio core nongrid trace.py and lib rucio daemons hermes hermes.py . FWIW disconnect is used elsewhere bin rucio cache client lib rucio daemons cache consumer.py lib rucio daemons conveyor receiver.py and lib rucio daemons tracer kronos.py . ", "2601": "Currently the necromancer update up to  bad replicas states in one transaction Update by chunks ", "2600": "In WM the traces are sent by pilot. We still need to populate error msgs on file level there. More possibilities needs some discusssion with downloadclient developer. ", "2597": "Now that the travis tests are using  there are still some problems while setting up the tests  throwing a type error for the binary type in the identity table while setting up the accounts  incompatible helper scripts like tools sync rses.py ", "2592": "Separate the third party copy activity into a third party copy read and third party copy write activity. Also possivle is to use Read WAN for the source. Needs discussion ", "2591": "decomission mode failing after upgrading to sql alchemy bcasue it was not returning file size properly. add file size here. ", "2588": "The tests fail because they take too much time. Try to improve the performance of the oracle container. ", "2579": "pip install r tools pip requires client r tools pip requires r tools pip requires test in the dev Dockerfile breaks on next branch with ERROR Double requirement given pysftp  from r tools pip requires line  already in pysftp   from r tools pip requires client line  name pysftp ", "2576": "Building and running the dev environment on master branch results in a ImportError for an oracle module cx Oracle which should not be required as mysql is used. After installing it and running tools run test docker.sh I get the error message Cannot locate a  bit Oracle Client library libclntsh.so cannot open shared object file No such file or directory ", "2560": "unlike for the transfers the deletion event don t include the protocol which would be useful for monitoring. the protocol is available in a variable in the reaper loop where the messages are added. Just add it to the dictionary there. ", "2556": "There are two list rses requests. The RSE expressions use  and  instead of True and False for boolean values. The requests silently fail and consequently  Every one hour the elements on the DID page aren\u2019t properly populated and a refresh is required.  For new users the Dataset Replicas panel will never load. Update the RSE expressions and refactor the code around them as necessary. ", "2553": "For multi vo the internal representation of scope and account will need to be different from the external representation. The translations for these should be done in a consistent way and this can be prepared beforehand. Create a new type for each of scope and account. Convert incoming account names and scopes to these types in the API directory so that multi vo changes are more straight forward. If normal strings are used in core raise an error. ", "2548": "The docker image for the development instance is broken. The build fails at step RUN python setup.py develop with python can t open file setup.py Errno  No such file or directory ", "2545": "Storm protocol has been implemented in protocols. Now the rest of the code needs to be adapted. One known location is But there might be others. ", "2541": "The travis tests for  uses  in the container but inside in the rucio container where  is still used. Use build arguments in the dockerfile to install rucio with  or  depending on the python version in the travis container. ", "2536": "The docker demo container does not build due to a recently introduced bug in the Dockerfile. ", "2535": "When other replica is not available  takes the tape one. This is not ideal since we need  to be fast.  if rse attribute istape True  enabled set to False  this is considered automatically by background modes  needs to be introduced in manual mode ", "2528": "This is an R D to test the virtual placement VP idea. Service vpservice.cern.ch that for a given dataset DID returns an ordered list of n sites where it should be processed in case dataset is cache bound or other if it should be processed in a regular panda way. It works responds queries in  What we wanted to do is that  when panda asks Rucio for list of sites having the dataset replica Rucio in parallel to finding actual replicas also asks vpservice. If service returns other it returns to panda actual replicas. If service returns list of sites eg.   it should return to panda this list and some flag eg. VP true.  When panda receives reply with VP true it should send job to the hospital queue of the first site from the list and only if that site is in downtime send it to the second from the list.  Pilot will do correct thing since Rucio will give correct paths through caches. If this works out the virtual placement can be integrated into Rucio directly. ", "2525": "There is quite a lot of unused files in the repository. We should clean this up x bin Should be fine x doc atlasnote remove design remove x etc x Some cleanup in the folder netmodel ? x auditor needed? x docker only keep demo and dev x schemas json schemas need to check if use x supervisord remove or move to tools repo x web x ldap.cfg.template This should be moved to a tools repo once we have it x lib ok x tools x hadoop remove x patches nose remove x space usage ? x travis need x tox.ini can go ", "2521": "Files get assigned to previous replica s parent if the current lookup contains only a single replica. ", "2520": "While running the up and downgrades on the newest mysql version I found some constraints that are missing in the models.py RULES STATE CHK IDENTITIES TYPE CHK REQUESTS TYPE CHK REQUESTS STATE CHK REPLICAS STATE CHK BAD REPLICAS STATE CHK ", "2519": "LIGO frame files already follow an internal schema which determines their physical filename from the logical filename. We would like to be able to support this  algorithm in rucio. To support maximum flexibility it seems advantageous to do so via an external module. We propose adding a new method to the RSEDeterministicTranslation which supports a plug able  algorithm. I presume I don t have authority to assign this to anyone but mlassnig said he d take a look See this for a proposed starting point for this change. The implementation of the algorithm itself can be found I James propose keeping the implementation separate from the upstream rucio repository to give flexibility for handling future exceptions and adaptation to other data types. This  algorithm is then used by setting the following in the server rucio.cfg policy permission generic schema generic  algorithm default ligo ", "2518": "We currently only use this package for proxy delegation For the other  interaction we directly query the rest endpoints using python requests. It would be good to replace the proxy delegation to work without this dependency so we can remove it from our dependency file as well. ", "2514": "If no policy section exists in the rucio.cfg rucio exists with rucio v list rse attributes TAIWAN  TAPE STAGING        ERROR could not convert string to float True        ERROR Strange error No section policy ", "2511": "Storageless sites still need to be integrated with Rucio and require special treatment. Right now the attributes required for many replica lookup operations are available on the RSE level only. For sites without RSEs this functionality is thus lost. Introduce a new SiteAttributes model and extend the replica core to handle it properly. ", "2505": "Today    I didn t manage to build the demo anymore due to some problem with rucio builds and the current versions of libraries in pip. Specifically it seems  fails to builld error command gcc failed with exit status  \u001b   Command usr bin  u c import setuptools tokenize file tmp pip install EOjVou  setup.py f getattr tokenize open open file code f.read .replace r n n f.close exec compile code file exec install record tmp pip record  install record.txt single version externally managed compile failed with error code  in tmp pip install EOjVou  \u001b  rucio failed to build The command bin sh c pip install rucio rucio webui returned a non zero code  I attach the full output log of sudo docker compose file etc docker demo docker compose.yml up d Building rucio Step   FROM rucio rucio systemd   Step   ADD ca.repo etc yum.repos.d ca.repo Using cache  Step   RUN pip install upgrade pip Using cache  Step   RUN pip install upgrade setuptools Using cache  Step   RUN pip install ignore installed ipaddress Using cache  Step   RUN pip install rucio rucio webui Running in  \u001b  Python  will reach the end of its life on January   Please upgrade your Python as Python  won t be maintained after that date. A future version of pip will drop support for Python  \u001b  rucio Downloading  Collecting rucio webui Downloading  Collecting SQLAlchemy  from rucio Downloading  Collecting alembic  from rucio Downloading  Collecting Mako  from rucio Downloading  Collecting python editor  from rucio Downloading Collecting flup  from rucio Downloading  Collecting web.py  from rucio Downloading  Collecting python memcached  from rucio Downloading Collecting jsonschema  from rucio Downloading Collecting python dateutil  from rucio Downloading  Collecting pysftp  from rucio Downloading Collecting pycrypto  from rucio Downloading  Collecting   from rucio Downloading  Collecting stomp.py  from rucio Downloading  Collecting pygeoip  from rucio Downloading Collecting   from rucio Downloading Requirement already satisfied ipaddress  in usr lib  site packages from rucio  Collecting maxminddb  from rucio Downloading  Collecting cffi  from rucio Downloading  Collecting pycparser  from rucio Downloading  Collecting gcloud  from rucio Downloading  Collecting googleapis common protos  from rucio Downloading Collecting from rucio Downloading  Collecting pyOpenSSL  from rucio Downloading  Collecting cryptography  from rucio Downloading  Collecting   from rucio Downloading  Collecting protobuf  from rucio Downloading  Collecting grpcio  from rucio Downloading  Collecting   from rucio Downloading Collecting   from rucio Downloading  Collecting  modules  from rucio Downloading  Collecting rsa  from rucio Downloading Collecting retrying  from rucio Downloading Collecting redis  from rucio Downloading  Collecting numpy  from rucio Downloading  Collecting paramiko  from rucio Downloading  Collecting Flask  from rucio Downloading  Collecting idna  from rucio Downloading  Collecting  rest API  from rucio Downloading Collecting MyProxyClient  from rucio Downloading Collecting setuptools   from rucio Downloading  Collecting argcomplete   from rucio Downloading Collecting requests   from rucio Downloading  Collecting    from rucio Downloading  Collecting dogpile.cache   from rucio Downloading  Collecting nose  from rucio Downloading  Collecting tabulate   from rucio Downloading  Collecting    from rucio Downloading Collecting    from rucio Downloading Collecting python magic   from rucio Downloading Collecting six  from rucio Downloading Collecting pystatsd  from rucio Downloading Collecting   from rucio Downloading Collecting futures  from rucio Downloading Collecting boto  from rucio Downloading  Collecting MarkupSafe  from Mako  rucio Downloading Collecting docopt  from stomp.py  rucio Downloading Collecting google gax   from gcloud  rucio Downloading Collecting gax google pubsub    from gcloud  rucio Downloading Collecting grpc google pubsub    from gcloud  rucio Downloading Collecting gax google logging    from gcloud  rucio Downloading Collecting grpc google logging    from gcloud  rucio Downloading Collecting   from cryptography  rucio Downloading  Collecting pynacl  from paramiko  rucio Downloading  Collecting bcrypt  from paramiko  rucio Downloading  Collecting Werkzeug  from Flask  rucio Downloading  Collecting click  from Flask  rucio Downloading  Collecting itsdangerous  from Flask  rucio Downloading Collecting   from Flask  rucio Downloading  Collecting   from  rest API  rucio Using cached Requirement already satisfied pycurl  in usr   site packages from  rest API  rucio  Collecting chardet   from requests   rucio Downloading  Collecting certifi  from requests   rucio Downloading  Collecting python utils  from    rucio Downloading Collecting argparse  from pystatsd  rucio Downloading Collecting future  from google gax   gcloud  rucio Downloading  Collecting ply  from google gax   gcloud  rucio Downloading  Requirement already satisfied typing in usr lib  site packages from    rest API  rucio  Installing collected packages SQLAlchemy MarkupSafe Mako python editor six python dateutil alembic flup web.py python memcached  jsonschema idna  pycparser cffi  cryptography pynacl  bcrypt paramiko pysftp pycrypto python magic  docopt stomp.py pygeoip maxminddb chardet  certifi requests  setuptools protobuf googleapis common protos rsa  modules  futures grpcio future ply google gax grpc google pubsub  gax google pubsub  grpc google logging  gax google logging  gcloud pyOpenSSL retrying redis numpy Werkzeug click itsdangerous  Flask   rest API MyProxyClient argcomplete dogpile.cache nose tabulate python utils   argparse pystatsd boto rucio rucio webui Running setup.py install for SQLAlchemy started Running setup.py install for SQLAlchemy finished with status done Running setup.py install for Mako started Running setup.py install for Mako finished with status done Running setup.py install for python editor started Running setup.py install for python editor finished with status done Running setup.py install for alembic started Running setup.py install for alembic finished with status done Running setup.py install for flup started Running setup.py install for flup finished with status done Running setup.py install for web.py started Running setup.py install for web.py finished with status done Running setup.py install for  started Running setup.py install for  finished with status done Running setup.py install for pycparser started Running setup.py install for pycparser finished with status done Running setup.py install for pysftp started Running setup.py install for pysftp finished with status done Running setup.py install for pycrypto started Running setup.py install for pycrypto finished with status done Running setup.py install for  started Running setup.py install for  finished with status done Running setup.py install for docopt started Running setup.py install for docopt finished with status done Running setup.py install for stomp.py started Running setup.py install for stomp.py finished with status done Running setup.py install for maxminddb started Running setup.py install for maxminddb finished with status done Found existing installation chardet  Uninstalling chardet  Successfully uninstalled chardet  Running setup.py install for started Running setup.py install for finished with status done Found existing installation setuptools  Uninstalling setuptools  Successfully uninstalled setuptools  Running setup.py install for googleapis common protos started Running setup.py install for googleapis common protos finished with status done Running setup.py install for future started Running setup.py install for future finished with status done Running setup.py install for ply started Running setup.py install for ply finished with status done Running setup.py install for google gax started Running setup.py install for google gax finished with status done Running setup.py install for grpc google pubsub  started Running setup.py install for grpc google pubsub  finished with status done Running setup.py install for gax google pubsub  started Running setup.py install for gax google pubsub  finished with status done Running setup.py install for grpc google logging  started Running setup.py install for grpc google logging  finished with status done Running setup.py install for gax google logging  started Running setup.py install for gax google logging  finished with status done Running setup.py install for gcloud started Running setup.py install for gcloud finished with status done Running setup.py install for retrying started Running setup.py install for retrying finished with status done Running setup.py install for  started Running setup.py install for  finished with status error \u001b  ERROR Complete output from command usr bin  u c import setuptools tokenize file tmp pip install EOjVou  setup.py f getattr tokenize open open file code f.read .replace r n n f.close exec compile code file exec install record tmp pip record  install record.txt single version externally managed compile \u001b   ERROR running install running build running build py copying build lib.linux     copying  EVP.py build lib.linux     copying  threading.py build lib.linux     copying  Rand.py build lib.linux     copying   build lib.linux     copying  ftpslib.py build lib.linux     copying  Err.py build lib.linux     copying   build lib.linux     copying  DH.py build lib.linux     copying  EC.py build lib.linux     copying  DSA.py build lib.linux     copying  util.py build lib.linux     copying  BIO.py build lib.linux     copying  Engine.py build lib.linux     copying   build lib.linux     copying   build lib.linux     copying   build lib.linux     copying  six.py build lib.linux     copying  BN.py build lib.linux     copying   build lib.linux     copying  AuthCookie.py build lib.linux     copying  init .py build lib.linux     copying   build lib.linux     copying  callback.py build lib.linux     copying   build lib.linux     copying  SMIME.py build lib.linux     copying  RSA.py build lib.linux     creating build lib.linux     SSL copying  SSL Connection.py build lib.linux     SSL copying  SSL Checker.py build lib.linux     SSL copying  SSL Context.py build lib.linux     SSL copying  SSL cb.py build lib.linux     SSL copying  SSL timeout.py build lib.linux     SSL copying  SSL ssl dispatcher.py build lib.linux     SSL copying  SSL init .py build lib.linux     SSL copying  SSL SSLServer.py build lib.linux     SSL copying  SSL Cipher.py build lib.linux     SSL copying  SSL TwistedProtocolWrapper.py build lib.linux     SSL copying  SSL Session.py build lib.linux     SSL running build ext building   extension creating build temp.linux    creating build temp.linux    SWIG gcc pthread fno strict aliasing  g pipe Wall Wp D FORTIFY SOURCE  fexceptions fstack protector strong param ssp buffer size  grecord gcc switches  mtune generic D GNU SOURCE fPIC fwrapv DNDEBUG  g pipe Wall Wp D FORTIFY SOURCE  fexceptions fstack protector strong param ssp buffer size  grecord gcc switches  mtune generic D GNU SOURCE fPIC fwrapv fPIC I usr include  I tmp pip install EOjVou  SWIG c SWIG  wrap.c o build temp.linux    SWIG  wrap.o Wno deprecated declarations DTHREADING SWIG  wrap.c   warning PyUnicode FromString redefined enabled by default define PyUnicode FromString x PyString FromString x In file included from usr include  Python.h   from SWIG  wrap.c  usr include  unicodeobject.h   note this is the location of the previous definition define PyUnicode FromString  FromString SWIG  wrap.c   warning PyUnicode Format redefined enabled by default define PyUnicode Format x y PyString Format x y In file included from usr include  Python.h   from SWIG  wrap.c  usr include  unicodeobject.h   note this is the location of the previous definition define PyUnicode Format  Format SWIG  wrap.c In function wrap OPENSSL sk num SWIG  wrap.c   error unknown type name OPENSSL STACK OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error OPENSSL STACK undeclared first use in this function OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   note each undeclared identifier is reported only once for each function it appears in SWIG  wrap.c   error expected expression before token OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token  OPENSSL STACK  SWIG  wrap.c   warning implicit declaration of function OPENSSL sk num Wimplicit function declaration result int OPENSSL sk num struct stack st const  SWIG  wrap.c In function wrap OPENSSL sk value SWIG  wrap.c   error unknown type name OPENSSL STACK OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error OPENSSL STACK undeclared first use in this function OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token  OPENSSL STACK  SWIG  wrap.c   warning implicit declaration of function OPENSSL sk value Wimplicit function declaration result void OPENSSL sk value struct stack st const   SWIG  wrap.c   warning cast to pointer from integer of different size Wint to pointer cast result void OPENSSL sk value struct stack st const   SWIG  wrap.c In function wrap OPENSSL sk set SWIG  wrap.c   error unknown type name OPENSSL STACK OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error OPENSSL STACK undeclared first use in this function OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token  OPENSSL STACK  SWIG  wrap.c   warning implicit declaration of function OPENSSL sk set Wimplicit function declaration result void OPENSSL sk set   void const  SWIG  wrap.c   warning cast to pointer from integer of different size Wint to pointer cast result void OPENSSL sk set   void const  SWIG  wrap.c In function wrap OPENSSL sk new SWIG  wrap.c   error unknown type name OPENSSL sk compfunc OPENSSL sk compfunc  OPENSSL sk compfunc  SWIG  wrap.c   error OPENSSL sk compfunc undeclared first use in this function OPENSSL sk compfunc  OPENSSL sk compfunc  SWIG  wrap.c   error expected or before numeric constant OPENSSL sk compfunc  OPENSSL sk compfunc  SWIG  wrap.c   error unknown type name OPENSSL STACK OPENSSL STACK result  SWIG  wrap.c   error OPENSSL STACK undeclared first use in this function result OPENSSL STACK OPENSSL sk new  SWIG  wrap.c   error expected expression before token result OPENSSL STACK OPENSSL sk new  SWIG  wrap.c In function wrap OPENSSL sk new null SWIG  wrap.c   error unknown type name OPENSSL STACK OPENSSL STACK result  SWIG  wrap.c   error OPENSSL STACK undeclared first use in this function result OPENSSL STACK OPENSSL sk new null SWIG  wrap.c   error expected expression before token result OPENSSL STACK OPENSSL sk new null SWIG  wrap.c In function wrap OPENSSL sk free SWIG  wrap.c   error unknown type name OPENSSL STACK OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error OPENSSL STACK undeclared first use in this function OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token  OPENSSL STACK  SWIG  wrap.c   warning implicit declaration of function OPENSSL sk free Wimplicit function declaration OPENSSL sk free  SWIG  wrap.c In function wrap OPENSSL sk pop free SWIG  wrap.c   error unknown type name OPENSSL STACK OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error OPENSSL STACK undeclared first use in this function OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token  OPENSSL STACK  SWIG  wrap.c   warning implicit declaration of function OPENSSL sk pop free Wimplicit function declaration OPENSSL sk pop free   SWIG  wrap.c In function wrap OPENSSL sk deep copy SWIG  wrap.c   error unknown type name OPENSSL STACK OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error OPENSSL STACK undeclared first use in this function OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error unknown type name OPENSSL sk copyfunc OPENSSL sk copyfunc  OPENSSL sk copyfunc  SWIG  wrap.c   error OPENSSL sk copyfunc undeclared first use in this function OPENSSL sk copyfunc  OPENSSL sk copyfunc  SWIG  wrap.c   error expected or before numeric constant OPENSSL sk copyfunc  OPENSSL sk copyfunc  SWIG  wrap.c   error unknown type name OPENSSL sk freefunc OPENSSL sk freefunc  OPENSSL sk freefunc  SWIG  wrap.c   error OPENSSL sk freefunc undeclared first use in this function OPENSSL sk freefunc  OPENSSL sk freefunc  SWIG  wrap.c   error expected or before numeric constant OPENSSL sk freefunc  OPENSSL sk freefunc  SWIG  wrap.c   error result undeclared first use in this function OPENSSL STACK result  SWIG  wrap.c   error expected expression before token  OPENSSL STACK  SWIG  wrap.c   error expected expression before token result OPENSSL STACK OPENSSL sk deep copy struct stack st const    SWIG  wrap.c   warning variable  set but not used Wunused but set variable OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c In function wrap OPENSSL sk insert SWIG  wrap.c   error unknown type name OPENSSL STACK OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error OPENSSL STACK undeclared first use in this function OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token  OPENSSL STACK  SWIG  wrap.c   warning implicit declaration of function OPENSSL sk insert Wimplicit function declaration result int OPENSSL sk insert  void const   SWIG  wrap.c In function wrap OPENSSL sk delete SWIG  wrap.c   error unknown type name OPENSSL STACK OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error OPENSSL STACK undeclared first use in this function OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token  OPENSSL STACK  SWIG  wrap.c   warning implicit declaration of function OPENSSL sk delete Wimplicit function declaration result void OPENSSL sk delete   SWIG  wrap.c   warning cast to pointer from integer of different size Wint to pointer cast result void OPENSSL sk delete   SWIG  wrap.c In function wrap OPENSSL sk delete ptr SWIG  wrap.c   error unknown type name OPENSSL STACK OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error OPENSSL STACK undeclared first use in this function OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token  OPENSSL STACK  SWIG  wrap.c   warning implicit declaration of function OPENSSL sk delete ptr Wimplicit function declaration result void OPENSSL sk delete ptr  void const  SWIG  wrap.c   warning cast to pointer from integer of different size Wint to pointer cast result void OPENSSL sk delete ptr  void const  SWIG  wrap.c In function wrap OPENSSL sk find SWIG  wrap.c   error unknown type name OPENSSL STACK OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error OPENSSL STACK undeclared first use in this function OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token  OPENSSL STACK  SWIG  wrap.c   warning implicit declaration of function OPENSSL sk find Wimplicit function declaration result int OPENSSL sk find  void const  SWIG  wrap.c In function wrap OPENSSL sk find ex SWIG  wrap.c   error unknown type name OPENSSL STACK OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error OPENSSL STACK undeclared first use in this function OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token  OPENSSL STACK  SWIG  wrap.c   warning implicit declaration of function OPENSSL sk find ex Wimplicit function declaration result int OPENSSL sk find ex  void const  SWIG  wrap.c In function wrap OPENSSL sk push SWIG  wrap.c   error unknown type name OPENSSL STACK OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error OPENSSL STACK undeclared first use in this function OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token  OPENSSL STACK  SWIG  wrap.c   warning implicit declaration of function OPENSSL sk push Wimplicit function declaration result int OPENSSL sk push  void const  SWIG  wrap.c In function wrap OPENSSL sk unshift SWIG  wrap.c   error unknown type name OPENSSL STACK OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error OPENSSL STACK undeclared first use in this function OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token  OPENSSL STACK  SWIG  wrap.c   warning implicit declaration of function OPENSSL sk unshift Wimplicit function declaration result int OPENSSL sk unshift  void const  SWIG  wrap.c In function wrap OPENSSL sk shift SWIG  wrap.c   error unknown type name OPENSSL STACK OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error OPENSSL STACK undeclared first use in this function OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token  OPENSSL STACK  SWIG  wrap.c   warning implicit declaration of function OPENSSL sk shift Wimplicit function declaration result void OPENSSL sk shift  SWIG  wrap.c   warning cast to pointer from integer of different size Wint to pointer cast result void OPENSSL sk shift  SWIG  wrap.c In function wrap OPENSSL sk pop SWIG  wrap.c   error unknown type name OPENSSL STACK OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error OPENSSL STACK undeclared first use in this function OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token  OPENSSL STACK  SWIG  wrap.c   warning implicit declaration of function OPENSSL sk pop Wimplicit function declaration result void OPENSSL sk pop  SWIG  wrap.c   warning cast to pointer from integer of different size Wint to pointer cast result void OPENSSL sk pop  SWIG  wrap.c In function wrap OPENSSL sk zero SWIG  wrap.c   error unknown type name OPENSSL STACK OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error OPENSSL STACK undeclared first use in this function OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token  OPENSSL STACK  SWIG  wrap.c   warning implicit declaration of function OPENSSL sk zero Wimplicit function declaration OPENSSL sk zero  SWIG  wrap.c In function wrap OPENSSL sk set cmp func SWIG  wrap.c   error unknown type name OPENSSL STACK OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error OPENSSL STACK undeclared first use in this function OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error unknown type name OPENSSL sk compfunc OPENSSL sk compfunc  OPENSSL sk compfunc  SWIG  wrap.c   error OPENSSL sk compfunc undeclared first use in this function OPENSSL sk compfunc  OPENSSL sk compfunc  SWIG  wrap.c   error expected or before numeric constant OPENSSL sk compfunc  OPENSSL sk compfunc  SWIG  wrap.c   error expected before result OPENSSL sk compfunc result SWIG  wrap.c   error expected expression before token  OPENSSL STACK  SWIG  wrap.c   error result undeclared first use in this function result OPENSSL sk compfunc OPENSSL sk set cmp func   SWIG  wrap.c   error expected before OPENSSL sk set cmp func result OPENSSL sk compfunc OPENSSL sk set cmp func   SWIG  wrap.c   warning variable  set but not used Wunused but set variable OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c In function wrap OPENSSL sk dup SWIG  wrap.c   error unknown type name OPENSSL STACK OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error OPENSSL STACK undeclared first use in this function OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error result undeclared first use in this function OPENSSL STACK result  SWIG  wrap.c   error expected expression before token  OPENSSL STACK  SWIG  wrap.c   error expected expression before token result OPENSSL STACK OPENSSL sk dup struct stack st const  SWIG  wrap.c   warning variable  set but not used Wunused but set variable OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c In function wrap OPENSSL sk sort SWIG  wrap.c   error unknown type name OPENSSL STACK OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error OPENSSL STACK undeclared first use in this function OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token  OPENSSL STACK  SWIG  wrap.c   warning implicit declaration of function OPENSSL sk sort Wimplicit function declaration OPENSSL sk sort  SWIG  wrap.c In function wrap OPENSSL sk is sorted SWIG  wrap.c   error unknown type name OPENSSL STACK OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error OPENSSL STACK undeclared first use in this function OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token OPENSSL STACK  OPENSSL STACK  SWIG  wrap.c   error expected expression before token  OPENSSL STACK  SWIG  wrap.c   warning implicit declaration of function OPENSSL sk is sorted Wimplicit function declaration result int OPENSSL sk is sorted struct stack st const  SWIG  wrap.c In function wrap sk OPENSSL STRING new SWIG  wrap.c   error unknown type name sk OPENSSL STRING compfunc sk OPENSSL STRING compfunc  sk OPENSSL STRING compfunc  SWIG  wrap.c   error sk OPENSSL STRING compfunc undeclared first use in this function sk OPENSSL STRING compfunc  sk OPENSSL STRING compfunc  SWIG  wrap.c   error expected or before numeric constant sk OPENSSL STRING compfunc  sk OPENSSL STRING compfunc  SWIG  wrap.c In function wrap sk OPENSSL STRING pop free SWIG  wrap.c   error unknown type name sk OPENSSL STRING freefunc sk OPENSSL STRING freefunc  sk OPENSSL STRING freefunc  SWIG  wrap.c   error sk OPENSSL STRING freefunc undeclared first use in this function sk OPENSSL STRING freefunc  sk OPENSSL STRING freefunc  SWIG  wrap.c   error expected or before numeric constant sk OPENSSL STRING freefunc  sk OPENSSL STRING freefunc  SWIG  wrap.c In function wrap sk OPENSSL STRING find ex SWIG  wrap.c   warning implicit declaration of function CHECKED CONST PTR OF Wimplicit function declaration result int sk OPENSSL STRING find ex   In file included from usr include openssl crypto.h   from usr include openssl bio.h  from usr include openssl err.h  from SWIG  wrap.c  SWIG  wrap.c   error expected expression before struct result int sk OPENSSL STRING find ex   In file included from usr include openssl crypto.h   from usr include openssl bio.h  from usr include openssl err.h  from SWIG  wrap.c  SWIG  wrap.c   error expected expression before char result int sk OPENSSL STRING find ex   SWIG  wrap.c   warning variable  set but not used Wunused but set variable char  char  SWIG  wrap.c   warning variable  set but not used Wunused but set variable struct stack st OPENSSL STRING  struct stack st OPENSSL STRING  SWIG  wrap.c In function wrap sk OPENSSL STRING deep copy SWIG  wrap.c   error unknown type name sk OPENSSL STRING copyfunc sk OPENSSL STRING copyfunc  sk OPENSSL STRING copyfunc  SWIG  wrap.c   error sk OPENSSL STRING copyfunc undeclared first use in this function sk OPENSSL STRING copyfunc  sk OPENSSL STRING copyfunc  SWIG  wrap.c   error expected or before numeric constant sk OPENSSL STRING copyfunc  sk OPENSSL STRING copyfunc  SWIG  wrap.c   error unknown type name sk OPENSSL STRING freefunc sk OPENSSL STRING freefunc  sk OPENSSL STRING freefunc  SWIG  wrap.c   error sk OPENSSL STRING freefunc undeclared first use in this function sk OPENSSL STRING freefunc  sk OPENSSL STRING freefunc  SWIG  wrap.c   error expected or before numeric constant sk OPENSSL STRING freefunc  sk OPENSSL STRING freefunc  SWIG  wrap.c In function wrap sk OPENSSL STRING set cmp func SWIG  wrap.c   error\u001b   unknown type name sk OPENSSL STRING compfunc sk OPENSSL STRING compfunc  sk OPENSSL STRING compfunc  SWIG  wrap.c   error sk OPENSSL STRING compfunc undeclared first use in this function sk OPENSSL STRING compfunc  sk OPENSSL STRING compfunc  SWIG  wrap.c   error expected or before numeric constant sk OPENSSL STRING compfunc  sk OPENSSL STRING compfunc  SWIG  wrap.c   error expected before result sk OPENSSL STRING compfunc result SWIG  wrap.c   error result undeclared first use in this function result sk OPENSSL STRING compfunc sk OPENSSL STRING set cmp func   SWIG  wrap.c In function wrap sk OPENSSL CSTRING num SWIG  wrap.c   warning implicit declaration of function sk OPENSSL CSTRING num Wimplicit function declaration result int sk OPENSSL CSTRING num struct stack st OPENSSL CSTRING const  SWIG  wrap.c In function wrap sk OPENSSL CSTRING value SWIG  wrap.c   warning implicit declaration of function sk OPENSSL CSTRING value Wimplicit function declaration result char sk OPENSSL CSTRING value struct stack st OPENSSL CSTRING const   SWIG  wrap.c   warning cast to pointer from integer of different size Wint to pointer cast result char sk OPENSSL CSTRING value struct stack st OPENSSL CSTRING const   SWIG  wrap.c In function wrap sk OPENSSL CSTRING new SWIG  wrap.c   error unknown type name sk OPENSSL CSTRING compfunc sk OPENSSL CSTRING compfunc  sk OPENSSL CSTRING compfunc  SWIG  wrap.c   error sk OPENSSL CSTRING compfunc undeclared first use in this function sk OPENSSL CSTRING compfunc  sk OPENSSL CSTRING compfunc  SWIG  wrap.c   error expected or before numeric constant sk OPENSSL CSTRING compfunc  sk OPENSSL CSTRING compfunc  SWIG  wrap.c   warning implicit declaration of function sk OPENSSL CSTRING new Wimplicit function declaration result struct stack st OPENSSL CSTRING sk OPENSSL CSTRING new  SWIG  wrap.c   warning cast to pointer from integer of different size Wint to pointer cast result struct stack st OPENSSL CSTRING sk OPENSSL CSTRING new  SWIG  wrap.c In function wrap sk OPENSSL CSTRING new null SWIG  wrap.c   warning implicit declaration of function sk OPENSSL CSTRING new null Wimplicit function declaration result struct stack st OPENSSL CSTRING sk OPENSSL CSTRING new null SWIG  wrap.c   warning cast to pointer from integer of different size Wint to pointer cast result struct stack st OPENSSL CSTRING sk OPENSSL CSTRING new null SWIG  wrap.c In function wrap sk OPENSSL CSTRING free SWIG  wrap.c   warning implicit declaration of function sk OPENSSL CSTRING free Wimplicit function declaration sk OPENSSL CSTRING free  SWIG  wrap.c In function wrap sk OPENSSL CSTRING zero SWIG  wrap.c   warning implicit declaration of function sk OPENSSL CSTRING zero Wimplicit function declaration sk OPENSSL CSTRING zero  SWIG  wrap.c In function wrap sk OPENSSL CSTRING delete SWIG  wrap.c   warning implicit declaration of function sk OPENSSL CSTRING delete Wimplicit function declaration result char sk OPENSSL CSTRING delete   SWIG  wrap.c   warning cast to pointer from integer of different size Wint to pointer cast result char sk OPENSSL CSTRING delete   SWIG  wrap.c In function wrap sk OPENSSL CSTRING delete ptr SWIG  wrap.c   warning implicit declaration of function sk OPENSSL CSTRING delete ptr Wimplicit function declaration result char sk OPENSSL CSTRING delete ptr  char const  SWIG  wrap.c   warning cast to pointer from integer of different size Wint to pointer cast result char sk OPENSSL CSTRING delete ptr  char const  SWIG  wrap.c In function wrap sk OPENSSL CSTRING push SWIG  wrap.c   warning implicit declaration of function sk OPENSSL CSTRING push Wimplicit function declaration result int sk OPENSSL CSTRING push  char const  SWIG  wrap.c In function wrap sk OPENSSL CSTRING unshift SWIG  wrap.c   warning implicit declaration of function sk OPENSSL CSTRING unshift Wimplicit function declaration result int sk OPENSSL CSTRING unshift  char const  SWIG  wrap.c In function wrap sk OPENSSL CSTRING pop SWIG  wrap.c   warning implicit declaration of function sk OPENSSL CSTRING pop Wimplicit function declaration result char sk OPENSSL CSTRING pop  SWIG  wrap.c   warning cast to pointer from integer of different size Wint to pointer cast result char sk OPENSSL CSTRING pop  SWIG  wrap.c In function wrap sk OPENSSL CSTRING shift SWIG  wrap.c   warning implicit declaration of function sk OPENSSL CSTRING shift Wimplicit function declaration result char sk OPENSSL CSTRING shift  SWIG  wrap.c   warning cast to pointer from integer of different size Wint to pointer cast result char sk OPENSSL CSTRING shift  SWIG  wrap.c In function wrap sk OPENSSL CSTRING pop free SWIG  wrap.c   error unknown type name sk OPENSSL CSTRING freefunc sk OPENSSL CSTRING freefunc  sk OPENSSL CSTRING freefunc  SWIG  wrap.c   error sk OPENSSL CSTRING freefunc undeclared first use in this function sk OPENSSL CSTRING freefunc  sk OPENSSL CSTRING freefunc  SWIG  wrap.c   error expected or before numeric constant sk OPENSSL CSTRING freefunc  sk OPENSSL CSTRING freefunc  SWIG  wrap.c   warning implicit declaration of function sk OPENSSL CSTRING pop free Wimplicit function declaration sk OPENSSL CSTRING pop free   SWIG  wrap.c In function wrap sk OPENSSL CSTRING insert SWIG  wrap.c   warning implicit declaration of function sk OPENSSL CSTRING insert Wimplicit function declaration result int sk OPENSSL CSTRING insert  char const   SWIG  wrap.c In function wrap sk OPENSSL CSTRING set SWIG  wrap.c   warning implicit declaration of function sk OPENSSL CSTRING set Wimplicit function declaration result char sk OPENSSL CSTRING set   char const  SWIG  wrap.c   warning cast to pointer from integer of different size Wint to pointer cast result char sk OPENSSL CSTRING set   char const  SWIG  wrap.c In function wrap sk OPENSSL CSTRING find SWIG  wrap.c   warning implicit declaration of function sk OPENSSL CSTRING find Wimplicit function declaration result int sk OPENSSL CSTRING find  char const  SWIG  wrap.c In function wrap sk OPENSSL CSTRING find ex SWIG  wrap.c   warning implicit declaration of function sk OPENSSL CSTRING find ex Wimplicit function declaration result int sk OPENSSL CSTRING find ex  char const  SWIG  wrap.c In function wrap sk OPENSSL CSTRING sort SWIG  wrap.c   warning implicit declaration of function sk OPENSSL CSTRING sort Wimplicit function declaration sk OPENSSL CSTRING sort  SWIG  wrap.c In function wrap sk OPENSSL CSTRING is sorted SWIG  wrap.c   warning implicit declaration of function sk OPENSSL CSTRING is sorted Wimplicit function declaration result int sk OPENSSL CSTRING is sorted struct stack st OPENSSL CSTRING const  SWIG  wrap.c In function wrap sk OPENSSL CSTRING dup SWIG  wrap.c   warning implicit declaration of function sk OPENSSL CSTRING dup Wimplicit function declaration result struct stack st OPENSSL CSTRING sk OPENSSL CSTRING dup struct stack st OPENSSL CSTRING const  SWIG  wrap.c   warning cast to pointer from integer of different size Wint to pointer cast result struct stack st OPENSSL CSTRING sk OPENSSL CSTRING dup struct stack st OPENSSL CSTRING const  SWIG  wrap.c In function wrap sk OPENSSL CSTRING deep copy SWIG  wrap.c   error unknown type name sk OPENSSL CSTRING copyfunc sk OPENSSL CSTRING copyfunc  sk OPENSSL CSTRING copyfunc  SWIG  wrap.c   error sk OPENSSL CSTRING copyfunc undeclared first use in this function sk OPENSSL CSTRING copyfunc  sk OPENSSL CSTRING copyfunc  SWIG  wrap.c   error expected or before numeric constant sk OPENSSL CSTRING copyfunc  sk OPENSSL CSTRING copyfunc  SWIG  wrap.c   error unknown type name sk OPENSSL CSTRING freefunc sk OPENSSL CSTRING freefunc  sk OPENSSL CSTRING freefunc  SWIG  wrap.c   error sk OPENSSL CSTRING freefunc undeclared first use in this function sk OPENSSL CSTRING freefunc  sk OPENSSL CSTRING freefunc  SWIG  wrap.c   error expected or before numeric constant sk OPENSSL CSTRING freefunc  sk OPENSSL CSTRING freefunc  SWIG  wrap.c   warning implicit declaration of function sk OPENSSL CSTRING deep copy Wimplicit function declaration result struct stack st OPENSSL CSTRING sk OPENSSL CSTRING deep copy struct stack st OPENSSL CSTRING const    SWIG  wrap.c   warning cast to pointer from integer of different size Wint to pointer cast result struct stack st OPENSSL CSTRING sk OPENSSL CSTRING deep copy struct stack st OPENSSL CSTRING const    SWIG  wrap.c In function wrap sk OPENSSL CSTRING set cmp func SWIG  wrap.c   error unknown type name sk OPENSSL CSTRING compfunc sk OPENSSL CSTRING compfunc  sk OPENSSL CSTRING compfunc  SWIG  wrap.c   error sk OPENSSL CSTRING compfunc undeclared first use in this function sk OPENSSL CSTRING compfunc  sk OPENSSL CSTRING compfunc  SWIG  wrap.c   error expected or before numeric constant sk OPENSSL CSTRING compfunc  sk OPENSSL CSTRING compfunc  SWIG  wrap.c   error expected before result sk OPENSSL CSTRING compfunc result SWIG  wrap.c   error result undeclared first use in this function result sk OPENSSL CSTRING compfunc sk OPENSSL CSTRING set cmp func   SWIG  wrap.c   error expected before sk OPENSSL CSTRING set cmp func result sk OPENSSL CSTRING compfunc sk OPENSSL CSTRING set cmp func   SWIG  wrap.c   warning variable  set but not used Wunused but set variable struct stack st OPENSSL CSTRING  struct stack st OPENSSL CSTRING  SWIG  wrap.c In function wrap sk OPENSSL BLOCK new SWIG  wrap.c   error unknown type name sk OPENSSL BLOCK compfunc sk OPENSSL BLOCK compfunc  sk OPENSSL BLOCK compfunc  SWIG  wrap.c   error sk OPENSSL BLOCK compfunc undeclared first use in this function sk OPENSSL BLOCK compfunc  sk OPENSSL BLOCK compfunc  SWIG  wrap.c   error expected or before numeric constant sk OPENSSL BLOCK compfunc  sk OPENSSL BLOCK compfunc  SWIG  wrap.c In function wrap sk OPENSSL BLOCK pop free SWIG  wrap.c   error unknown type name sk OPENSSL BLOCK freefunc sk OPENSSL BLOCK freefunc  sk OPENSSL BLOCK freefunc  SWIG  wrap.c   error sk OPENSSL BLOCK freefunc undeclared first use in this function sk OPENSSL BLOCK freefunc  sk OPENSSL BLOCK freefunc  SWIG  wrap.c   error expected or before numeric constant sk OPENSSL BLOCK freefunc  sk OPENSSL BLOCK freefunc  In file included from usr include openssl crypto.h   from usr include openssl bio.h  from usr include openssl err.h  from SWIG  wrap.c  SWIG  wrap.c In function wrap sk OPENSSL BLOCK find ex SWIG  wrap.c   error expected expression before struct result int sk OPENSSL BLOCK find ex   In file included from usr include openssl crypto.h   from usr include openssl bio.h  from usr include openssl err.h  from SWIG  wrap.c  SWIG  wrap.c   error expected expression before void result int sk OPENSSL BLOCK find ex   SWIG  wrap.c   warning variable  set but not used Wunused but set variable struct stack st OPENSSL BLOCK  struct stack st OPENSSL BLOCK  SWIG  wrap.c In function wrap sk OPENSSL BLOCK deep copy SWIG  wrap.c   error unknown type name sk OPENSSL BLOCK copyfunc sk OPENSSL BLOCK copyfunc  sk OPENSSL BLOCK copyfunc  SWIG  wrap.c   error sk OPENSSL BLOCK copyfunc undeclared first use in this function sk OPENSSL BLOCK copyfunc  sk OPENSSL BLOCK copyfunc  SWIG  wrap.c   error expected or before numeric constant sk OPENSSL BLOCK copyfunc  sk OPENSSL BLOCK copyfunc  SWIG  wrap.c   error unknown type name sk OPENSSL BLOCK freefunc sk OPENSSL BLOCK freefunc  sk OPENSSL BLOCK freefunc  SWIG  wrap.c   error sk OPENSSL BLOCK freefunc undeclared first use in this function sk OPENSSL BLOCK freefunc  sk OPENSSL BLOCK freefunc  SWIG  wrap.c   error expected or before numeric constant sk OPENSSL BLOCK freefunc  sk OPENSSL BLOCK freefunc  SWIG  wrap.c In function wrap sk OPENSSL BLOCK set cmp func SWIG  wrap.c   error unknown type name sk OPENSSL BLOCK compfunc sk OPENSSL BLOCK compfunc  sk OPENSSL BLOCK compfunc  SWIG  wrap.c   error sk OPENSSL BLOCK compfunc undeclared first use in this function sk OPENSSL BLOCK compfunc  sk OPENSSL BLOCK compfunc  SWIG  wrap.c   error expected or before numeric constant sk OPENSSL BLOCK compfunc  sk OPENSSL BLOCK compfunc  SWIG  wrap.c   error expected before result sk OPENSSL BLOCK compfunc result SWIG  wrap.c   error result undeclared first use in this function result sk OPENSSL BLOCK compfunc sk OPENSSL BLOCK set cmp func   SWIG  wrap.c At top level SWIG  wrap.c   warning BIO meth free defined but not used Wunused function BIO meth free BIO METHOD meth error command gcc failed with exit status  \u001b   Command usr bin  u c import setuptools tokenize file tmp pip install EOjVou  setup.py f getattr tokenize open open file code f.read .replace r n n f.close exec compile code file exec install record tmp pip record  install record.txt single version externally managed compile failed with error code  in tmp pip install EOjVou  Service rucio failed to build The command bin sh c pip install rucio rucio webui returned a non zero code  ", "2502": "I tried the docker demo on Ubuntu  and it fails during the build process due to errors in the docker file namely this line I think neither sudo nor the plus sign should be in that line. It worked after removing those remove of sudo and the sign from ", "2501": " is affected by we need to upgrade it to   ", "2500": "Currently name id are interchangeable for RSEs however for a multi VO setup it will be important to only use the id in core methods for uniqueness. The API directory will be changed so that any rse passed into the core is done using the id. The methods in core will be edited to remove dependancy on rse name as inputs. ", "2498": "Standard gridftp do not support multiple checksum algorithms without the installation of additional plugins. This caused some hassle when configuring Rucio to operate in a context in which vanilla gridftp offered only  StoRM gridftp offered only  but required VOMS auth where provided. The problem was related to the fact that the Rucio client writes to the DB entry both checksums  and  hence any following operation on the data tried to check both checksums failing alternatively depending on which gridftp was used. Possible modification Several option have been partially discussed Modify the Rucio Client in order to avoid the upload in the DB of unsupported checksums e.g. adding support for a runtime flag such checksums   . This solution is weak and fast to implement but delegates the handling of the RSE checksum compatibility to the uploader being it human or automatic Insert in rucio.cfg a global list of supported checksums. This solution is more elegant and the setup is explicit but making such selection global might be an issue in case of orthogonal compatibilities Add to the DB an RSE field able to record a per RSE checksum compatibility list. Such information can then be used in the Rucio demons to avoid unsupported checks. Discussion This issue is aimed at triggering some discussion prior to the implementation of one of such solutions. ", "2496": "It currently does not work due to missing  . ", "2494": "SQLAlchemy versions  suffer a SQL Injection vulnerability. Change dependency to a version  ", "2493": "Sandbox escape vulnerability in  . This affects versions before  and we are currently using  Verify that we still need  and upgrade dependency to at least  ", "2488": "State transition COPYING to UNAVAILABLE Replicas should get epoche tombstone. ", "2485": "", "2482": "A daemon that automatically configures FTS storage settings depending on specific transfer failures concerning a FTS storage its settings will be set to reduce these transfer failures. ", "2480": "There are several compiling issues observed when installing Rucio in Python  These errors are coming mainly from   translations so far. An error in the encoding  is observed when calculating the hash for determination of the final file path. s are necessary in storm.py and protocol.py are necessary. ", "2479": "Tests in lib rucio tests test import export.py sometimes fail because of a list equality check. Change to sets to prevent different item orders to cause a test fail. ", "2469": "Cf. Reaper s proposal Global performance All reaper daemon instances should have a steady deletion performance. A situation where some of them are busy and some are idle should not occur if there is a deletion backlog to operate on. Protection of storage Measures need to be in place to protect the storage from deletion overload. It should be possible to specify the maximum number of threads concurrently interacting with a storage element. Intelligent distribution of workload The global deletion workload needs to be distributed intelligently. RSEs having a large deletion backlog need to be handled with a larger priority than RSEs with a very small backlog. At the same time starvation of RSEs cannot happen either. The principle is to have a pool of threads available. The method is then to assign dynamically a list of RSEs to each thread with several constraints max threads per RSE . This implementation is based on several hash functions and introduced feature flags to roll out gradually the reaper in the new auto mode in a backward compatible way and with reapers running without this mode . add auto mode for work automatically on RSE flagged with the reserved RSE attribute tombstone e.g. rucio reaper auto total workers  threads per worker  Exclude RSE flagged with the reserved RSE attribute tombstone in the non auto mode Add support for the greedy reserved RSE attribute in the auto mode Add dry mode option to check the logic without doing deletion e.g. rucio reaper auto dry mode total workers  threads per worker  add dynamic mode to consider only the RSEs with something to delete add support for several RSE threads mapping function map function list rses for thread hash and list rses for thread sequential . ", "2468": "from rucio.client.client import Client c Client print c.list replicas scope user.mlassnig name afasf metalink True metalink ", "2465": "In .travis.yml commands like then nosetests v lib rucio tests test clients.py nosetests v lib rucio tests test bin rucio.py fi dont return  in case of a failing tests if the last command returns  Found by  Check return codes separately ", "2462": "Somehow the columns created at and updated at dont get automatically created on the table did meta while using the models.py . Found in  ", "2460": "pip requires client setuptools   setuptools   argparse  python version  REMOVE requests   requests         dogpile.cache   dogpile.cache   boto  python version  boto         six  six        pip requires SQLAlchemy  SQLAlchemy  alembic  alembic  Mako  Remove it s a dependency from Alembic and should not be specified separately python editor  \u2757\ufe0f Remove I am not sure why we even need this flup  \u2757\ufe0f Do we still need this??? Comment says needed for deployment of web.py in but we don t use this anywhere? jsonschema  jsonschema  python dateutil  python dateutil  pysftp  \u2757\ufe0f This is used by sftp protocol. But in that case it should be part of pip requires client Also forces installation of paramikoi and pycrypto   \u2757\ufe0f This only seems to be used to test  protocol. In that case it should be part of pip requires test stomp.py  stomp.py  pygeoip  Remove ipaddress  Just a dependency of  should be removed? maxminddb  Dependency of  should be removed too cffi  cffi  \u2757\ufe0f Do we still need this? pycparser  Dependency of cffi remove gcloud  \u2757\ufe0f Where do we actually use this in the code? rsa  \u2757\ufe0f needed??? googleapis common protos  Dependency of gcloud should be removed \u2757\ufe0f Where do we still use this in the code? pyOpenSSL  Dependency of MyProxyClient should be removed cryptography  Dependency of PyOpenssl should be removed protobuf  Dependency of gcloud Remove grpcio  \u2757\ufe0f Do we use this anywhere???   Dependency of grpcio Remove   Dependency of  remove  modules  Dependency of  remove redis  redis  numpy  numpy  idna  Dependency of requests remove pip requires test pinocchio  Not used remove Paste  Paste    Not needed anymore since we drop  coverage  coverage  Sphinx  Sphinx  Last  compatible version sphinx rtd theme  sphinx rtd theme    Remove Pygments  Pygments  virtualenv  virtualenv  tox  tox  Can possibly be dropped pytest  Only needed by unused script Remove xmltodict  xmltodict  pytz  pytz  pyflakes  pycodestyle and pylint will be upgraded in a separate PR! ", "2456": "The option is not propagated correctly. Thus the default False value is used. ", "2446": "Yesterday a new release  of  binary was published. With this release the tests do not run through as exceptions are handled differently with our current version of sqlalchemy. For now we will fix setup rucio.py to not install the  version thus  binary   Once we update sqlalchemy to a newer version this can be relaxed. ", "2445": "Actual storage deletion loop. ", "2444": "Creating the list of RSEs based on thresholds epoche replicas and greedy mode. list unlocked replicas changes needs to change too for SKIP LOCKED queries. ", "2443": "", "2440": "The progress class is calculated like int float replicating locks float total locks   It should be calculated like int float total locks replicating locks float total locks   ", "2436": "Currently sqlalchemy creates postgres ENUM columns instead of check constraints such as in Oracle . It might be good to change this to check constraints too to have the same behaviour as in oracle. It needs to be understood if there is any performance impact due to this. Do we need to change any of the alembic upgrade downgrade scripts? ", "2434": "The ChangeLog seems to be more of a COPYRIGHT file. Remove or rename ChangeLog. ", "2433": "from rucio.client import Client rucio client Client filename test    scope user.ddmadin rsename UNI FREIBURG DATADISK rucio client.update replicas states rsename scope scope name filename returns rucio.common.exception.RucioException An unknown exception occurred. Details no error information passed status code  internal server error server error o    but the site is ok and I can download the replica using gfal. ", "2432": "        CRITICAL Traceback most recent call last File usr lib  site packages rucio daemons atropos atropos.py line  in atropos rses parse expression rule.rse expression File usr lib  site packages rucio db sqla session.py line  in new funct result function args kwargs File usr lib  site packages rucio core rse expression parser.py line  in parse expression raise InvalidRSEExpression RSE Expression resulted in an empty set. InvalidRSEExpression Provided RSE expression is considered invalid. Details RSE Expression resulted in an empty set. Caused by trying to process rules that still use the old convention regarding boolean attributes. Add an exception handler to log and skip the rule. ", "2421": "I am trying to use the latest mysql version  which results in multiple erros when trying to setup the schema via running the tests in the docker dev environment. This is needed for  problem with loading the authentication plugin Unable to load authentication plugin caching  password . solved by default authentication plugin mysql native password too long primary keys Specified key was too long max key length is  bytes solved by character set server  syntax error in setting up the rules table You have an error in your SQL syntax check the manual that corresponds to your MySQL server version for the right syntax to use near IS NOT NULL solved by escaping missing index while applying upgrade  Failed to add the foreign key constraint. Missing index for constraint SOURCES REPLICA FK in the referenced table replicas SQL u ALTER TABLE sources ADD CONSTRAINT SOURCES REPLICA FK FOREIGN KEY scope name rse id REFERENCES replicas scope name rse id solved by changing the primary key while upgrading the replicas table ", "2413": "", "2412": "This issue is an overview ticket for the Reaper  re design. All ideas comments are collected in the design Re Design work packages x Changes in heartbeat mode   x Outer loop Preparation of the list of RSEs to delete on  cserf x Inner loop Actual storage interaction and deletion  tbeerman x Documentation x Monitoring Internal External Besides these general architecture changes the overhaul should also address the following issues x mode should be an RSE attribute  x Protection of sources too strict in the reaper  ", "2411": "From our original plan For third party copy  supports  as a protocol and can do the URL signing itself. Like for Google Cloud Storage the credential will be stored in the  server additionally. The replica core and transfer daemon need to skip URL signatures if the request is for the transfer daemon but correctly sign for the deletion daemon. There is a legacy protocol implementation in Rucio which should be removed in favour of this common workflow . Having looked at the code it should be relatively straightforward to add a call to get the signed URL if required for the RSE to the reaper. The core credential code can already sign DELETE URLs for GCP  and Swift. The legacy code could then be removed. I am not sure whether the planned rewrite of the reaper will affect this. ", "2408": "We see in many cases in traces just following on the output stageIn with API failed None of the requested files have been downloaded. which is not explanatroy enough. Pilot propagates to traces an exception from Rucio. Fristly we need to know whether this happens only for xrootd protocols and how to increase the verbosity. ", "2403": "bash  rucio get did meta manda manda  hours.tar       but bash  rucio list dids by meta scope manda   bash  rucio list dids by meta   bash  ", "2402": "When no scheme is specified in the configuration the conveyor fails to find a common scheme for the source and destination files here gsiftp         CRITICAL Exception happened when trying to get transfer for request  Traceback most recent call last File usr local lib  dist packages rucio core transfer.py line  in get transfer requests and source replicas schemes add compatible schemes schemes matching scheme  allowed schemes current schemes File usr local lib  dist packages rucio core transfer.py line  in add compatible schemes if scheme in allowed schemes TypeError argument of type NoneType is not iterable The respective rules stay in the STUCK state when asked for reevaluation         INFO rule repairer   Repairing rule          INFO Rule     state STUCK ", "2399": "the checksum is not yet checked after downloading a file. This is especially important for pilot. make it False by default ", "2398": "From Stephane when I introduce a typo in the RSE name the error message which I expect RSE does not exist is very complicated bash  rucio v download rse  DATADISK            INFO Processing  item s for input        DEBUG Processing item            DEBUG RSE Expression  DATADISK istape False        DEBUG Splitted DID            DEBUG  DIDs after processing input        DEBUG Processing resolve archives True name   did     rse  DATADISK istape False no subdir False nrandom None transfer timeout  scope   type u FILE force scheme None base dir .        DEBUG ?xml version  encoding UTF  ? metalink xmlns urn ietf params xml ns metalink        DEBUG Traceback most recent call last File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  bin rucio line  in new funct return function args kwargs File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  bin rucio line  in download result download client.download dids items args.ndownloader trace pattern File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  lib  site packages rucio client downloadclient.py line  in download dids input items self. prepare items for download items File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  lib  site packages rucio client downloadclient.py line  in prepare items for download files with pfns self. parse list replica metalink metalink str File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  lib  site packages rucio client downloadclient.py line  in parse list replica metalink raise error ExpatError no element found line  column         ERROR no element found line  column         ERROR Strange error No section policy This should raise RSENotFound . ", "2390": "python config.set throttler release strategy fifo config.set throttler release strategy grouped fifo will result in a database duplicate exception because config.set checks if there is already a value which will be False if you try to set a new value under the expiration time because it got set to False with the first command. change the has option check in config.set to has option use cache False ", "2379": "we shouldn t publish auth token even at debug level in clients remove or change following line ", "2378": "I recently submitted a PR during which I ran into an error while executing . tools submit pull request as mentioned in the Contribution The error was Traceback most recent call last File . tools submit pull request line  in module import commands ModuleNotFoundError No module named commands I use Arch linux where the default python version is  A quick google search led me to Arch s according to which the commands module is unavailable in  thus for submitting a PR what actually worked was  . tools submit pull request Since  will not be maintained post I would suggest changing the default implementation for  compatibility in the longer run that would be required anyway. Using subprocess module instead of commands in ", "2375": "Improve documentation make it easier to follow Edit documentation files apply formatting and grammatical edits ", "2370": "while installing ipaddress with the demo docker build pip tries to uninstall the previous version of ipaddress.Which results in this error Cannot uninstall ipaddress . It is a distutils installed project and thus ", "2367": "the demo does not build in some unconfigured systems as by default pip version in docker is  which needs to be update gives rise to error you are using pip version xyz.please upgrade while installation. to the demo Dockerfile ", "2363": "The RSE field in the list replicas reply is still used by the pilot. In the case of multiple different DIDs requested in a single list replicas call the sorting per RSE will only be correct for the last RSE if there are multiple potential RSEs. ", "2362": "rucio version rucio  rucio download               INFO Processing  item s for input        INFO Getting sources of DIDs        ERROR d format a number is required not NoneType ", "2359": "We need to adapt the docker compose function so that it can built built under proxy given by system environment variables. We also need to supply these environment variables while executing the docker compose function. ", "2355": "In case the rule deletion in the undertaker raises nowait DB error the undertaker just retries the same did right now. Instead the undertaker should pause these dids for   and only retry then. ", "2352": "Conveyor Submitter continues to submit transfers jobs even for sites blacklisted for write ", "2344": "The addition of the check accept header wrapper decorator method in the flask rest api blocks the auto documentation of the GET endpoints. These endpoints mostly GET are now removed from readthedocs. Needs to be fixed. ", "2336": "To make the documentation free of grammatical errors Edit Documentation files and fix the grammatical errors. ", "2327": "small things to change here and there rse expression   True False ", "2322": "The documentation of rucio admin account add does not specify the acceptable values for type . ", "2319": "During yesterday\u2019s CREM meeting it was agreed to create a new physics group phys hdbs . The probe that automatically adds identities based on information from VOMS needs to be updated. ", "2315": "Currently Rucio only supports local quotas. E.g. an account limit for an account on a specific RSE. The idea of this feature would be to allow quotas on a set of RSEs. E.g. an aggregated limit for an account on all RSEs in the UK country uk This requires changes in the replication rules quota checking and a whole system around calculating managing these global quotas in an efficient way. ", "2314": "Also see Currently we force an xrdcp based download to stream the content of a zip file. In this case the command is build like this xrdcp vf root   dpm  home atlas atlasdatadisk rucio         z   file tmp walkerr            The file part seems to create problems for xrdcp and puts the file in a random location on disk. Remove the file prefix for the local destination. ", "2313": "Currently list replicas orders replicas based on their protocol priorities. For zip replicas this is not efficient though as root offers a more efficient way to access the constituent files in the zip. list replicas should prioritise root protocol for zip replicas over all other protocols. ", "2306": "Login to Rucio WebUI with SSO service. E.g. cern SSO social login etc. ", "2305": "Add history plot on account rse usage ", "2304": "Many operations can affect a collection dataset container or its rules that can have effects on the end users File loss The files that are lost or corrupted are removed from the datasets which change the content of the dataset. Often these events has unnoticed but can have bad consequences on physics analyses e.g. less statistics Dataset erased The dataset is erased because it was buggy or superseded by a new version Lifetime expiration All the datasets have finite lifetime. In case the lifetime of a dataset expires the users can ask for an extension of the lifetime. All these operations are run without notifying the users or when a notification happens it is via the use of generic mailing list that might not reach the users really interested in these events. We propose here a new mechanism where users can follow the events affecting a dataset or container. Any event mentioned above affecting one the the dataset followed will trigger a notification to the user e.g. daily email summarizing all the events ", "2299": "One needs a view to monitor the evolution of used space by account for a given or a set of RSEs. ", "2298": "Currently the space method key in AGIS has two possible values lcg stmd and other . The former essentially means using SRM. The latter signifies that the value of the related space usage url key is a URL to either an ATLAS or a WLCG JSON file. Recently AGIS introduced two new values storage and rucio . The goal is to change the meaning of the space method key. While previously it specified how to get the storage occupancy information in the future it will mean which RSE Usage source to use for scheduling deletions it will also affect the alarms in the ADC Livepage . Modify check rse attributes so that  The space usage method RSE attribute is set solely based on the content of space usage url .  The sourceForUsedSpace RSE attribute is set based on the content of space method . ", "2291": "My first contribution towards rucio Fixed grammatical errors and typos in database.rst and installing daemons.rst ", "2290": "from rucio.client.uploadclient import UploadClient upload client UploadClient logger logger Traceback most recent call last File stdin line  in module NameError name logger is not defined upload client UploadClient f no register True path afs cern.ch user t tjavurek ADC DDM pilot testing  test.txt did scope user.tjavurek rse UNI FREIBURG SCRATCHDISK summary file path . rucio upload.json result upload client.upload f summary file path Traceback most recent call last File stdin line  in module File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  lib  site packages rucio client uploadclient.py line  in upload for file in summary UnboundLocalError local variable summary referenced before assignment define summary before the file loop ", "2288": "The first link setting up demo is  should point to ", "2285": "Tests with postgres backend often fail because of too many connections to the database The max connections value in the postgres configuration must be increased. ", "2277": "There is now a new API to declare bad PFNs much more efficient that the one currently used for rucio admin replicas declare bad . Will move to the new API. ", "2266": "This line needs chunking similar to the other queries. ", "2265": "This is similar to  ", "2262": "from rucio.core.config import set set section throttler option Data Consolidation xyz value  session None Control space characters not allowed key has option throttler Data Consolidation xyz Traceback most recent call last File stdin line  in module File usr lib  site packages rucio db sqla session.py line  in new funct result function args kwargs File usr lib  site packages rucio core config.py line  in set if not has option section section option option session session File usr lib  site packages retrying.py line  in wrapped f return Retrying dargs dkw .call f args kw File usr lib  site packages retrying.py line  in call return attempt.get self. wrap exception File usr lib  site packages retrying.py line  in get six.reraise self.value  self.value  self.value  File usr lib  site packages retrying.py line  in call attempt Attempt fn args kwargs attempt number False File usr lib  site packages rucio db sqla session.py line  in new funct return function args kwargs File usr lib  site packages rucio core config.py line  in has option has option REGION.get has option key expiration time expiration time File usr lib  site packages dogpile cache region.py line  in get value self.backend.get key File usr lib  site packages dogpile cache backends memcached.py line  in get value self.client.get key File usr lib  site packages memcache.py line  in get return self. get get key File usr lib  site packages memcache.py line  in get self.check key key File usr lib  site packages memcache.py line  in check key Control space characters not allowed key r key memcache.MemcachedKeyCharacterError Control space characters not allowed key has option throttler Data Consolidation xyz ", "2261": "rucio admin config set silently fails e.g. rucio admin config set section throttler option Data Consolidation xyz value  Set configuration throttler.Data Consolidation xyz  But on the server side it returns a  ", "2257": "No more mercy. ", "2253": "For installations without Oracle we need a flag such that the RSE abacus reports the RSE usage every hour into the rse usage history table. e.g. enable history ", "2249": "There should be a default value if no filter option is passed to the downloadclient. Change to item.get filters ", "2248": "The new mode has been added but the schema validator was not updated. ", "2245": "Traceback most recent call last File . t line  in module s.connect   File usr   socket.py line  in meth return getattr self. sock name args socket.error Errno  Network is unreachable Traceback most recent call last File . t line  in module s.connect   File usr   socket.py line  in meth return getattr self. sock name args socket.error Errno  Network is unreachable ", "2240": "Function description seems to have been copy pasted from somewhere without changes. ", "2238": "", "2237": "update the json format of the RSE export in core export.py drop key ASN drop key ISP drop key continent drop key transfer limits drop key limits remove outer protocol key move key credentials one level down to protocols move key  one level up ", "2233": "Currently it considers TU replicas which makes testing the feature impossible. ", "2227": "Create config se method in fts transfer tool ", "2226": "If root protocol is available according to the list replicas reply skip all non root protocols to minimise the effect of download extract. ", "2221": "Minos is not able to handle PFNs with different schemes ", "2220": "Right now the throttler releases transfers simply based on time. FIFO. For the Tape Carousel activity it is necessary to release them in a smarter way Grouped FIFO. This essentially means if a transfer is being released it should also release all the transfers of the same dataset so they are submitted to FTS in the same time window to allow subsequent grouping on FTS side and thus on the tape system. ", "2219": "This potentially creates all kind of contention problems. Thus the injector should not inject a rule which is about to expire soon minutes . ", "2217": "core.list replicas does not recursively list the parents and thus does not resolve any replicas. This is blocking the deployment of new clients. ", "2212": " Example sqlalchemy.exc.DataError  invalid input value for enum BAD REPLICAS STATE CHK T SQL ALTER TABLE bad replicas ADD CONSTRAINT BAD REPLICAS STATE CHK CHECK state in B D L R S T In PSQL we cannot drop the constraint and create it anew instead we have to alter the enum of the constraint ALTER TYPE BAD REPLICAS STATE CHK ADD VALUE T AFTER S ALTER TYPE RULES NOTIFICATION CHK ADD VALUE P AFTER C  Foreign keys are a hard dependency in PSQL we cannot simply drop an index. This is now a problem with SOURCES REPLICA FK To fix the replicas primary key migration alter table sources drop constraint SOURCES REPLICA FK alter table replicas drop constraint REPLICAS PK alter table replicas add primary key scope name rse id alter table sources add constraint SOURCES REPLICA FK FOREIGN KEY scope name rse id REFERENCES replicas scope name rse id ", "2207": "There are some leftovers of dict.iteritems that are not  compatible. Replace them with six.iteritems. ", "2203": "tests test account.py is failing because of two overlapping PRs. The password argument needs to be added to the add account identity calls. ", "2200": "Add a test to travis for SUITE all with  It should be allowed to fail. ", "2199": "There are some places in the code where FTS is hardcoded e.g. FTS attribute on RSEs. Also changing the transfertool in the configuration is not implemented. ", "2194": "First documentation patch fix to rucio. Fixed typos and grammatical errors in rucio doc source api.rst rucio doc source configuration.rst and rucio doc source index.rst . ", "2186": "Submitting my first documentation patch fix in the organization Fixed some grammatical errors and typos in overview Replica management.rst clients.rst and cli examples.rst files. ", "2185": "My first step towards contribution to Rucio. Fixed some typos in the documentation and READMEs of demo and dev respectively. ", "2181": "The necromancer always try to process replicas that are bad even if the DID has availability LOST . Moreover it can sleep if it managed to process every files within sleep time in the bulk even if there is still work to do. ", "2180": "etc docker dev alembic mysql.ini is missing but needed in the Dockerfile. Copy from etc docker travis alembic mysql.ini ", "2177": "", "2174": "When computing the freespace on a site the probe doesn t take into account the min freespace. It should be changed ", "2173": "Add the possibility to declare bad files in the WebUI ", "2168": "Summary we observed following behaviour        FileHandling        rucio sitemo StageOut attempt          rucio sitemo stageOutApi no register True path panda.um.group.phys   guid      did scope panda rse  LAPP SCRATCHDISK        rucio sitemo Preparing upload for file panda.um.group.phys          rucio sitemo StageOut attempt   where the logger message between the two attempts is not sufficient to understand the problem. As a consequence pilot fails later with PilotException PilotException  stageOut with API failed The requested service is not available at the moment. Details An unknown exception occurred Code details the message starting with \u2018Preparing upload \u2026\u2019 originates from Rucio\u2019s upload client it didn\u2019t reach the next logger message that is on line But on  lines between we are calling rsemgr and protocols which I suspect from failing somewhere without proper raise or logger message. The logger level is set to \u2018DEBUG\u2019. Note that srm protocol is the first priority one for the w lan activity. Writing a job log into the same destination from the same job passed with no problems thus most probably there was a problem with the file itself. Solution we should expand logger messages in upload client on these lines at the first place. Secondly we should investigate rsemgr and protocols for raising exceptions and let them provide more info to logger if possible. ", "2166": "The upgrade of the replica state T is missing in the revision. ", "2161": "The conveyor supports fts source strategy option to specify which option should be chosen for the sources. This option is the same for all the transfers processed by a given conveyor instance. It would be better to be able to specify different options for different activities. Introduce a default default fts source strategy in the configuration table as well a activity fts source strategy so that every activities can use a different strategy. ", "2160": "StoRM sites have an effective way of getting a file from their shared FS. In such case rucio shouldn t try to do direct copy for local reads. introduce a new protocol imitation that will create a symlink in place of communicating and copying a file from a storage. ", "2156": "There are new versions of  and pycodestyles which need to be upgraded. This will raise additional errors though which should be fixed beforehand. ", "2155": "Some of the permission checks are not done correctly and need to be updated in all permission files. ", "2154": "ERROR Failure ModuleNotFoundError No module named retrying Traceback most recent call last File home travis virtualenv  lib  site packages nose failure.py line  in runTest raise self.exc val.with traceback self.tb File home travis virtualenv  lib  site packages nose loader.py line  in loadTestsFromName addr.filename addr.module File home travis virtualenv  lib  site packages nose importer.py line  in importFromPath return self.importFromDir dir path fqname File home travis virtualenv  lib  site packages nose importer.py line  in importFromDir mod load module part fqname fh filename desc File home travis virtualenv  lib  imp.py line  in load module return load source name filename file File home travis virtualenv  lib  imp.py line  in load source module load spec File frozen importlib. bootstrap line  in load File frozen importlib. bootstrap line  in load unlocked File frozen importlib. bootstrap external line  in exec module File frozen importlib. bootstrap line  in call with frames removed File home travis build rucio rucio lib rucio tests test bin rucio.py line  in module from rucio.db.sqla import session models File home travis build rucio rucio lib rucio db sqla session.py line  in module from retrying import retry ModuleNotFoundError No module named retrying ", "2149": "The reaper console script rucio reaper is not tested in the testsuite. Add test for the reaper console script. Install the environnement with python setup.py develop in the docker env to have the generated console scripts available in the docker. Extend the reaper argparse method and the reaper tests to validate the argparse main method and console script. ", "2144": "Enable login to the Web UI with a straightforward username password form. From discussions with AENEAS SKA ", "2142": "Looking at the output from list identities in the account client it does not return the e mail address for the identity. However the set identity takes this parameter and the field exists in the database. Is this an oversight or is it intentional? The underlying motivation for this is that I m trying to migrate the accounts and identities from one server to another. ", "2141": "Adding generic metadata with add did meta does not work and requesting with get did meta should not fail with No DID found when instead it should be No generic metadata found. ", "2140": "userpass authentication requires a password option in addition to id which is for  ssh kerberos . This is available through the API but not bin rucio ", "2137": "The rucio rucio systemd  image is still used as a base for the dev and travis containers. There is no need for a systemd base image for those two and it can be replaced with the centos image instead. Then finally we can also remove the rucio systemd  image from our docker hub repository. ", "2133": "Change idna to  ", "2128": "There seems to be a problem with memcached and core config which was added by PR  If I try to add a key with a space included memcached throws an error. Not sure if User Subscriptions is a valid key though. python from rucio.core.config import set set throttler User Subscriptions MOCK  memcache.MemcachedKeyCharacterError Control space characters not allowed key has option throttler User Subscriptions  ", "2127": "On readthedocs the documentation for setting up a demo environment is broken as there multiple entries in the sidebar for one page. Update styling and titles for headlines in etc docker demo README.rst ", "2126": "Improve conveyor daemon documentation for submitter and throttler. ", "2122": "Existing RSE attributes which use   as true false are not found if they are the sole solution to an RSE expression. ", "2118": "The upgrade script should be fixed in a hotfix release  and the  release should be pulled from PyPi. This only impacts database upgrades from an older version. ", "2115": "When RSE configurations are repaired then M state requests are not picked up again automatically. Do this by default but add switch for ATLAS to explicitly disable it. ", "2112": "Allow python apis to list the DID status in a rule in the context of a automatic script for monitoring the user file transfer for instance. AFAIU the rest call is already there the only work needed is to expose that to the client Expose replicalocks call defined here ", "2107": "The  package is missing in the readthedocs environment. Therefore the build sometimes fails if the cache gets reset. It needs to be mocked because it can not be installed through the readthedocs.requirements.txt because of missing pycurl. ", "2105": "The link on the rule page the DDM dashboard is still pointing to the old dashboard. Point to the new dashboard. ", "2103": "rucio list rse usage show accounts sometimes crashes with Internal Error . The problem is due to division by zero on the server side Mon Feb      error pid  tid  float division by zero Mon Feb      error pid  tid  Traceback most recent call last Mon Feb      error pid  tid  File usr lib  site packages rucio web rest rse.py line  in GET Mon Feb      error pid  tid  usage get rse usage rse issuer ctx.env.get issuer source source per account per account Mon Feb      error pid  tid  File usr lib  site packages rucio api rse.py line  in get rse usage Mon Feb      error pid  tid  return rse module.get rse usage rse rse source source per account per account Mon Feb      error pid  tid  File usr lib  site packages retrying.py line  in wrapped f Mon Feb      error pid  tid  return Retrying dargs dkw .call f args kw Mon Feb      error pid  tid  File usr lib  site packages retrying.py line  in call Mon Feb      error pid  tid  return attempt.get self. wrap exception Mon Feb      error pid  tid  File usr lib  site packages retrying.py line  in get Mon Feb      error pid  tid  six.reraise self.value  self.value  self.value  Mon Feb      error pid  tid  File usr lib  site packages retrying.py line  in call Mon Feb      error pid  tid  attempt Attempt fn args kwargs attempt number False Mon Feb      error pid  tid  File usr lib  site packages rucio db sqla session.py line  in new funct Mon Feb      error pid  tid  return function args kwargs Mon Feb      error pid  tid  File usr lib  site packages rucio core rse.py line  in get rse usage Mon Feb      error pid  tid  account usages.append used row.bytes account row.account percentage round float row.bytes float total   Mon Feb      error pid  tid  ZeroDivisionError float division by zero ", "2102": "Cf. table args PrimaryKeyConstraint rse id scope name name REPLICAS PK table args PrimaryKeyConstraint scope name rse id name REPLICAS PK ", "2095": "A few packages defined in the pip requirement files are not  compatible like web.py  python memcached. ", "2090": "Test alembic up and downgrade on all databases not only sqlite. Have separate alembic.ini per database to test. Remove template copy from top level Dockerfile. ", "2089": "the usercert.pem file is missing in the etc docker dev directory. Therefore the build fails. add usercert.pem from etc docker demo ", "2080": "this ticket should remain open for longer time. Quite often there is a request to do a small change in the  scriptis. All of them would be treated by this ticket. ", "2076": "In the current HEAD of the download client the transfer timeout is not propagated to protocol.get it is always None I think this issue is caused by this refactoring The transfer timeout is now stored in the merged options dictionary but download item is not updated accordingly. ", "2069": "Staging area replicas should be available for use as transfer sources and appear in the replica list. This makes the staging area behave more like a virtual disk Drop the staging area False restrictions on the queries. ", "2065": "There are broken links in the sidebar on like RUCIO DAEMON ", "2054": "The sites clouds squads need a view to list the suspicious files on their site. ", "2051": "Traceback most recent call last File check voms line  in module print ERROR getting info for s user. DN UnicodeEncodeError ascii codec can t encode character u xed in position  ordinal not in range  As a temporary solution use repr until the issue better understood. ", "2048": "wrong traces wrong accounting should return another field called rse where rse would be populated. Is that possilbe? ", "2045": "Some sites reported that some  party copy to their SRM are failing because no destination space token was specified despite the fact that the space token is properly defined in the extended attributes of the protocol. The problem is not systematic and only happens from time to time. It affects both single and multi sources transfers. This needs to be fixed. ", "2040": "rucio list rse usage show accounts BNL  LOCALGROUPDISK fails with        ERROR An unknown exception occurred. Details no error information passed status code  internal server error server error o    On the server the following exception is shown Fri Jan      error pid  tid  float division by zero Fri Jan      error pid  tid  Traceback most recent call last Fri Jan      error pid  tid  File usr lib  site packages rucio web rest rse.py line  in GET Fri Jan      error pid  tid  usage get rse usage rse issuer ctx.env.get issuer source source per account per account Fri Jan      error pid  tid  File usr lib  site packages rucio api rse.py line  in get rse usage Fri Jan      error pid  tid  return rse module.get rse usage rse rse source source per account per account Fri Jan      error pid  tid  File usr lib  site packages retrying.py line  in wrapped f Fri Jan      error pid  tid  return Retrying dargs dkw .call f args kw Fri Jan      error pid  tid  File usr lib  site packages retrying.py line  in call Fri Jan      error pid  tid  return attempt.get self. wrap exception Fri Jan      error pid  tid  File usr lib  site packages retrying.py line  in get Fri Jan      error pid  tid  six.reraise self.value  self.value  self.value  Fri Jan      error pid  tid  File usr lib  site packages retrying.py line  in call Fri Jan      error pid  tid  attempt Attempt fn args kwargs attempt number False Fri Jan      error pid  tid  File usr lib  site packages rucio db sqla session.py line  in new funct Fri Jan      error pid  tid  return function args kwargs Fri Jan      error pid  tid  File usr lib  site packages rucio core rse.py line  in get rse usage Fri Jan      error pid  tid  account usages.append used row.bytes account row.account percentage round float row.bytes float total   Fri Jan      error pid  tid  ZeroDivisionError float division by zero ", "2039": "LSM uses pcaches. In order to fulfil wishes of US admins we need to implement them in rucio so that rucio mover will use this feature.  stealing pcache script from lsm  implementing check whether a file is listed in pcache if so make a hardlink to its location instead of downloading it again.  populating the pcache list. ", "2038": "Done rucio admin replicas declare bad reason dcache does not know anything about this file srm lcg   srm  atlas atlasdatadisk rucio    db DAOD   echo ?  I did not get any feedback from the above command which is unnerving ! DDM would you consider a message printout as to what was done ? Thanks ! regards Asoka ", "2030": "will silently excludes RSEs that don\u2019t have either an srm or a gsiftp counter. The former might not exist in the future as sites move away from SRM and the latter was renamed to json . Additionally the long term plan is to drop the individual counters and solely use the new storage one. This was investigated and reported by cserf. Modify the query so that it only filters against the storage counter. ", "2028": "pip requires SQLAlchemy   alembic   python dateutil      stomp.py   dnspython      maxminddb   pycparser   googleapis common protos     pyOpenSSL   cryptography      protobuf   grpcio       modules   rsa   redis   numpy   paramiko   Flask   idna   MyProxyClient   pip requires test Paste   coverage   Sphinx   sphinx rtd theme     Pygments   pyflakes      pylint   virtualenv   tox   pytest   pytest xdist   pytz   Babel      pycodestyle   ", "2022": "Rucio download called directly from CLI can be forced to transfer data using specific protocol with protocol command line option. I think it would be also useful to use environment variable e.g. RUCIO PROTOCOL to achieve same behavior because with this functionality it is pretty easy to pass this protocol filter to the jobs running in environment with limited network connectivity that allows only certain protocol to pass through. Just minor changes in rucio code to also look at environment variable RUCIO PROTOCOL in addition to the protocol command line option for download upload ", "2021": "", "2020": "There are a few  incompatibilities that were not found by pylint  change except Exception e to except Exception as e use  f except Namespace object has no attribute which when using  bin rucio admin rse Import error for module exceptions TypeError Unicode objects must be encoded before hashing in heartbeat core ", "2015": "The FTS probe sometimes doesn t whitelist a SE after the end of downtime ", "2010": "", "2007": "BelleII schema BelleII has also a specific construct surl function for non deterministic transfers. At the moment these functions are part of the core repository so it will be added there. In the medium term this has to be changed similar to the  calls. ", "2006": "Selection of the authentication type should be case sensitive and not throw an error. rucio env rjoshi rucio bastion rucio a rjoshi S  v whoami        ERROR Cannot authenticate. Details auth type  not supported        DEBUG Traceback most recent call last File opt rucio env bin rucio line  in new funct return function args kwargs File opt rucio env bin rucio line  in whoami account client get client args File opt rucio env bin rucio line  in get client elif auth type  proxy UnboundLocalError local variable auth type referenced before assignment        ERROR local variable auth type referenced before assignment        ERROR Rucio exited with an unexpected unknown error. Please rerun the last command with the v option to gather more information. If it s a problem concerning your experiment or if you re unsure what to do please followup at alastair.dewhurst cern.ch If you re sure there is a problem with Rucio itself please followup at Completed in  sec. ", "2001": "curl k s ?xml version  encoding UTF  ? metalink xmlns urn ietf params xml ns metalink file name   MinBias.daq.RAW.  SFO   identity     MinBias.daq.RAW.  SFO   identity hash type   hash size  size glfn name atlas rucio     MinBias.daq.RAW.  SFO   glfn url location BNL  DATADISK priority  root   pnfs usatlas.bnl.gov  rucio       MinBias.daq.RAW.  SFO   url file metalink But when sort geoip is added curl k s ?xml version  encoding UTF  ? metalink xmlns urn ietf params xml ns metalink file name   MinBias.daq.RAW.  SFO   identity     MinBias.daq.RAW.  SFO   identity hash type   hash size  size glfn name atlas rucio     MinBias.daq.RAW.  SFO   glfn file metalink Something seems to fail in the geoip sorter. ", "2000": "Currently the tests in are failing if you use a cache in your tests because you can read a stale value that got set during running the test due to a quite long expiration time. force a readout from DB to get the current value add memcache to the travis test because the PR that added caching went through because travis was not using any cache ", "1990": "Add missing alias for the import and export endpoints. Add import and export to etc web aliases  and etc web aliases  ", "1987": "Chunksize of  seems to lead to weird ORA error. ", "1986": "mlassnig  rucio v download allow tape group.phys higgs group.phys    yt           INFO Processing  item s for input        DEBUG Processing item group.phys higgs group.phys    yt           DEBUG RSE Expression istape False        DEBUG Splitted DID group.phys higgs group.phys    yt           DEBUG  DIDs after processing input        DEBUG Processing resolve archives True name group.phys    yt    did group.phys higgs group.phys    yt    rse istape False no subdir False nrandom None transfer timeout  scope group.phys higgs type u DATASET force scheme None base dir .        INFO Using main thread to download  file s        DEBUG Start processing queued downloads Completed in  sec. allow tape does not modify the istape False . If the only copy is on tape it won t find any replica. allow tape must change the tape part of the RSE expression into something like istape False istape True ", "1985": "Adapt the threat handling similar to abbacus collection replicas. Remove process total process etc. ", "1977": "       panda.log.Adder DEBUG  registraion with backend rucio for  files took  sec        panda.log.Adder DEBUG  registraion with backend rucio for  files took  sec        panda.log.Adder DEBUG  registraion with backend rucio for  files took  sec        panda.log.Adder DEBUG  registraion with backend rucio for  files took  sec        panda.log.Adder DEBUG  registraion with backend rucio for  files took  sec        panda.log.Adder DEBUG  registraion with backend rucio for  files took  sec        panda.log.Adder DEBUG  registraion with backend rucio for  files took  sec        panda.log.Adder DEBUG  registraion with backend rucio for  files took  sec        panda.log.Adder DEBUG  registraion with backend rucio for  files took  sec        panda.log.Adder DEBUG  registraion with backend rucio for  files took  sec        panda.log.Adder DEBUG  registraion with backend rucio for  files took  sec ", "1976": "The split container option is enabled when requests on containers are done via  It creates rules on the constituent datasets of the container instead of a single rule on the container. It can trigger IntegrityError in the case a rule for scope name account rse expression already exists. Similarly the same error can be raised if  constituents contain the same datasets. To handle the first issue the injector must check if a rule on scope name account rse expression already exists. To handle the second one it should make a set from the list returned by list child datasets . ", "1973": "Currently the quota for the groups is never updated on SCRATCHDISK endpoints ", "1970": "rucio add rule protodune sp  raw run number   FNAL DCACHE STAGING        ERROR An unknown exception occurred. Details no error information passed status code  internal server error server error o    ", "1967": "If the source RSE is non deterministic then even if the deterministic flag is set to false on an associated staging area the staged replicas don t set the path making them unusable. Set the path when the RSE is non deterministic. ", "1965": "It should be possible to control the maximum space used for an RSE in addition to account quotas. Add a configurable parameter for the maximum RSE usage and check against this in the RSE selector. ", "1961": "Update last occurrences of  incompatible code in tests common ", "1958": "Currently the caching has to be handled by all modules using these methods but it should be done natively. Option to force a readout from the DB should be there as well. ", "1955": "only shows accounts which have a quota on a given RSE. It can happen that somebody has no quota on a RSE but uses some space on this RSE typically somebody who requested a rule via  . In that case it would be good to have it in the table. ", "1954": "This will assist the cloud squads. Pull request  laid the groundwork to process LOST files identified during the consistency check. Convert the LFNs to PFNs then report them as suspicious. The reason will be set to Reported by Auditor so that it is easily identifiable. ", "1953": "The Deterministic External id eid sent to FTS is generated using as seeds voname base id both static but obtained from a whoami against the FTS server and the request id of the first file of the FTS job. This Determinitic eid was introduced to prevent submitting  jobs for the same file if there is already one job submitted for a given request id FTS will reject another attempt because they will have the same eid. Problems can occur when a first submission is done to FTS and FTS doesn t respond even if the submission was successful. In that case a second attempt will be done with the same request id . Here are the potential issues The whoami fails and in that case voname and base id are set to None. In that case the external eid generated will be different even if the request id is the same. Even if the whoami succeeds the fact that only the request id of the first file is considered leads to the fact that the transfers of   and   will generate  different eid. So basically the eid is useless for jobs with multiple destination replicas i.e. more than  of our transfers ", "1952": "There is currently no tool to provide the account usage history on on RSE. Will implement Core API REST CLI WebUI view ", "1948": "It would be nice to define a default value when reading a config from the config table. python def get section option session None to python def get section option default None session None Also REST and API have to be updated. ", "1945": "Based on scripts provided by Gancho. ", "1942": "needed to use a different set of FTS activities for the DOMA TPC tests. ", "1937": "In case of a long deletion queue for an RSE reorder the files to put the largest ones first. ", "1932": "Currently the undertaker expires rules bigger than  locks instead of deleting them immediately. This value should be configurable via the config table. ", "1929": "Currently locked rules i.e. on tape storages are not automatically deleted requiring an additional manual step. Disable the lock when applying the lifetime. ", "1924": "Make the daemons  compatible. ", "1922": "Currently Rucio has three notification modes YES Notify all state changes NO Notify no state changes at all CLOSE Only notify when rule is OK and dataset is closed. For the TapeCarousel activity an additional mode would be beneficial where a notification is sent once the rule reaches a certain percentage of completion. e.g.  . After that the mode can be changed to CLOSE . ", "1918": "The quota for SCRATCHDISK endpoint is now a fraction of the total space. One should have the possibility to define a fixed value ", "1917": "Just wanted to document this Traceback most recent call last File usr bin rucio reaper line  in module load entry point rucio  console scripts rucio reaper File usr lib  site packages rucio clis daemons reaper reaper.py line  in main exclude rses args.exclude rses include rses args.include rses delay seconds args.delay seconds File usr lib  site packages rucio daemons reaper reaper.py line  in run while threads  .is alive IndexError list index out of range It goes away once I defined a single RSE ", "1912": "Make the core module of Rucio  compatible. ", "1910": "I d expect Rucio to install on a fairly plain  box with the following virtualenv  rucio doma cd rucio doma . bin activate pip install rucio clients However when I do this locally I get rucio Traceback most recent call last File home  bbockelm software rucio doma bin rucio line  in module from rucio.client.client import Client File home  bbockelm projects rucio lib rucio client init .py line  in module from rucio.client.client import NOQA pylint disable wildcard import File home  bbockelm projects rucio lib rucio client client.py line  in module from rucio.client.accountclient import AccountClient File home  bbockelm projects rucio lib rucio client accountclient.py line  in module from rucio.client.baseclient import BaseClient File home  bbockelm projects rucio lib rucio client baseclient.py line  in module from requests kerberos import HTTPKerberosAuth ImportError No module named requests kerberos That is the requests kerberos dep appears missing. Note this is with version  Either the base client should silently ignore the missing kerberos client until someone tries to use it or it should be added to setup.py . A simple pip install requests kerberos seems to fix the problem. ", "1909": "For very large rules the undertaker is blocked a long time to delete them which leads to long backlogs. Instead for rules  files it could just flag the rule for expiration and set the timeout of the dataset  day in the future. Doing this the judge cleaner will take care of the rule deletion and thus free up the undertaker to do its job. ", "1901": "in lib rucio common schema cms.py the RSE Name pattern is T   A Z  A Za   while the pattern for the rse property of ATTACHMENT is A   A   as a result when we add replicas to a CMS RSE whose name is not all in capitals e.g.  UK RAL Buffer if we use add replicas and the attach dids it works fine if we use attach dids directly it fails with InvalidObject Just put the same regexp for the two patterns PR coming ", "1898": "Minor updates and pointing to the right URLs. ", "1888": "Fix the last small changes to make the clients  compatible. This closes  didclient fileclient  downloadclient ", "1885": "The way the reaper is implemented now leads to the fact that we have different instances processing each a fixed partition. In the worst case scenario one can have one reaper dedicated to one RSE that will have millions of files to process whereas all the other instances stay idle because there is nothing to be deleted on the RSEs they serve. Here is a proposition to have a horizontally scalable reaper. The proposal is to split the reaper into  parts. One first daemon reaper preparer would run the list unlocked replicas on all the RSEs and identify all the replicas that need to be deleted based on the needed free space . All these replicas would get the state BEING DELETED . A second daemon the true reaper which will run the physical deletion gets the list of all BEING DELETED replicas. The query can be partitioned on a hash of the name of the DIDs to have balanced partitions between different instances. Doing this way we can ensure that all instances will get the same share of work. The true reaper physically deletes the files and issue the delete replicas . There might be a few issues to address e.g. it can be that all the reapers are running against the same RSE and can cause some denial of service . Comments welcome. ", "1882": "Some traces are wrongly defined. Need a protection in kronos. ", "1879": "The account usage history is not populated anymore. The Oracle procedure needs to be modified to populate it. ", "1878": "The original procedure was dropped in  and was forgotten \ud83d\ude22 We need a new procedure similar to the current ADD RSE USAGE procedure. Note Check how this is done in  as well. ", "1874": "It s defined on the DB but not used anywhere. Should be removed. ", "1871": "For the suspicious files that have multiple replicas there is no need of human check to confirm that the replica is actually bad. One can have a probe to automatically recover them. ", "1870": "The reporting of suspicious files in Kronos is broken ", "1864": "The number of suspicious is way more bigger than the actually big one. One should have the possibility to filter out the suspicious files from the bad files summary plots ", "1861": "In order to be generic in terms of DB sql query in  needs to be replaced by sql alchemy query. rewrite the query. ", "1853": "Stumbled upon them while using Rucio. This issue collects them though they aren\u2019t related. Small patches of little consequence. ", "1852": "", "1849": "This affects the check deletable replicas and check obsolete replicas probes. The SQL queries do not deal with RSEs where everything has already been deleted by the Reaper. ", "1848": "Enhance deamon documentation ", "1845": "is not compatible to Python  it seems which is a problem for the deployment on the grid  desilva atlas  rucio version Traceback most recent call last File ALRB atlasadmin atlas  ATLASLocalRootBase   rucio clients  bin rucio line  in module from rucio.client.downloadclient import DownloadClient File ALRB atlasadmin atlas  ATLASLocalRootBase   rucio clients  lib  site packages rucio client downloadclient.py line  in module from builtins import round ImportError No module named builtins ", "1842": "The output produced by the get metadata list rse attributes and stat commands is not easily readable.  Sort the keys alphabetically.  Align the values vertically will use tabulate package .  Add a separator when running for multiple DIDs does not apply to list rse attributes . ", "1841": "Overhaul readmes organise daemons etc. ", "1836": "Right now throtteling is possible per activity destination rse tuple. However it would be good for the tape carousel to be able to throttle per destination over all activities. ", "1835": "In the error message says the fts host is missing for the source while it should say it is missing for the destination. ", "1833": "in some cases the stat failed due to service unavailable although the file was phsysically there. at line try fail wait  second try fail wait  seconds try fail wait  seconds try fail wait  seconds try fail wait  seconds try fail finally ", "1825": "Kronos crashes when updating eol at ", "1818": "There is an inconsistency with the PKs in history tables which has basically two reasons SQLAlchemy requires each table in models.py to have a PK Otherwise it could not be a ORM In ATLAS on Oracle we do not have PKs on History tables to save storage This creates an inconsistency how we developers expect these history tables to operate between instances which run the oracle schema without PKs and instances where the schema is generated from models.py With PKs For example there was instances where we make MERGE INSERTS in the history tables. This clearly works in cases where there is a PK but it doesnt work for ATLAS as there is no PK on the table. In the other way around multiple inserts work on the tables for ATLAS but do not work on tables created by the models.py due to the uniqueness of the PK. I would propose to change all models.py History table to define the PK as mapper args e.g. mapper args primary key scope name child scope child name This basically tells SQLAlchmey that there is a PK to satisfy this requirement while in reality there is None. Secondly we would have to make an upgrade script which drops all PKs in these tables. Communities who query these history tables frequently just need to create indices on these tables. ", "1814": "", "1811": "The token generation in the auth core has changed. Now instead of just the token a dict with the token and expiration time is returned. Fix the code to extract the token from the dict. ", "1810": "When a subscription is changed we don t keep the history. Will implement subscriptions history ", "1809": "First small integration project to familiarise myself with the rucio environment. Migrate the rest of the data from old ES instance to new es  ", "1807": "For some reason not understood yet we can have some replicas having lock cnt!  but no rows in the locks table. The necromancer now crashes because of this. It must be able to handle it properly         CRITICAL Thread   Traceback most recent call last File usr lib  site packages rucio daemons necromancer.py line  in necromancer update rules for lost replica scope scope name name rse id rse id nowait True File usr lib  site packages rucio db sqla session.py line  in new funct result function args kwargs File usr lib  site packages rucio core rule.py line  in update rules for lost replica raise RucioException Problem with the locks RucioException An unknown exception occurred. ", "1805": "Fix the mixture of REST call and python bindings present in the  transfer tool. Particular attention on testing and consistency check between REST response and binding ones. Mainly integrating what was done for user in the default tool check for response equivalence w.r.t. REST response mock  may be needed for a proper testing ", "1804": "Right now the configuration of the reaper decides which mode of deletion is used. This causes us to run different types of reapers for no good reason. If the mode is an RSE attribute this is more flexible. ", "1803": "Right now we have our python file which describes our LFN to PFN algorithm in our own repo This has the unfortunate side effect of requiring CMS to build it s own docker container. I d like to move this into Rucio either at rucio lib rucio common schema where another policy file is or at rucio lib rucio rse protocols which is where the code that imports it lives. sartiran I think to import this we can just specify the full python path in the config file and all is good. Once we have agreement on whether to do this and where to put it we just move the CMS file over. ", "1792": "when calculating the ratio of secondaries and total the  is sometimes attempting dividing by zero. exclude such a cases. ", "1791": "As discussed in  the REST call of get broken for DIDs containing I think that rather than doing this we can pass all the needed information scope name rse as params instead of including them in the url path. ", "1788": "Traceback         ERROR Traceback most recent call last File usr lib  site packages rucio daemons conveyor poller.py line  in poll transfers for transfer id in resps UnboundLocalError local variable resps referenced before assignment ", "1787": "Rucio has support for  style objectstore download and upload using shared secrets with boto and  as well as native support for  signed URLs. There are a few implications Shared secrets as the name implies require distribution of the secrets to clients which limits its usefulness. We cannot guarantee confidentiality as shared secrets can leak easily. The code itself is still from early days of R D and follows an old architecture. Swift is an  style compatible protocol targeted to OpenStack instead of Amazon which exists as an untested prototype. In the meantime URL signatures were implemented natively in Rucio with a Google Cloud Storage signature plugin which are similar to  signatures. The first objective would be to revisit the  and Swift signatures and bring it in line with the remainder of the code such that it can be used transparently by the replica core. ", "1786": "Clients should be able to retrieve request details FTS jobID etc for transfer monitoring purpose. Make results available in query request api request.py into web rest request.py. If I have understood well the suggestion by mlassnig . ", "1782": "This was changed in a recent PR however the call on urlparse.urlparse is wrong urlparse method should be called directly. ", "1777": "The current Primary Key for content history is based on scope name child scope child name . Because of this one cannot keep the history when a dataset is attached detached multiple times. Change to another PK ", "1774": "Currently the documentation builds fail with Running Sphinx  making output directory loading translations en done Traceback most recent call last File home docs checkouts readthedocs.org user builds rucio envs latest local lib  site packages sphinx cmdline.py line  in main opts.warningiserror opts.tags opts.verbosity opts.jobs File home docs checkouts readthedocs.org user builds rucio envs latest local lib  site packages sphinx application.py line  in init self.setup extension extension File home docs checkouts readthedocs.org user builds rucio envs latest local lib  site packages sphinx application.py line  in setup extension self.registry.load extension self extname File home docs checkouts readthedocs.org user builds rucio envs latest local lib  site packages sphinx registry.py line  in load extension raise ExtensionError Could not import extension s extname err ExtensionError Could not import extension rucio.common.doc.argparse.ext exception No module named rucio.common.doc.argparse.ext Extension error Could not import extension rucio.common.doc.argparse.ext exception No module named rucio.common.doc.argparse.ext I did not look too much into the issue yet but I wonder why we added this rucio.common.doc.argparse.ext to the repository instead of using sphinx argparse ? vingar do you maybe remember? ", "1772": "The undertaker crash when a DID is attach detached many times. The problem is due to the archival in the history table . ", "1766": "Bad replicas declaration in kronos currently fails with an exception which slows down kronos a lot Exception in thread StompReceiverThread  Traceback most recent call last File usr   threading.py line  in bootstrap inner self.run File usr   threading.py line  in run self. target self. args self. kwargs File usr lib  site packages stomp transport.py line  in receiver loop self.process frame f frame File usr lib  site packages stomp transport.py line  in process frame self.notify frame type f.headers f.body File usr lib  site packages stomp transport.py line  in notify rtn notify func headers body File usr lib  site packages rucio daemons tracer kronos.py line  in on message self. update atime File usr lib  site packages rucio daemons tracer kronos.py line  in update atime logging.error Failed to declare suspicious file error TypeError cannot concatenate str and exceptions.TypeError objects Convert correctly to str ", "1765": "If transmogrifier is set up to run without specifying any subscriptions the CPU load becomes excessive. Kronos shows similar heavy CPU loads in the absence of subscriptions. ", "1758": "In CMS we get use to these concepts a dataset is collection of blocks a block is collection of files. I understand that in ATLAS a dataset is a container etc. But apart from naming convention differences I need to find block replicas in CMS terminology . If we call a dataset as a b c pattern a block as a b c  pattern and file is file.root one. The replicas scope name can take either dataset or block patterns and return list of files. How I can find list of block a b c  pattern replicas? Is it issue with replicas scope name datasets API in this ticket or there is no such API? CC ing Eric ericvaandering to follow up with this issue. ", "1755": "If the regular expression used to detect the suspicious files is bad it can crash Kronos. Need to had a protection. ", "1749": "The PK for the replicas table is in order rse id scope name while it actually should be in order scope name rse id This needs to be changed and we need a proper upgrade script so this can be adapted at all installations. ", "1739": "The scope validation regex for atlas generic icecube but not cms allows single quotes which seems like a bad idea. a zA Z    s SCOPE LENGTH looks wrong and I m guessing it ought to be a zA Z    s SCOPE LENGTH . Unless someone really does have this requirement? ", "1738": "Update REST API webpy flask to be compatible with  Also needed for  ", "1731": "Once we perform authentication with rucio server it yield the valid token but does not provide lifetime of the token. Here is a typical example curl vvv key  USER PROXY cert  USER PROXY H X Rucio Account das A rucio clients  About to connect to cms rucio authz.cern.ch port   Trying  Connected to cms rucio authz.cern.ch  port   Initializing NSS with certpath sql etc pki nssdb CAfile etc pki tls certs ca bundle.crt CApath none NSS client certificate from file subject CN  CN Valentin Y Kuznetsov CN  CN valya OU Users OU Organic Units DC cern DC ch start date Oct      GMT expire date Nov      GMT common name  issuer CN Valentin Y Kuznetsov CN  CN valya OU Users OU Organic Units DC cern DC ch SSL connection using TLS ECDHE RSA WITH AES  GCM  Server certificate subject CN cms rucio authz.cern.ch OU computers DC cern DC ch start date Oct      GMT expire date Nov      GMT common name cms rucio authz.cern.ch issuer CN CERN Grid Certification Authority DC cern DC ch GET auth  HTTP  User Agent rucio clients  Host cms rucio authz.cern.ch Accept X Rucio Account das HTTP   OK Date Wed  Oct     GMT Server Apache Access Control Allow Origin None Access Control Allow Headers None Access Control Allow Methods Access Control Allow Credentials true Access Control Expose Headers X Rucio Auth Token Cache Control no cache no store max age  must revalidate Cache Control post check  pre check  Pragma no cache X Rucio Auth Token das DC ch DC cern OU Organic Units OU Users CN valya CN  CN Valentin Y Kuznetsov unknown  X Rucio Host cms rucio authz.cern.ch Content Length  Content Type application octet stream Connection  to host cms rucio authz.cern.ch left intact Out of this request I don t know how long my X Ruxio Auth Token is valid. I would expect that you ll supply corresponding lifetime of the token in separate HTTP header. ", "1730": "It seems like the Rucio REST API does not actually return true JSON. This is an e mail from vkuznet to me about this. The context is that CMS uses something called DAS to aggregate info across our data management system data catalog and other systems. It relies on REST APIs to do this in a reasonable fashion not a client library for each system . Thoughts? It seems Rucio APIs do not return proper JSON curl H X Rucio Auth Token token rse type DISK id  region code null city null updated at Fri  Sep     UTC rse  US Nebraska Test created at Fri  Sep     UTC ISP null deleted false time zone null longitude null availability  deterministic true volatile false country name null latitude null deleted at null continent null ASN null staging area false rse type DISK id  region code null city null updated at Wed  Oct     UTC rse  US NERSC created at Wed  Oct     UTC ISP null deleted false time zone null longitude null availability  deterministic true volatile false country name null latitude null deleted at null continent null ASN null staging area false and curl H X Rucio Auth Token token account das type USER email null account dciangot type USER email null Yes they return JSON dicts but it is not single JSON document and therefore it fails to be parsed. Here is example to prove it. curl H X Rucio Auth Token token account.json python Python  default Jul      GCC   Red Hat   on  Type help copyright credits or license for more information. import json data json.load open accounts.json Traceback most recent call last File stdin line  in module File usr   json init .py line  in load kw File usr   json init .py line  in loads return default decoder.decode s File usr   json decoder.py line  in decode raise ValueError errmsg Extra data s end len s ValueError Extra data line  column  line  column  char   I also tried to use HTTP header Content Type application json and results are the same. I don t want to crawl over strings this is what APIs return now and convert them to JSON docs. Instead I would like a JSON document. For the record the proper JSON would be something like based on accounts API output account das type USER email null account dciangot type USER email null It is also desired that all APIs will use the same data type a list of dicts even if one item in a list is present. This will allow to abstract parsing code much easily and make it API independent. Best Valentin. ", "1729": "The sort rses function at excludes rses that have no usage source of gsiftp or srm but only if the input list has more than one entry. This has the effect of making the reaper silently ignore rses that don t use legacy protocols unless there s only one rse per thread. Does the storage usage source test have any useful purpose? ", "1726": "core.did.set metadata only update the checksum and bytes in dids and contents table. But it doesn t do anything for the replicas. ", "1725": "If rucio admin rse set distance is used with a source destination rse combination that already has a distance the server replies with a Duplicate exception. This is not caught correctly but instead a traceback is shown for an unexpected error. Set distance from UKI MAN DPM X to UKI GLASGOW DPM X to  with ranking  An object with the same identifier already exists. Details Distance from  to  already exists! Rucio exited with an unexpected unknown error please provide the traceback below to the developers. Traceback most recent call last File opt rucio bin rucio admin line  in new funct return function args kwargs File opt rucio bin rucio admin line  in add distance rses client.add distance args.source args.destination params File opt rucio .venv lib  site packages rucio client rseclient.py line  in add distance raise exc cls exc msg Duplicate An object with the same identifier already exists. Details Distance from  to  already exists! Provide a short and meaningful error message. ", "1718": "The function to get the  checksum of a given file doesn t close the file correctly if an exception is raised and also doesn t propagate the exception to the caller. ", "1710": "Throttler must not release WAITING requests on blacklisted sites ", "1703": "I am not sure if I found a bug in the RSE deletion in core.rse.del rse or if it is more a session problem. I tried this test but it did not work. python from rucio.core.rse import add rse del rse rse exists rse name TEST add rse rse name del rse rse name rse exists rse name True Same happens with this. I suspect it relates to the way sqlalchemy handles the deletion and relationships. python from rucio.db.sqla import session models rse name  db session session.get session models.RSE rse rse name .save session db session db session.query models.RSE .filter by rse rse name .count  rse db session.query models.RSE .filter by rse rse name .one This deletion is used in core.rse.del rse rse.delete session db session db session.commit db session.query models.RSE .filter by rse rse name .count  Strangely the deletion works when using the API and a RSENotFound error gets raised in a second deletion. But if I try to get the RSE usage the request does not raise a RSENotFound which it should because it is querying the RSE to get the ID. DELETE rses TEST  DELETE rses TEST  GET rses TEST usage  The deletion works as expected if I use the sqlalchemy bulk with the corresponding ON DELETE CASCADE added to the model definitions of RSEUsage RSEAttrAssociation RSEProtocols etc. python from rucio.db.sqla import session models rse name  db session session.get session models.RSE rse rse name .save session db session db session.query models.RSE .filter by rse rse name .count  db session.query models.RSE .filter by rse rse name .delete synchronize session False db session.query models.RSE .filter by rse rse name .count  DELETE rses TEST  DELETE rses TEST  GET rses TEST usage  ", "1702": "Traceback         CRITICAL Traceback most recent call last File usr lib  site packages rucio daemons hermes hermes.py line  in deliver messages conn.connect wait True File usr lib  site packages stomp connect.py line  in connect  self args kwargs File usr lib  site packages stomp protocol.py line  in connect headers HDR HOST self.transport.current host and port  TypeError NoneType object has no attribute getitem ", "1701": "process total processes are not used anymore and should be removed ", "1698": "Need to fix to  and to   ", "1695": "Some  storage report  No Content if a file does not exist instead of  which creates error reports in Rucio. Expand the protocol to also interpret the  as a non existing file. ", "1692": "There was an update of  to  which is incompatible with requests  However requests specifies that it needs urllib  thus this should be considered by pip when installing the dependencies of Rucio. For some reason it is not rucio tmp rucio test install lib  site packages requests init .py  RequestsDependencyWarning   or chardet  doesn t match a supported version! RequestsDependencyWarning Traceback most recent call last File tmp rucio test install bin rucio line  in module from rucio.client.client import Client File tmp rucio test install lib  site packages rucio client init .py line  in module from rucio.client.client import NOQA pylint disable wildcard import File tmp rucio test install lib  site packages rucio client client.py line  in module from rucio.client.accountclient import AccountClient File tmp rucio test install lib  site packages rucio client accountclient.py line  in module from requests.status codes import codes File tmp rucio test install lib  site packages requests init .py line  in module from . import utils File tmp rucio test install lib  site packages requests utils.py line  in module from . internal utils import to native string File tmp rucio test install lib  site packages requests internal utils.py line  in module from .compat import is  builtin str str File tmp rucio test install lib  site packages requests compat.py line  in module from  dict import OrderedDict ImportError No module named ordered dict ", "1689": "If you delete the RSE attribute with the same name as the RSE you can not delete the RSE afterwards. The request will fail with status code  and Internal server error message. DELETE rses MOCK attr MOCK DELETE rses MOCK I would create a new exception class e.g. RSEAttributeNotFound and throw it if a NoResultFound exception gets raised and then respond with the corresponding error message. Then there should be a check if the attribute to be deleted has the same name as the RSE to avoid this exception in the RSE deletion. ", "1686": "The doc string for this seems to be outdated. I would add the query parameters created before created after name length length.gt length.lt length.lte and length.gte . ", "1685": "There is a set account status to update the status of an account but there is no update account method to update the account email for instance. Proposal is to get rid of set account status and replace it by update account account key value . Change is needed at all levels core API REST CLI ", "1682": "New  version  was just released which is incompatible to requests  With the way we install the test environment this dependency graph is not resolved thus the tests fail. ", "1677": "This needs to be in the normal and metalink return. See  ", "1672": "Currently the output of this command is account xxx used  MB percentage  account yyy used  MB percentage  account zzz used  MB percentage  while it should be account xxx used  MB percentage  account yyy used  MB percentage  account zzz used  MB percentage  With the only at the top and bottom of the entire list. Should be formatted so that the  columns are aligned. ", "1669": "it can happen in uploadclient that registration fails but file proceeds with an upload. Such a data is most probably deleted by dark reaper soon. The case when registration fails should be mentioned in the trace stateReason . introduce return codes in register file method and populate the trace. ", "1668": "While running the test of this I encountered an exception only with PostgreSQL as database that is not catched. It raised after tryting to attach a dataset to a container twice. rucio add container mock container rucio add dataset mock dataset rucio attach mock container mock dataset rucio attach mock container mock dataset ERROR An unknown exception occurred. Details u  duplicate key value violates unique constraint CONTENTS PK nDETAIL Key scope name child scope child name mock co mock da already exists. n With other databases a DuplicateContent gets thrown. I would add it to the pattern matching of the IntegrityError ", "1664": "Discussion in DDM mailing list and suboptimal LDAP access in synchronization script. Improved check voms synchronization script use python ldap module instead of parsing ldapsearch command line output. Updated code use TLS for paged LDAP search to get info about all account in less than  . ", "1663": "Currently if the constituent has a normal replica even on tape this one is preferred over the archive replica. However if only a tap replica is available the archive should be preferred. ", "1656": "When a user change its primary account the voms collector needs to update it. ", "1651": "The Auditor should know the number of files on an RSE and compare it with the number of results produced by the consistency check. This will help automatically identify cases where the dump created by the site is incomplete or uses the wrong root directory. This information is already available. rucio.core.rse get rse usage will be modified to add it to the results bin rucio will be modified to only show it for the rucio source. ", "1647": "It s not possible to set rse type in add rse. Same comment for latitude longitude etc. ", "1646": "is only an issue in Paramiko server which we do not use Should update to  nevertheless. ", "1639": "The check for the oracle version needed for the generic meta data has a typo in calling the connection function session.connection .connection instead of session.connection.connection ", "1638": "Right now the Nagios probes are part of the core repository but they should not be. We should move them to a separate atlas rucio probes repository or similar . Over time this can also converge to a common probe repository as CMS most likely will also use a large fraction of these probes. ", "1637": "Currently the reaper is over protective with the protection of sources if a transfer is active. All possible sources of an active transfer are not eligible for deletion which is too protective if there are many possible sources. This should be changed to If only  source is available protect it behaviour stays as it is If  or more sources are available all are eligible for deletion except the one with the alphabetically first RSE or the one which is oldest some shared knowledge so that multiple reapers would not accidentally delete the  remaining sources. This was discussed in the dev meeting on ", "1635": "list bad replicas status implicitely uses SRM. It can be a problem for the sites without SRM ", "1632": "bin conveyor submitter and bin conveyor transfer submitter point to the same code. Historically they were different but now there is no point to have both. We should get rid of the conveyor transfer submitter in the  release. ", "1625": "The list of SCRATCHDISK endpoints used for the second replication of users data is currently static. One would need to have a dynamic list based on the freespace RSE attribute ", "1624": "The group policy option is not propagated properly to the conveyor. ", "1623": "Currently the suspicious files are reported by the conveyor the pilot and rucio download . We can centralize everything so that Kronos checks the traces and reports as suspicious all the files with errors that match a certain pattern ", "1622": "Hi Download of   DRAW   produces the file  valid DRAW   This is the scope of the zip file containing it but should be the scope of the constituent. This is not a problem until it is I think in general the scopes will be the same. However I don t think there is a requirement that this be the case so this should probably be fixed. Please also check that the file s end up in the correct directories in the case where the whole zip is downloaded. Cheers Rod. ", "1619": "See ", "1614": "", "1613": "If the client requests a specific RSE expression then the returned file data checksum bytes is from the archive not the constituent. ", "1610": "The bad replicas table was extended with a bytes column for monitoring purpose. This column needs to be populated when a bad file is declared ", "1606": "In  the wildcard download stopped working. Related to re implementation of downloader ", "1601": "CMS needs to use AllowEncodedSlashes as an HTTPD directive to allow DIDs with slashes in them. Document this in a couple of places. ", "1600": "eg. When clicking the add protocol button It links to the wrong URL. ", "1599": "The current workflow when uploading a file is to register the replica as UNAVAILABLE first Process the upload Switch the replica to AVAILABLE . When the upload fails the command can just be re executed however it is verified that a file with a similar checksum is uploaded. We recently were told about official workflows where the re upload after a failure would be done with a different file Thus same filename but different checksum which does not work in this workflow. The proposed solution is to offer a switch register after upload or something similar where the client uploads first and registers the replica only as AVAILABLE when successful. Thus the pre registration as UNAVAILABLE is skipped. In this case however if the upload is repeated the destination file always has to be over written as it could always be a new file being uploaded as long as it is not registered in the catalog yet. ", "1598": "We implemented a workaround  since gfal doesnt correctly call xroot copy when an archive PFN is given. This can be removed again as soon as gfal is fixed. ", "1593": "The download client only reports suspicious files if there is a checksum mismatch. In case the download fails because of missing files it doesn t report anything. The client should parse the error reported by protocol.get and if it matches some pattern report. Fix it ", "1590": "Testcase runs too fast before cache is invalidated. ", "1589": "Currently the travis tests do not use memcached for value caching. We recently had a test which returned positively without memcached running but did not with memcached. To create a closer to production environment we should also run memcahced in our travis tests. ", "1584": "       DEBUG Traceback most recent call last File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  bin rucio line  in new funct return function args kwargs File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  bin rucio line  in upload upload client.upload items summary file path File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  lib  site packages rucio client uploadclient.py line  in upload final summary file did str scope file scope KeyError scope ", "1582": "rucio tests daemons Automatix.py line  is expecting two values while only one dict is returned generating a too many values to unpack error. guilty line global status ret rsemgr.upload rse info lfns lfns source dir source dir while it receives instead for example  True  u tests  True u tests  True success True pfn u root eosatlas.cern.ch  eos atlas atlasdatadisk ruciotest rucio tests    Fix the functional test! ", "1579": "The client fails if the authentication type is  proxy and the  USER PROXY environment variable is not set with a very confusing error message rucio whoami        ERROR coercing to Unicode need string or buffer module found ", "1578": "There is potential data loss if the judge evaluator gets stuck and the reaper continues working. One possibility to prevent this would be to stop the reaper once it is detected that the judge evaluator has a significant backlog and restart it once the backlog is processed. ", "1569": "from rucio.core.lifetime exception import update exception from rucio.db.sqla.constants import LifetimeExceptionsState update exception  LifetimeExceptionsState.APPROVED Traceback most recent call last File stdin line  in module File usr lib  site packages rucio db sqla session.py line  in new funct result function args kwargs File usr lib  site packages rucio core lifetime exception.py line  in update exception query.one File usr   site packages sqlalchemy orm query.py line  in one Multiple rows were found for one sqlalchemy.orm.exc.MultipleResultsFound Multiple rows were found for one Replace call to one with first . ", "1568": "Recently since mid August we have seen many errors in ARC CEs from looking up replicas in Rucio which look like the following DEBUG GET HTTP  Host rucio lb prod.cern.ch  Connection keep alive user agent ARC x rucio auth token dcameron DC ch DC cern OU Organic Units OU Users CN dcameron CN  CN David Cameron unknown xxx DEBUG No security processing check requested for incoming DEBUG HTTP   Not Found DEBUG Content Type text plain charset utf  DEBUG X Content Type Options nosniff DEBUG Date Wed  Sep     GMT DEBUG Content Length  ERROR Failed to obtain information about file No such file or directory HTTP error when contacting server Not Found I can repeat the problem using arcls and it happens maybe one out of  times. ARC is using direct REST calls rather than the rucio client and I cannot recreate the problem with the rucio client so maybe it has some internal retries. Transient errors with the Rucio server are not a big deal for ARC because they are retried but a  is interpreted as a permanent error so the job actually fails. Can you check what is causing it and if it is a temporary problem return something like  so the look up is transparently retried? ", "1561": "from rucio.core.lifetime exception import list exceptions next list exceptions  None Traceback most recent call last File stdin line  in module File usr lib  site packages rucio db sqla session.py line  in new funct for row in function args kwargs File usr lib  site packages rucio core lifetime exception.py line  in list exceptions query query.filter id exception id TypeError filter got an unexpected keyword argument id Replace call to filter with filter by . ", "1560": "Should be default true everywhere and also work for datasets not only files. ", "1559": "While we are waiting for support for PFN style ?xrdcl.unzip in xrdcp and gfal copy to be deployed we need a workaround. We can t globally switch everything from gfal as the default implementation to xrd yet due to unknown side effects and we re still in data taking so we need a hardcoded override. If there s a download with a xrdcl.unzip extension transparently convert it to xrdcp zip . Once xrdcp and gfal copy are there we can take it out again. ", "1555": "", "1554": "It would be nice to have a WebUI page equivalent to the rucio admin rse info command. ", "1551": "Wrong handling of the replica restriction causes crashes in Judge repairer. ", "1550": "This comes up again for LRZ as we have a broken server. What is possible now if we have a list of files to be marked temporarily unavailable? I am no longer pushing for rucio to know the pool info a list produced by the site is fine if it can be handled in bulk. Files marked unavailable would not show up in list replicas also in deep dataset replica lookup used by panda mark complete datasets as not complete panda uses complete replicas to avoid file replica lookup not trigger recovery from other replicas The critical part here is what happens with the replication rules touching these replicas. The state consistent workflow would be to set them to STUCK but this would issue an immediate recovery of these replicas. Leaving the rules in OK state breaks somewhat the consistency of the state machine and could lead to problems if admins forget to set these replicas back to AVAILABLE again. CLI command needed to operate over a list of replicas supplied in a txt file Replicas are marked as UNAVAILABLE Collection Replicas are updated respectively Reverse CLI command needed to make replicas and collection replicas AVAILABLE again ", "1543": "In order to use the CMS TFC  plugin we currently store in json format the TFC rules a stack of regexp of the LFN to PFN translation in the extended attributes of the RSE protocol. Like in Protocols srm extended attributes u space token u CMS u tfc proto u  u web service path u srm  u tfc u protocol u direct u result u dpm  home cms trivcat store PhEDEx Debug  GRIFLLR  GRIFLLR  u element name u lfn to pfn u path match u store PhEDEx Debug  GRIF LLR S u protocol u direct u result u dpm  home cms trivcat store PhEDEx Debug  GRIFLLR u element name u lfn to pfn u path match u store PhEDEx Debug  u protocol u direct u result u dpm  home cms trivcat store PhEDEx Debug  GRIFLLR  GRIFLLR  u element name u lfn to pfn u path match u .  GRIF LLR . . . u destination match u . u protocol u direct u result u dpm  home cms trivcat  u element name u lfn to pfn u path match u . u protocol u  u chain u direct u destination match u . u result u srm   srm   u path match u . u element name u lfn to pfn hostname  prefix dpm  home cms domains u wan u read  u write  u third party copy  u delete  u lan u read  u write  u delete  scheme srm port  impl  The size of the field is currently   . That s enough to contain all the relevant rules of the TFC tested so far LLR and Nebraska but bigger TFC may not fit into this. Talking with Mario Lassnig it may be worth to migrate the extended attribute field to an arbitrary size json encoded field like for the DID metadata . This can be done over the timescale of a couple of releases. That will provide us with a definitive solution for entering the TFC rules in the RSE metadata. In the meanwhile most of the current TFC should fit in to the current size I ll double check this . ", "1535": "Right now the glfn is hardcoded with the atlas path in the metalink. Make it optional for non ATLAS VOs. ", "1532": "", "1529": "Right now setting limits via the command line rucio admin account set limits is a bit of black magic. You have to specify in bytes notoriously human unfriendly and there s an undocumented magic value of  which is shorthand for infinity . Proposed Allow the CLI interface to accept units  instead of  Accept inf and infinity case insensitive . ", "1528": "Currently list replicas checks the site attribute of the RSE and matches it with the client location . However if the site attribute is not set the method crashes. This should be changed and just the wan replica should be returned. ", "1527": "there is only few comments right now. Descriptiv comments would make the code much more understandable. ", "1524": "It s not really an issue for us as we do not use flask in production code just for documentation generation it should be upgraded nevertheless. ", "1523": "There was a bug with the certificate chains in pyopenssl for  which has been fixed in  version  We should change the version from   to   We can probably also remove the direct dependency to pyopenssl in tools pip requires but this has to be checked. ", "1522": "Currently when submitting a job to FTS where both RSEs have verify checksum False it will be set to none in the metadata send to FTS but the checksum are still sent. This leads to certain problems with xrootd  copy on DPM where checksum validation is not working. If a checksum is set in the metadata FTS will currently ignore the verify checksum and will try to validate anyway. Don t send the checksum in the metadata when verify checksum none ", "1516": "It is not possible to access the REST API under and to access the Web UI under within the docker container build with the Dockerfile under etc docker dev. A few modifications can be copied from the demo environment. ", "1512": "I tried to download one file from a dataset and the output from rucio doesn t make sense  tmp cohm rucio get nrandom      PixelBeam.merge.DAOD   Download summary DID     PixelBeam.merge.DAOD   Total files  Downloaded files  Files already found locally  Files that cannot be downloaded  Nothing was downloaded so it should somehow say that there was a problem somewhere in the output. Could this be improved? Thanks a lot! Best Christian ", "1506": "Trying to upload a file when the protocol doesn t support renaming fails with rucio upload rse MANCHESTER scope user.illingwo tmp rucio test         INFO Preparing upload for file rucio test         INFO Successfully added replica in Rucio catalogue at MANCHESTER        INFO Successfully added replication rule at MANCHESTER        INFO Trying upload with srm to MANCHESTER        ERROR list indices must be integers not str The reason is that in the no renaming branch starting here the value of ret is updated if there s a problem but it s not in the case of success. Since the return type depends on the length of ret not setting it causes the index type error above. This looks very similar to  ", "1505": "Many files are now  compatible. It would be good to have a flag to identify them. The files found as  compatible must stay compatible. Any PR submitted that would break the compatibility should be automatically reject by Travis ", "1497": "Stumbled upon them while using Rucio. This issue collects them though they aren\u2019t related. Small patches of little consequence. ", "1494": "E.g. the rsemanager.upload gives different returns if it is a bulk or a single upload which crashes the uploadclient. See  This needs to be reworked there should be a single return type independent of the method being called in bulk or single upload download delete etc. ", "1490": "String responses cannot be decoded into UTF  in Python  since they re already UTF  by default. The function has been removed from the language. provided by XeBoris def parse response data JSON render function ret obj None try ret obj data.decode utf  except AttributeError ret obj data return json.loads ret obj ", "1487": "The upload with no register pfn does not work. wguan  wguan usr bin env rucio v upload rse CERN PROD ES scope transient no register pfn    atlas eventservice      bin hostname        INFO Preparing upload for file hostname        WARNING Upload with given pfn implies that no register is True except non deterministic RSEs        INFO Trying upload with  to CERN PROD ES        ERROR list indices must be integers not str        DEBUG This means the parameter you passed has a wrong type. Completed in  sec. ", "1486": "Futures package should not be installed in Python  environments in fact pip will not allow it which crashes the installation under python  The package should be conditional to python  versions. ", "1485": "There are two config get policy calls in the bin rucio code. However if the policy section is not available in the config an error is raised. This should not happen. Default values should be used. ", "1484": "It is available in rucio download but not in rucio get which makes the client crash. Needs to be added to the get parser too. ", "1483": "Currently it points to the archive should point to the file inside the zip instead. ", "1480": "CVE   ", "1479": "This touches all modules using stomp. Replace dns.resolver with socket.getaddrinfo Remove obsolete TLS session parameter ", "1476": "After today s TCB talk I tried to install rucio clients in a  virtualenv but it fails to find the futures dependency python version Python  pip install rucio clients Collecting rucio clients Collecting futures  from rucio clients Cache entry deserialization failed entry ignored Could not find a version that satisfies the requirement futures  from rucio clients from versions                      No matching distribution found for futures  from rucio clients From what I can see this package is a  backport of a  native package so shouldn t be installed in  ", "1475": "pycrypto None yet Monitor ", "1470": "Add the two clients to the main client object ", "1464": "if we use PFN we should explain that also no register is required ", "1463": "Apparently newer versions of pip don t like the three equals in the cx oracle dependency. Somewhere along the line internally it sticks parentheses around the version description and then the parser chokes on that combination . rucio test illingwo  rucio test pip version pip  from cloud login illingwo rucio test lib  site packages pip python  rucio test illingwo  rucio test pip install rucio Collecting rucio Exception Traceback most recent call last File cloud login illingwo rucio test lib  site packages pip internal basecommand.py line  in main status self.run options args File cloud login illingwo rucio test lib  site packages pip internal commands install.py line  in run resolver.resolve requirement set File cloud login illingwo rucio test lib  site packages pip internal resolve.py line  in resolve self. resolve one requirement set req File cloud login illingwo rucio test lib  site packages pip internal resolve.py line  in resolve one set req to install.extras set dist.extras File cloud login illingwo rucio test lib  site packages pip vendor pkg resources init .py line  in extras return dep for dep in self. dep map if dep File cloud login illingwo rucio test lib  site packages pip vendor pkg resources init .py line  in dep map self. dep map self. compute dependencies File cloud login illingwo rucio test lib  site packages pip vendor pkg resources init .py line  in compute dependencies reqs.extend parse requirements req File cloud login illingwo rucio test lib  site packages pip vendor pkg resources init .py line  in parse requirements yield Requirement line File cloud login illingwo rucio test lib  site packages pip vendor pkg resources init .py line  in init raise RequirementParseError str e RequirementParseError Invalid requirement parse error at  ", "1457": "Thomas saved my day when I tried to run docker for the first time etc docker dev docker compose.yml image rucio dev image rucio rucio dev ", "1455": "Currently the clients only allow downloads from RSEs which are flagged with istape False . There are two issues with this. For some reason in ATLAS the istape attribute has been stored with the value False instead of the value  which means the rse expression only works with the direct string check on False . Secondly as this is hardcoded in the client for communities which do not have their RSEs flagged with istape False the download will not work. We need a better workflow for this. Some options are Extending the RSE Expression parameter with a system default parameter which lists all RSEs. Currently in ATLAS the ALL flag is used for this but again this needs to be created by a script. A system internal parameter would be good. With this a new attribute could be used to flag tape rses tape  . The client can now do the download with the EXPRESSION tape  . Even for communities who do not have the tape flag this query will work. ", "1454": "helm is a tool to manage kubernetes charts packages . It packages pre configures  resources for easy installation. It furthermore provides tools to manage deployed installations on a cluster. Helping to keep track of current installations and performing easy rollbacks. Add the chart to the repository so that other users can download it and use it to install Rucio. ", "1446": "It seems that some PSQL instances do not autoconvert uuid to text when calling  . We can force the conversion e.g. this line query query.filter text mod abs x  id bit  int s s total workers  worker number should actually be query query.filter text mod abs x  id text bit  int s s total workers  worker number ", "1443": "list replicas reply should now enforce protocol priority in rse contents u rses u CERN PROD DATADISK u gsiftp eosatlassftp.cern.ch  eos atlas atlasdatadisk rucio       u root eosatlas.cern.ch  eos atlas atlasdatadisk rucio       u srm srm eosatlas.cern.ch  srm  server?SFN eos atlas atlasdatadisk rucio       Sort PFNs based on protocol priority per RSE e.g. in this case root gsiftp davs srm. ", "1434": "The find matching scheme function sometimes misbehaves returning non compatible protocols e.g.         INFO Thread   PREPARING REQUEST  DID   DAOD   TO SUBMITTING STATE PREVIOUS None FROM u FZK  DATADISK u srm atlassrm fzk.gridka.de  srm  pnfs gridka.de atlas disk only atlasdatadisk rucio     DAOD     TO u davs lcg   atlas atlasdatadisk rucio     DAOD   USING         INFO Thread   PREPARING REQUEST  DID   DAOD   TO SUBMITTING STATE PREVIOUS None FROM u INFN NAPOLI ATLAS DATADISK u srm  dpm   srm  dpm na.infn.it home atlas atlasdatadisk rucio     DAOD     TO u davs lcg   atlas atlasdatadisk rucio     DAOD   USING         INFO Thread   PREPARING REQUEST  DID   DAOD   TO SUBMITTING STATE PREVIOUS None FROM u INFN NAPOLI ATLAS DATADISK u srm  dpm   srm  dpm na.infn.it home atlas atlasdatadisk rucio     DAOD     TO u davs lcg   atlas atlasdatadisk rucio     DAOD   USING         INFO Thread   PREPARING REQUEST  DID     TO SUBMITTING STATE PREVIOUS None FROM u INFN COSENZA DATADISK u davs recas se   dpm cs.infn.it home atlas atlasdatadisk rucio         u BOINC DATADISK u davs data bridge.cern.ch  myfed atlas boinc rucio         TO u srm   srm  atlas atlasdatadisk rucio       USING Suspecting some non thread safe code. ", "1433": "When deleting the last replica of a file reaper deletes the file logically as well but does not delete the contents in the archive contents table. This causes a foreign key constraint error and the reaper gets stuck. ", "1432": "At the moment it is necessary in order to start up rucio server and rucio daemons containers to provide a full rucio.cfg file mounted into the container. Auto generate a default rucio.cfg using  and make single variables configurable using ENV variables. It would make it easier especially for new instances as they would need come up with a complete rucio.cfg even though it s usually just necessary to set the DB connection string and keep the default values. It will also make it easier in Kubernetes to update single configuration values. ", "1430": "If all the replicas of a file are bad there should be an option in rucio admin replicas declare bad to declare all of them bad ", "1427": "Right now list replicas is called in a loop for every did. In cases where the pilot runs over N  files this creates a lot of calls on the server. This should be changed to just one list replicas bulk call. The reason why this is done is that the did could potentially be a dataset and right now if the call is made in bulk the association between resolved files and dataset gets lost. However this association is needed for the traces. The idea would be to expand the list replicas result with the used did. This requires changes in the client and the core. x Adapt list replicas to include the dataset container name in the result x Adapt the downloadclient to list replicas in bulk ", "1423": "The heart beat in the conveyor is done using the full executable arguments. One should only keep the executable the activity option. In addition a bug has been introduced by moving from type request type is not list to isinstance request type list ", "1422": "Currently all list dids are done listing ALL types this should be changed to COLLECTION. ", "1415": "Instead of calling list replicas use locally cached metalink file. Ref PalNilsson ", "1412": "Pilot needs to cache locally the metalink of the replicas without making a second replicas call. Extend list replicas JSON reply with switch to embed metalink in there. ", "1411": "        WARNING Could not submit transfer to Traceback most recent call last File usr lib  site packages rucio transfertool  line  in submit timeout timeout File usr lib  site packages requests api.py line  in post return request post url data data json json kwargs File usr lib  site packages requests api.py line  in request response session.request method method url url kwargs File usr lib  site packages requests sessions.py line  in request resp self.send prep send kwargs File usr lib  site packages requests sessions.py line  in send r adapter.send request kwargs File usr lib  site packages requests adapters.py line  in send raise ReadTimeout e request request ReadTimeout HTTPSConnectionPool host fts.usatlas.bnl.gov port  Read timed out. read timeout  ", "1410": "The link to the DDM Dashboard in the rule page are wrong in case the site as an underscore in it s name. ", "1405": "Currently it s impossible to create an RSE with the nondet flag. ", "1404": "rucio download does a check at the beginning to see if the account is an admin one in case the replica is on tape. It puts unneeded load on the servers. Propose to forbid any access to replicas on TAPE by defaut and add a alllowtape option. If this option is set to True then the admin check is done ", "1394": "In bulk group transfer grouping FTS jobs by rule is sometimes not optimal plenty of jobs with only a few files . Grouping with policy dest is better but it doesn t preserve the activity. A activity dest rse would be useful. ", "1390": "Currently the build process on readthedocs fails. Collecting pycurl  from  rest API  r requirements.readthedocs.txt line  Using cached Complete output from command python setup.py egg info Traceback most recent call last File string line  in module File tmp pip build  pycurl setup.py line  in module ext get extension sys.argv split extension source split extension source File tmp pip build  pycurl setup.py line  in get extension ext config ExtensionConfiguration argv File tmp pip build  pycurl setup.py line  in init self.configure File tmp pip build  pycurl setup.py line  in configure unix raise ConfigurationError msg main .ConfigurationError Could not run curl config Errno  No such file or directory Command python setup.py egg info failed with error code  in tmp pip build  pycurl You are using pip version  however version  is available. You should consider upgrading via the pip install upgrade pip command. ", "1379": "In this case srm is the top priority protocol. If no schemes are given the top protocol is returned. If schemes are given including srm the sorting is done all wrong. print c.list replicas did metalink True rse expression rse client location l schemes None url location TRIUMF  DATADISK domain wan priority  srm srm.triumf.ca  srm  atlas atlasdatadisk rucio       url print c.list replicas did metalink True rse expression rse client location l schemes davs gsiftp root srm file url location TRIUMF  DATADISK domain wan priority  root xrootd.lcg.triumf.ca  atlas atlasdatadisk rucio       url url location TRIUMF  DATADISK domain wan priority  srm srm.triumf.ca  srm  atlas atlasdatadisk rucio       url url location TRIUMF  DATADISK domain wan priority  davs proxy.lcg.triumf.ca  atlas atlasdatadisk rucio       url ", "1378": "this functionality should be replaced by the other methods also in rucio sitemover in pilot. For now schemes protocol protocol otherwise the list replicas with metalink won t work. ", "1377": "rucio upload no register pfns fails while it works with  wguan  wguan usr bin env rucio v upload rse CERN PROD ES scope transient no register pfn    atlas eventservice      bin hostname        WARNING Upload with given pfn implies that no register is True        INFO Preparing upload for file hostname        ERROR An unknown exception occurred. Details no error information passed status code  internal server error server error o    Completed in  sec. The problem is related to rsemanager.exists call which trys to resolve the did on the server with  which does not work as the replica does not exists. In  with bin rucio it was first checked if the did exists and if not rsemanager.exists was not even called. ", "1376": "Internal forward of the rule to the archive. How the callbacks are handled needs to be checked. ", "1375": "Similar to list replicas in the deep listing of dataset replicas Which resolves individual file replicas the archives should be included. ", "1370": "The bad replicas table doesn t contain the bytes associated to lost or corrupted files making it more complicated to provide summaries on lost files. ", "1367": "WebUI page to list Liftetime Model exceptions ", "1366": "change raise raise exception ", "1361": " uses activity Data Rebalancing but the activity defined in ATLAS schema is Data rebalancing . We should use the same activity everywhere and it should be consistent with the share defined in FTS ", "1360": "When uploading files to objectstore with pfn. It can work. But if adding summary the file will be uploaded successfully but it fails to print the summary. Maybe it has some problem to get summary from pfn. wguan  which rucio cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  bin rucio wguan  export  ACCESS KEY  export  SECRET KEY export  IS SECURE True usr bin env rucio v upload rse CERN PROD ES scope transient no register pfn   .ch  atlas eventservice      bin hostname        DEBUG PFN option specified extracting protocol from given PFN         DEBUG Extracting filesize  and checksum  for file transient hostname        DEBUG Automatically setting new GUID        DEBUG Using account wguan        DEBUG Skipping dataset registration        DEBUG Processing file transient hostname for upload        DEBUG Uploading source file to RSE        INFO File transient hostname successfully uploaded on the storage        DEBUG sending trace        DEBUG Finished uploading files to RSE. Completed in  sec. wguan  export  ACCESS KEY  export  SECRET KEY export  IS SECURE True usr bin env rucio v upload rse CERN PROD ES scope transient no register summary pfn    atlas eventservice      bin hostname        DEBUG PFN option specified extracting protocol from given PFN         DEBUG Extracting filesize  and checksum  for file transient hostname        DEBUG Automatically setting new GUID        DEBUG Using account wguan        DEBUG Skipping dataset registration        DEBUG Processing file transient hostname for upload        DEBUG Uploading source file to RSE        INFO File transient hostname successfully uploaded on the storage        DEBUG sending trace        DEBUG Finished uploading files to RSE.        ERROR list indices must be integers not str        DEBUG This means the parameter you passed has a wrong type. Completed in  sec. ", "1359": "deletion left overs of previous attempts of upload is silently failing. consequently upload of current attempt fails. Under investigation. ", "1355": "Need to downgrade to  Last  supported version ", "1354": "The client needs to check for replicas with client extract True and extract them. ", "1353": "Currently only in the normal list replicas ", "1352": "rucio H get rse UAM  DATADISK resolve archives   DRAW          INFO Processing  item s for input        INFO Using  threads to download  files        INFO Thread   Preparing download of   DRAW          INFO Thread   Preparing download of   DRAW          INFO Thread   Trying to download with srm from MPPMU DATADISK   DRAW          INFO Thread   Trying to download with srm from UAM  DATADISK   DRAW          INFO Thread   File   DRAW   successfully downloaded.  MB in  seconds  MBps        INFO Thread   File   DRAW   successfully downloaded.  MB in  seconds  MBps Download summary DID   DRAW   Total files  Downloaded files  Files already found locally  Files that cannot be downloaded  rwxr xr x.  walkerr zp  Jul    DRAW   rwxr xr x.  walkerr zp  Jul    DRAW   For some reason when rse and resolve archives is used out of the  file list replicas makes two. ", "1346": "upload in rsemgr.py tries to delete left overs of previous attempt. But if force scheme is set which is almost all the time to the write wan protocol case of upload the upload function try to delete these left overs with the force scheme protocol. But this can be different from  priority deletion protocol in AGIS e.g. webdav. That s also the case of NDGF  protocol delete create protocol rse settings delete ", "1338": "The metalink frontend is still using the old RSE scheme instead of the new PFN scheme. ", "1335": "", "1334": "If I try to access the demo web ui running with docker compose on I get a  Internal Server error with the following error message from the error log shell Wed Jul      error pid  client   Traceback most recent call last Wed Jul      error pid  client   File usr lib  site packages rucio web ui main.py line  in module Wed Jul      error pid  client   POLICY config get policy permission Wed Jul      error pid  client   File usr lib  site packages rucio common config.py line  in config get Wed Jul      error pid  client   raise err Wed Jul      error pid  client   NoSectionError No section policy It could be fixed by changing the etc docker demo rucio.cfg file from shell permission policy demo to shell policy permission demo But I am not sure if this configuration is needed somewhere else or if the config reader in lib rucio web ui main.py should be changed instead. ", "1329": "I wanted to build the demo setup in etc docker demo but the rucio image build fails at the step RUN pip install rucio rucio webui with the error message Command python setup.py egg info failed with error code  in tmp pip build UzlGRb rucio . It is caused by a missing upgrade by setuptools RUN pip install upgrade setuptools as it is done in the Docker image in etc docker server. ", "1324": "Paramiko needs to be imported in a try except block. ", "1323": "desilva atlas   rucio verbose get user.desilva             INFO Processing  item s for input        DEBUG Processing item user.desilva             DEBUG RSE Expression istape False        DEBUG Splitted DID user.desilva             DEBUG  DIDs after processing input        DEBUG Processing name      did user.desilva      rse istape False no subdir False nrandom None transfer timeout  scope user.desilva type u DATASET force scheme None base dir .        DEBUG Queueing file user.desilva             INFO Using main thread to download  file s        DEBUG Start processing queued downloads        INFO Preparing download of user.desilva             INFO Trying to download with root from TRIUMF  SCRATCHDISK user.desilva             ERROR Failed to download item        DEBUG Logger instance has no attribute getChild        ERROR An unknown exception occurred. Details  items were in the input queue but only  are in the output queue Completed in  sec. ", "1318": "Tests do not work with  ", "1317": "It should actually fail the test ", "1310": "As a new member I am going through the documentation and steps to setup rucio development environment. Suggesting few typo corrections in the documentation and trying to clarify things which were not obvious for a rucio newbie. ", "1307": "Currently travis is using the  version of Oracle XE which doesn t support json but a new  version of the docker image is available is already available on docker hub. ", "1306": "Only resolve parent replicas if switch is True. ", "1305": "rucio H list file replicas   DRAW   SCOPE NAME FILESIZE  RSE REPLICA   DRAW    MB  GOEGRID DATADISK srm se goegrid.gwdg.de  srm  pnfs gwdg.de data atlas atlasdatadisk rucio     DRAW     DRAW    MB  GOEGRID DATADISK srm lapp   srm  dpm  home atlas atlasdatadisk rucio  valid   DRAW     DRAW    MB  BNL  DATATAPE srm lapp   srm  dpm  home atlas atlasdatadisk rucio  valid   DRAW     DRAW    MB  BNL  DATATAPE srm dcsrm.usatlas.bnl.gov  srm  pnfs usatlas.bnl.gov    DRAW RPVLL    Main.recon.DRAW    DRAW     DRAW    MB   LAPP DATADISK srm lapp   srm  dpm  home atlas atlasdatadisk rucio     DRAW     DRAW    MB   LAPP DATADISK srm lapp   srm  dpm  home atlas atlasdatadisk rucio  valid   DRAW     DRAW    MB  UKI  QMUL DATADISK srm lapp   srm  dpm  home atlas atlasdatadisk rucio  valid   DRAW     DRAW    MB  UKI  QMUL DATADISK srm   srm  atlas atlasdatadisk rucio     DRAW   ", "1302": "We have to default to requests  because of the default yum provided package. However  forces requests  breaking the install. We could either downgrade  temporarily disable it or switch to a different type of installation venv ", "1299": "For  we introduced the RSEChecksumUnavailable to make the rucio upload client respect the verify checksum RSE flag. The same exception handling should be done for protocols that do not support renaming i.e. when protocol.renaming False x rse.rsemanager handles RSEChecksumUnavailable when protocol.renaming False ", "1298": "Streamline and unify publication of our docker images on dockerhub. x Transfer ownership of dockerhub rucio organisation to release manager x Set up automated build via Dockerfile for server x Set up automated build via Dockerfile for daemon x Set up automated build via Dockerfile for client x Highlight sanctioned images in main README.md ", "1295": "Lifetime exception request interface doesn t properly show errors ", "1288": "cmd rucio get user.desilva             INFO Processing  item s for input        ERROR findall takes exactly  arguments  given It seems that the definition of findall on python  and python  uses  and  arguments respectively. As we need to be compatible to python  this needs to be fixed. ", "1283": "The scripts for background rebalancing Uniformize the scripts for Nuclei and  diverged. Some options have been implemented in the  one but not backported in the Nuclei one ", "1282": "For consistency reasons. ", "1281": "Idea is to be able to make filters on the broker based on the EVENT TYPE. ", "1276": "The resurrect method doesn t remove the expired at when a DID is resurrected which triggers the immediate deletion of the resurrected DID ", "1273": "Some users would be interested to filter out empty containers in list dids e.g. rucio list dids user.blah blahblah filter type CONTAINER empty False ", "1272": "rucio set metadata did blahblah qwerty key lifetime value         ERROR The resource doesn t support the requested operation. Details lifetime for blahblah qwerty cannot be updated ", "1269": "Currently the docker server and daemon builds fail while installing rucio because of the pycurl dependency needing openssl devel installed. add yum install openssl   ", "1268": "AGIS has moved its endpoint description to a new resource based scheme. rucio.common.dumper.ddmendpoint url has not been adapted to this change. The URLs that it returns are invalid and consequently the Auditor cannot locate the dumps produced by the sites. Build the base URL using arprotocols or switch to the implementation that uses the Rucio client. Update tests and documentation. ", "1263": "localsite is not filled in traces for downloadclient ", "1262": "Currently the schemes have to be given explicitly. However if no schemes are given all schemes should be replied not only the top priority one. ", "1251": "Single memcached for each daemon server brings up some inconsistency issues. We should investigate a single distributed memcached instance. ", "1250": "STAGEIN FAILED Get error Staging input file failed lfn   error stageIn with API faied Logger instance has no attribute getChild can be realted to ", "1249": "At the moment it is used for ALL POST calls but it should only be done for the list replica one where it is needed. ", "1241": "PFN priority needs to be encoded explicitly in data structure. Use that priority also for metalink reply. ", "1240": "The eol at is set on some rules on non pledged RSEs. It shouldn t be the case. ", "1228": "The update replica state in ATLAS doesn t return the proper permission if a user has a physgroup attribute but try to upload on a SCRATCHDISK area ", "1227": "When trying to download a file from the browser it fails with refreshed scratch storage did.js   UUID not found no trace sent. Set UUID correctly for files on page load ", "1226": "Make the current kubernetes config publicly available ", "1223": "From sartiran root  rucio ping        ERROR Cannot authenticate. Details HTTPSConnectionPool host rucio cms.grid.uchicago.edu port  Max retries exceeded with url auth  proxy Caused by SSLError SSLError  u SSL  ALERT CERTIFICATE EXPIRED  alert certificate expired ssl.c         ERROR Please verify that your proxy is still valid and renew it if needed. root  This error has nothing to do with the client proxy it s the server certificate that expired. ", "1222": "The order of selected protocols is not correct in rucio download. Using list replicas directly produces the correct order however ", "1219": "The verify checksum option is nested too deep in the submission JSON to FTS. Needs to be elevated one level higher. ", "1218": "rucio list rse usage returns the RSE usage from different sources Rucio storage expired . It would be good to have an option to list the usage per account. ", "1216": "Currently the manage quota page shows all accounts for an RSE even if they don t have quota or usage. Hide those accounts by default and add a new button to show them if wanted. ", "1215": "Rucio clients are also very restrictive by pinning to specific versions of the dependencies. This is a problem when a different package manager overwrites e.g.  or requests which makes the rucio Entrypoints in the client fail. Relax some of the client dependency version requirements. ", "1214": "The rucio mover does not correctly send traces by not reporting the actual usrdn pandaid etc. Use the CLI parameters provided by the rucio clients trace appid trace dataset trace datasetscope trace eventtype trace pq trace taskid trace usrdn ", "1208": "The old method for rucio download does not use the list replicas PFNs and instead constructs them manually. This workaround allows to use the list replicas PFNs when necessary and will be removed again once we switch to download api next month. ", "1204": "Protection on Apache with a  minute timeout thus it makes sense to put a  minute client timeout. ", "1195": "Currently we only have a fixed set of metadata that is principally exposed via the core meta.py api meta.py client metaclient.py modules. These metadata are strictly enforced based on the schema of the DID and require a schema change for every new metadata field. This task is to support the use of arbitrary key value pairs per DID based on JSON.  x re enable and redo test test meta.py to conform to a new generic metadata interface  x adapt client metaclient.py and bin rucio to use the new metadata interface  x then either create new metadata table with three principal columns scope name json metadata or extend did table with json metadata column to be decided  x adapt api meta.py and core meta.py to use the new schema ", "1193": "There is the suspcion that there are rare cases where server requests time out DB session killed etc. but the issuing client interprets these as succesful. This still needs to be confirmed and reproduced. ", "1190": "Currently the automated build for rucio server and rucio daemons are failing because pip install rucio fails with  uninstall ipaddress . It is a distutils installed project and thus we cannot accurately determine which files belong to it which would lead to only a partial uninstall. Upgrade pip and setuptools and manually remove the ipaddress package. ", "1185": "rsemanager.download downloads the file as filename .part if an  checksum is given. If ignore checksum is set to True the file will not be renamed thus the .part will not be removed from the file name. Make the os.rename call independent of ignore checksum ", "1184": "When the remoteSite in the trace is set to a not existing RSE the dataset thread in Kronos dies and is only restarted the next time kronos is restarted. The file thread is not affected by this. Catch the RSENotFound exception and skip the dataset update if the RSE is invalid. ", "1179": "CMS data transfers for user analysis outputs need additional features for theirs integration user proxy retrieval from myproxy.cern.ch user FTS proxy delegation keep central processing conveyor separate from the user one creation of a transfertool  subclass supporting get user DN starting from scope name get proxy from myproxy key hash username some key from configuration use  python bindings for submitting transfers and delegating proxy only if needed for certain activities and if specified in the Rucio configuration allow conveyor to act in user mode split payload by scopes in order to separate connections to FTS server by user submit transfers using the  subclass created above ", "1177": "Avoid using cronjobs for periodically delegating proxy to  and more generally make delegation function available within the daemons. Include  proxy delegation function in  transfertool using  python bindings. ", "1176": "excerpt from pilot        Singularity. Using command rucio upload guid      no register rse UKI NORTHGRID MAN HEP DATADISK scope   DAOD          rucio sitemo stageOutCmd rucio upload guid      no register rse UKI NORTHGRID MAN HEP DATADISK scope   DAOD          Monitor.py Main pilot monitoring loop job id  state stageout running iteration         ATLASExperim Using path scratch condor pool condor dir  condorg  Panda Pilot   PandaJob memory monitor summary.json        Monitor.py Max memory maxPSS used by the payload is within the allowed limit  B  maxRSS  B        pUtil.py Returning tail stdout dictionary with  entries        Monitor.py onlyUpdateStateChangedJobs True lastState stageout currentState stageout        Monitor.py Debug job prod state running        Monitor.py Main pilot monitoring loop job id  state stageout running iteration         ATLASExperim Using path scratch condor pool condor dir  condorg  Panda Pilot   PandaJob memory monitor summary.json        Monitor.py Max memory maxPSS used by the payload is within the allowed limit  B  maxRSS  B        pUtil.py Returning tail stdout dictionary with  entries        Monitor.py onlyUpdateStateChangedJobs True lastState stageout currentState stageout        Monitor.py Debug job prod state running        rucio sitemo stageOutOutput         INFO Manually set GUID          ERROR An unknown exception occurred. Details no error information passed status code  service unavailable unavailable        rucio sitemo stageOut with CLI failed! Trying API. Error         INFO Manually set GUID          ERROR An unknown exception occurred.Details no error information passed status code  service unavailable unavailable The API must re raise all exceptions in the same way the previous client did. ", "1173": "Help putting together the information about users usage of localgroupdisk I download the dump rse UKI NORTHGRID MAN HEP LOCALGROUPDISK curl s capath  CERT DIR cacert  USER PROXY cert  USER PROXY rse .txt The format of the dump is the following at least according to my guess since there are no headers . RSE scope dataset space creation date last access date while users have datasets with their name in it for example UKI NORTHGRID MAN HEP LOCALGROUPDISK user.marx  Muons.NTUP             the bulk of the data is infact generic data for example UKI NORTHGRID MAN HEP LOCALGROUPDISK archive   Main.merge.DAOD                 to find the users and the rules associated with each dataset I have to loop on all the entries and do a rucio list rules query grep for the RSE again and extract the rule and the user for later use. If I wan t to do any basic algorythm like calculate the space which datasets are older etc I need to merge the information from the dump and from list rules in one file and do other passes on that file and select the rules I can delete usually based on age of datasets but because often the old datasets belong to someone who s gone away I have to chase people and ask other people fi they are still interested in those data. I obviously cannot ask the users to do anything similar. I tried to produce a simple bash script to do the basic for the user name taken from the proxy but it takes ages and I m not surprised they don t use it. For a fixed user name I need to invert the logic and loop on the list rules grepping the dump for the dataset that should be easier. Easier still would be to replace the name of the RSE in the dump which anyway is redundant since the dumps are organised by RSE with the rule id and the user name. In this way I think everything is needed to identify who when how much space and what to delete would be in the same file from the start. The format of the dump would be account rule scope dataset space creation date last access date ", "1172": "The functionality we have for event service in rucio upload pfn requires no register. For non det RSEs we can relax this restriction and allow users to directly rucio upload there. ", "1169": "Travis fails to build containers because pip refuses to install ipaddress which is already installed by yum. In travis Dockerfile remove ipaddress site package before pip calls ", "1168": "The conveyor transfer submitter throws errors like ERROR Operation third party copy not supported by RSE with schemes transfer schema in two instances This is misleading as this error gets thrown twice for different checks and if any of the other settings in wan in protocol domain are not set properly. It also blames the destination when the source is the issue. ", "1163": "The permission for update replicas states is too restrictive and should be extended to TEST endpoints ", "1160": "With rucio  When adding a rule which already exists. Client side rucio add rule  hi NTUP    NDGF  MWTEST DATADISK        ERROR An unknown exception occurred. Details no error information passed status code  internal server error server error o    Server side Tue May      error pid  client   return self. delegate fn self.fvars args Tue May      error pid  client   File usr lib  site packages web application.py line  in delegate Tue May      error pid  client   return handle class cls Tue May      error pid  client   File usr lib  site packages web application.py line  in handle class Tue May      error pid  client   return tocall args Tue May      error pid  client   File usr lib  site packages rucio web rest rule.py line  in POST Tue May      error pid  client   raise DuplicateRule error.args  Tue May      error pid  client   IndexError tuple index out of range error.args  error.args ", "1159": "usr   site packages  init .py  UserWarning The  wheel package will be renamed from release  in order to keep installing from binary please use pip install  binary instead. For details see ", "1158": "jww lapa jww rucio H verbose upload rse UKI NORTHGRID LANCS HEP SCRATCHDISK scope user.jwalder      somemissing         DEBUG Extracting filesize  and checksum  for file user.jwalder      somemissing         DEBUG Automatically setting new GUID        DEBUG Using account jwalder        DEBUG Skipping dataset registration        DEBUG Processing file user.jwalder      somemissing  for upload        ERROR A Rucio exception occurred when registering a file replica in Rucio.        ERROR A Rucio exception occurred when processing a file for upload.        ERROR Provided object does not match schema. Details Problem validating dids Additional properties are not allowed u filename was unexpected Failed validating additionalProperties in schema items additionalProperties False description Data Identifier DID properties  description  pattern a fA F d  type string bytes description Size in bytes type integer  description  pattern a fA F d  type string meta additionalProperties True description Data Identifier DID metadata properties guid description Universally Unique Identifier UUID pattern     fA F  ?   fA F  ?   fA F  ?   fA F  ?   fA F    type string type object name description Data Identifier name pattern A Za   A Za   .   type string pfn description Physical File Name type string rules description Array of replication rules items additionalProperties False description Replication rule properties account description Account name pattern a     type string activity description Activity name enum Data Brokering Data Consolidation Data rebalancing Debug Express Functional Test Functional Test XrootD Functional Test WebDAV Group Subscriptions Production Input Production Output Analysis Input Analysis Output Staging  Export  Tape Upload Download Job Upload Download User User Subscriptions type string ask approval description Rule approval request type boolean null asynchronous description Asynchronous rule creation type boolean null comment description Rule comment maxLength  type string null copies description Number of replica copies type integer dids type array grouping description Rule grouping enum DATASET NONE ALL None type string null ignore availability description Rule ignore availability status type boolean lifetime description Rule lifetime type number null locked description Rule locked status type boolean null meta description Rule wfms metadata maxLength  type string null notify description Rule notification setting enum Y C N None type string null priority description Priority of the transfers type integer purge replicas description Rule purge replica status type boolean rse expression description RSE expression type string source replica expression description RSE expression type string null split container description Rule split container mode type boolean null subscription id description Rule Subscription id type string null weight description Rule weight type string null required dids copies rse expression type object maxItems  minItems  type array scope description Scope name pattern a zA Z     type string state description Replica state enum AVAILABLE UNAVAILABLE COPYING BEING DELETED BAD SOURCE A U C B D S type string type description DID type enum DATASET CONTAINER FILE F type string required scope name type object On instance  u  u  u bytes  u filename u      somemissing  u meta u guid u  u name u      somemissing  u scope u user.jwalder u state u C Completed in  sec. ", "1156": "When spooling up a new dev environment using the rucio rucio dev many tests fail. The first message is an exception that authentication with username and password fails. x Update Dockerfile x Update packages installed by yum x Install all requirements with pip such that tools run tests docker.sh may be used x Remove python ipaddress package to handle pip dependencies x Update rucio.cfg to streamline with travis container x Change mysql credentials in docker compose.yml to rucio.cfg ", "1155": "No exceptions are handled for list rse attributes in the REST API in particular RSENotFound ", "1149": "In issue  I handled an exception to respect the verify checksum flag with the rucio cleint. Unfortunately the protocol.stat function raises a ServiceUnavailable when the endpoint does not return a checksum. In this case the client should raise a more specific exception that can be be handled in the rsemanager. x In rucio.common.exceptions define ChecksumUnavailable exception. x In stat function of protocols raise ChecksumUnavailable In place of ServiceUnavailable when the checksum query fails. x In rsemanager catch ChecksumUnavailable and depending on verify checksum flag set file as valid if verify checksum is false else raise ServiceUnavailable with same message ", "1144": "Currently the credentials section in the config must be filled otherwise Rucio does not work. However as this is an optional feature the config should also be optional. ", "1143": "When calling lifetime get scratch policy account rses lifetime session session the policy filter is applied to the method. However if an organisation such as generic is set which is not in the mapping the method is replaced by a null funct returning a NoneType. Thus in cases where the line above is called with a lifetime of eg  it is replaced by None . rucio add rule user.mlassnig my test dataset lifetime   MANCHESTER CAMBRIDGE  rucio rule info  Expires at None When doing update rule with lifetime the method even crashes completely as it cannot handle the Nonetype in that case. Expected behaviour In cases where no respective method is set the lifetime argument should just be passed through. ", "1138": "When querying for a did which is also content of an archive list replicas should return the did of the archive file in a way that the client can download the file. e.g. use xroot to directly download the content of a zip ", "1137": "The CLI should be able to download a content file of an archive via xroot. At first the client should be able to do this by explicitly parameterizing both the content file name as well as the archive name. In a second step once the list replicas issue  is done the client should be able to do this transparently by just giving the content file name. ", "1128": "The regular expression for validating the did names in lib rucio common schema cms.py fails with  when validating datasets with a in the name. It seems this is because is doubled in the regex. I ll make a small PR with the fixed version Regards Andrea  Details Problem validating did ZPrimeToTTJets     madgraph tauola StoreResults   PU     TLBSM   bugfix  USER does not match A Za   A Za   .   Failed validating pattern in schema properties name description Data Identifier name pattern A Za   A Za   .   type string On instance name ZPrimeToTTJets     madgraph tauola StoreResults   PU     TLBSM   bugfix  USER ", "1127": "Right now the lifetime field default is empty thus resulting in infinite rules Except for SCRATCHDISK rules where it is  days . This should be changed to  days per default except for SCRATCHDISK where it should stay with  ", "1118": "The conveyor crash if verify checksum is a bool instead of a string ", "1117": "To clearly separate functional tests for  party protocol commissioning. ", "1116": "Returns only the first character of the error string instead of the full string.    ", "1115": "For NONE grouped rules no DATASETLOCK OK notifications are created as they do not have datasetlocks. It would be helpful to have a new notification RULE OK which is invoked for all rules when they reach the OK state. The notification mode CLOSE should be respected the same way as DATASETLOCK OK notifications are handled. ", "1104": "when  calculation fails the key is missing in dictionary what causes failing the of the download without declaring a file suspicious.  None proposed by TWAtGH ", "1093": "There are two private variables in the module which are not accessible to the class. ", "1092": "Due to the new verify checksum mapping.         INFO   Got  transfers for Functional Test XrootD         INFO   Starting to group transfers for Functional Test XrootD         CRITICAL   Traceback most recent call last File \u201c usr lib  site packages rucio daemons conveyor submitter.py\u201d line  in submitter grouped jobs bulk group transfer transfers group policy group bulk fts source strategy max time in queue File \u201c usr lib  site packages rucio daemons conveyor common.py\u201d line  in bulk group transfer \u2018verify checksum\u2019 transfer \u2018verify checksum\u2019 KeyError \u2018verify checksum\u2019 ", "1086": "The current images for server and daemon rely on systemd to run or supervisord. This complicates things if run directly on docker as privileged mode is needed and it doesn t work on Kubernetes. systemd is not really necessary when run in docker as only single services will run a container i.e. apache can be started in FOREGROUND and one daemon will be started per container. This will make deployment in Kubernetes much easier and the images can still be used on a standalone docker installation. Remove the rucio systemd  base image as it will not be needed anymore. The server and daemon images will be based directly on centos  and only necessary dependencies will be installed. This will then also reduce the size of images. ", "1083": "lib rucio common client.py is probably unused and can be removed ", "1080": "SQLAlchemy package update to  alembic package update to  web.py package update to  python dateutil package update to   package update to  ipaddress package update to  cffi package update to  package update to  cryptography package update to  protobuf package update to  grpcio package update to  numpy package update to  kerberos package update to  paramiko package update to  ", "1078": "dogpile.cache package update to   package update to  futures package update to  ", "1077": "If list rules does not find a rule for a DID it automatically looks for rule on the content of a DID. The CLI should at least give a warning when it does this. ", "1060": "The table mapping compatible mapping is erroneous Fix the mapping table ", "1057": "Wrongly mangles third party copy into third party copy wan ", "1056": "rucio list file replicas rse RSE EXPRESSION doesn t return anything whereas specifying explicitly the RSE vname works Fix list file replicas to support RSE expression ", "1055": "rucio download upload support the option transfer timeout see issue  but this is not implemented in all protocols and even for supported protocols e.g. gfal the underlying process can get stuck For all protocols implement a watcher process in the rucio downloadclient uploadclient libraries that kills the transfer after the transfer timeout expiration. ", "1054": "Google Cloud Storage supports signed  URLs just like AWS with a slightly different header . We need this support primarily for rucio clients to upload to and download from GCS since we cannot distribute the GCS access keys to our users. ", "1051": "Traceback most recent call last File archive.py line  in module c.add files to archive name zipfile scope user.walkerr files flist File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  lib  site packages rucio client didclient.py line  in add files to archive return self.attach dids scope scope name name dids files File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  lib  site packages rucio client didclient.py line  in attach dids raise exc cls exc msg rucio.common.exception.RucioException An unknown exception occurred. Details u cx Oracle.IntegrityError ORA  unique constraint ATLAS RUCIO.DIDS PK violated n ", "1048": "Hi Cedric the checksum validation was improved to have all checksum possibilities. Before when you where indicating verify checksum True was applying the checksum to both source and destination and if you were using False the verification was not applied. I just keep the True and False for compatibility with the API. But we encouraged when this new feature was presented in the steering to use both if you want a checksum verification in source and destination source when you only wants the verification on the source destination just to verify in destination and none for no verification. So you can provide the verification that adapts better to your needs as it is documented. Cheers Maria ", "1045": "Due to the join of the two tables only accounts with usage and quota are listed however accounts without quota should be listed as well. ", "1044": "Details of this issue are discussed in The issue is that the current auto approval of rules works the same for users with quota which is full and without. The idea here is to have a different auto approval mode which does not auto approve accounts without quota but only the ones with. Due to group membership ", "1040": "The verify checksum RSE attribute is passed as a string instead of a bool to FTS Cast the string to bool ", "1039": "The  package is deprecated and has been replaced by pycodestyle. This has to be changed in the packages to use the newest version of pycodestyle  ", "1038": "rucio download and rucio upload now accept transfer timeout with a default currently hardcoded to  seconds. The default should be configurable in rucio.cfg separately for download and upload fallback to  if not defined in rucio.cfg  Add new download and upload sections to rucio.cfg each with a configurable transfer timeout parameter  bin rucio should get transfer timeout in order from command line rucio.cfg default  ", "1036": "Extend the client test to run nosetests v lib rucio tests test bin rucio.py for python  with allow faillures Make lib rucio tests test bin rucio.py executable without any server dependencies ", "1032": "SEs with type proxyinternal need to be added removed to each RSE from that particular site with the following rse attribute key root proxy internal value root hostname port port mandatory default  no trailing slash ", "1029": "", "1025": "Add sphinx build T doc source doc build html and check if the status is not different than  ", "1024": "Fix setuptools package updaye to  to avoid issue with old setuptools version like install fails with install requires must be a string or list of strings ", "1023": "Add a complete list of all publications master s phd s articles papers related to DDM  Rucio to the webpage. Link to PDF where possible. ", "1022": "Add sqlite as a backend to test in travis ", "1020": "Provide all dev. dependencies in extra require for setup.py pip install . dev ", "1019": "Add  and pylint python  syntax check for rucio allow failures mode to start upgrading the code to be  syntax compatible. ", "1018": "Test Rucio with different configuration db testing oracle mysql postgres sqlite python       packaging validation rucio client syntax validation  pylint with  and  test server client ", "1017": "Test the packaging of rucio clients with different python versions and execute the client test suite nosetests v lib rucio tests test clients.py against a Rucio server running within a container with sqlite. ", "1012": "Update to the latest version of   but with it we have  lib wc    Mostly  do not use bare except . If we ignore this error we are let with lib rucio tests test did.py    ambiguous variable name l lib rucio client     ambiguous variable name l lib rucio client     ambiguous variable name l Modifcation Ignore  in  for now Fix  ", "1009": "Add conditional requirements to . tools pip requires to mark the non compatible  packages and support pip install r . tools pip requires for python  ", "1007": "The CMS schema is too permissive on RSE names scopes and possibly LFNs Make these match actual CMS requirements and add testing to verify it ", "1005": "CMS has run into two problems with permissions  A user cannot remove their own rules ATLAS allows this .  Root cannot delete replicas. As long as PhEDEx is moving data under the hood for us we think we need to be able to do this. ", "1004": "After detach an entry will add into table contents history. If one attach and detach it again a same entry can not add into table because of primary key constrain. As a result the DID can never be detached . ", "1001": "When reading through the documentation ActiveMQ is presented as a main example for integration. While researching getting familiarized with the project it helps the reader to easily flow towards referenced projects a.la. wikipedia . Add link to Apache s ActiveMQ project in the documentation areas where it is referenced. ", "999": "After cloning the repo I do a pip install r requirements.readthedocs.txt which installs the dependencies tada However docker compose etc docker dev docker compose.yml Traceback most recent call last File usr bin docker compose line  in module load entry point docker compose  console scripts docker compose File usr lib  dist packages pkg resources init .py line  in load entry point return get distribution dist .load entry point group name File usr lib  dist packages pkg resources init .py line  in load entry point return ep.load File usr lib  dist packages pkg resources init .py line  in load return self.resolve File usr lib  dist packages pkg resources init .py line  in resolve module import self.module name fromlist name level  File usr lib  dist packages compose cli main.py line  in module from bundle import get image digests File usr lib  dist packages compose bundle.py line  in module from .service import format environment File usr lib  dist packages compose service.py line  in module from docker.utils import LogConfig ImportError cannot import name LogConfig I propose to add logconfig  to the requirements. ", "997": " lib rucio client clis rucio.py lib rucio client clis rucio.py    undefined name result read bin rucio instead of lib rucio client clis rucio.py if args.estimate ttc if result   print Expected transfer start in  minutes. rule estimated start in  print Expected transfer end in  minutes. rule estimated end in  else print Couldn t calculate the TTC for any of the transfers. No sources selected yet? but result doesn t exist. ", "992": "Add entry points for the command rucio and rucio admin to install them automatically onto the user\u2019s PATH so that they can be executed directly from a terminal session. ", "985": "Fix typographical errors that are present in the Rucio documentation acquire experience with the Rucio development pipeline. Fixing said typographical issues ", "976": "policy ? ", "973": "", "965": "usr rucio tools probes common check ping rucio servers rucio server int  Traceback most recent call last File usr rucio tools probes common check ping rucio servers line  in module print Rucio version installed s c.ping version File usr lib  site packages rucio client pingclient.py line  in ping if r.status code codes.ok AttributeError NoneType object has no attribute status code ", "964": "rucio cients root rucio server int  virtualenv  rucio admin account list the JSON object must be str not bytes This means the parameter you passed has a wrong type. rucio cients root rucio server int  virtualenv  rucio admin rse list the JSON object must be str not bytes This means the parameter you passed has a wrong type. rucio cients root rucio server int  virtualenv  rucio list rses        ERROR the JSON object must be str not bytes ", "963": "when there are multiple replicas and client is at location where there is an outgoing proxy then the replica listing will only be correct if all replicas are at remote sites or when the local replica is the last in the list to be evaluated Reset domain auto selection request per iteration ", "961": "Traceback         ERROR   Failed to prepare requests    state to SUBMITTING Will not submit jobs but return directly with error Traceback most r ecent call last File usr lib  site packages rucio daemons conveyor common.py line  in submit transfer transfer core.prepare sources for transfers xfers ret File usr lib  site packages rucio db sqla session.py line  in new funct result function args kwargs File usr lib  site packages rucio core transfer.py line  in prepare sources for transfers raise RucioException Failed to prepare transfer request s does not exist or is not in queued state request id RucioException An unknown exception occurred. Details Failed to prepare transfer request  does not exist or is not in queued state ", "954": "Currently there is no interface definition for the transfertool The  is the only implementation and de facto the interface definition. However there are many proprietary methods and especially not necessary methods in the  Thus it is beneficial to specify a proper interface and to also cleanup the  ", "949": "Classifiers were changed to tuple which does not work needs to be a list. ", "943": "cx Oracle.NotSupportedError Variable TypeByValue unhandled data type result SQL u UPDATE atlas rucio.dids SET events events updated at updated at WHERE atlas rucio.dids.scope scope  AND atlas rucio.dids.name name  parameters events  u name      Wtaunu        updated at datetime.datetime        u scope    Background on this error at one .one  ", "942": "Exception from server is not properly returned to client. Fri Mar      error pid  tid  Traceback most recent call last Fri Mar      error pid  tid  File usr lib  site packages rucio web rest did.py line  in POST Fri Mar      error pid  tid  issuer ctx.env.get issuer recursive recursive Fri Mar      error pid  tid  File usr lib  site packages rucio api did.py line  in set metadata Fri Mar      error pid  tid  return did.set metadata scope scope name name key key value value recursive recursive Fri Mar      error pid  tid  File usr lib  site packages rucio db sqla session.py line  in new funct Fri Mar      error pid  tid  result function args kwargs Fri Mar      error pid  tid  File usr lib  site packages rucio core did.py line  in set metadata Fri Mar      error pid  tid  update key value synchronize session fetch Fri Mar      error pid  tid  File usr   site packages sqlalchemy orm query.py line  in update Fri Mar      error pid  tid  update op.exec Fri Mar      error pid  tid  File usr   site packages sqlalchemy orm persistence.py line  in exec Fri Mar      error pid  tid  self. do exec Fri Mar      error pid  tid  File usr   site packages sqlalchemy orm persistence.py line  in do exec Fri Mar      error pid  tid  values self. resolved values Fri Mar      error pid  tid  File usr   site packages sqlalchemy orm persistence.py line  in resolved values Fri Mar      error pid  tid  desc entity descriptor self.mapper k Fri Mar      error pid  tid  File usr   site packages sqlalchemy orm base.py line  in entity descriptor Fri Mar      error pid  tid  description key Fri Mar      error pid  tid  InvalidRequestError Entity class rucio.db.sqla.models.DataIdentifier has no property EVENTS Fri Mar      error pid  tid  ", "941": "Setting up rucio  rucio list datasets rse UCSC LOCALGROUPDISK SCOPE NAME from rucio.client import Client c Client c.get dataset locks by rse UCSC LOCALGROUPDISK Traceback most recent call last File stdin line  in module File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  lib  site packages rucio client lockclient.py line  in get dataset locks by rse status code result.status code File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  lib  site packages rucio client baseclient.py line  in get exception data parse response data File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  lib  site packages rucio common utils.py line  in parse response return json.loads data object hook datetime parser File usr   json init .py line  in loads return cls encoding encoding kw .decode s File usr   json decoder.py line  in decode obj end self.raw decode s idx w s  .end TypeError expected string or buffer ", "938": "Extend setup rucio client.py to support more python version. ", "935": "Grammatical error in the client API reference documentation. In the file api.rst ", "930": "Collecting futures  from r tools pip requires client line  Could not find a version that satisfies the requirement futures  from r tools pip requires client line  from versions                      No matching distribution found for futures  from r tools pip requires client line  ", "929": "Setting up Rucio demo environment I am trying to set up Rucio demo environment and following I have docker compose tool and running the command sudo docker compose file etc docker demo docker compose.yml up d gives the following error demo mysql  is up to date Starting demo rucio  error ERROR for demo rucio  Cannot start service rucio driver failed programming external connectivity on endpoint demo rucio   Bind for   failed port is already allocated ERROR for rucio Cannot start service rucio driver failed programming external connectivity on endpoint demo rucio   Bind for   failed port is already allocated ERROR Encountered errors while bringing up the project. I have docker installed following is the docker version output I tried sudo netstat ntpl grep  here is the output     LISTEN  docker proxy I also tried lsof i  output Any plausible way to work this out.? ", "928": "Probably due to propagation of SIG in the code? ", "913": "filter and replications rules are hard to read in subscriptions table Pretty print json in subscriptions table ", "912": "Add the release notes to the repository so that they are available on the documentation. ", "910": "Broken link in the documentation for RSE Expressions. Link on the page Two possible ways  Replace broken link with this one need confirmation.!  Create a new Github page with the content on the link and add some modification if required ", "906": "File usr lib  site packages rucio web rest rule.py line  in POST raise DuplicateRule error.args  IndexError tuple index out of range  needs to be removed. ", "886": "To go through the documentation and submit my first patch. Fixed some grammatical errors in the documentation. ", "875": "For the dynamic  function the module importlib is used. However importlib is not part of python  thus it breaks the clients used on the ATLAS local root base. One option would be to use the backport of importlib for python  on pypi needs to be investigated. Adding importlib to the dependencies works for python  and  but a install on python  fails like this. For now we move the import to a conditional part of the code as no module gets dynamically loaded at the moment anyway This needs to be addressed later on with the dynamic loading of permissions and policies as this should be handled in a similar way. ", "870": "Causes component message templates to be prepended even when CLI message is given. bash magic ", "867": "To submit first patch. Fixing some typos in documentation. ", "862": "Script needs to scroll pages. ", "850": "setup.py and setup rucio.py should be the same file ", "849": "Sometimes transfers end up in protocol mismatch error despite there are matching schemes Fix it ", "847": "When uploading to CERN EXTENSION GRIDDISK the Rucio client fails because it attempts to verify the checksum. At the moment the verify checksum flag is set for the RSE and not ask the storage for the checksum. The suggested modification will then also skip the verification of the file size on storage. The stat call checking the file size should be OK and in this scenario is even more important to be verified in I loathe to put this modification at the protocol level hence the suggested modification please let me know if you have better ideas. x copy verify checksum RSE attribute to RSE info x get verify checksum from RSE info in rsemgr.upload x always declare uploaded file as valid if ignore checksum is True. Some notes On line of the rsemgr add python valid True if ignore checksum is True else False After discussion with Martin we decided that verify checksum should conceptually be RSE info and to copy it analagously to the  algorithm attribute info. ", "819": "We need to make Rucio clients  compatible Proposed incremental scenario each step should be one or several pull requests x Enable  in travis to report  incompatibility x change print by print x change xrange range x Fix dict.keys dict.values to list x Fixed exception to be  compatible x compatible imports x float Long etc x Unicode vs byte string x having a  packaging ping test in the test suite for the clients once the migration is complete e.g. tox x Check compatibility with different Python  versions Currently works with  but not with  others maybe  interpreter will tell ", "811": "Mario suggested a patch when I added the  sum calculation to the clients in  x add myself as author to the headers and it s  not  x Sanitize variables eg.  checksum vs  digest rename checksum  checksum rename  digest  checksum note in the DB the keys will stay  and  x test that the hello test n  is correctly reported ", "808": "Following the RSE on leads to a non existing page. Either the link in needs to be made lower case or the file needs to be renamed to RSE Expressions . ", "807": "datetime.timedelta  is not as readable as datetime.timedelta days  . Though there are only four such cases in the Rucio source code two of those require additional discussion as they might reveal subtle bugs. What is implied and what is actually done differs.  In tools probes common check used space the current time and the timestamp in the database are compared. If the range between the two is longer than datetime.timedelta  the entry is considered stale. However the message is \u2018Used space has not been refreshed for more than  hour .\u2019  In lib rucio tests test replica.py there is the following assignment tomorrow datetime.utcnow timedelta  . It feels like either the argument is wrong or the variable name is misleading. I intend to explicitly add the days keyword to all instances and depending on the feedback provide fixes for the two cases described above. ", "806": "Storage Resource Reporting SRR is a specification of\u2014among other things\u2014how storage services should report usage information. For that purpose it is intended to become an alternative to or replacement of SRM. Two of the WLCG storage providers EOS and DPM are actively working on it and have provided prototype implementations. Other providers have expressed their intention to support it. Recently EOS started reporting usage information on three instances among them EOSATLAS at CERN based on this specification. The goal is to have support for this file format in Rucio so that it may be used as more WLCG sites start to provide it. My intention is to work on a patch for probes common check storage space so that it can transparently consume both JSON formats. The discussion on whether SRR can replace the Rucio JSON and if so the task of updating the documentation and the schema may be left for a later date. Resources   Extended  GDB Finally here\u2019s how the reporting of the first entry from tools space usage space usage sample.json would look with SRR JSON storageservice storageshares name ATLASLOCALGROUPDISK servingstate open totalsize  path castor ads.rl.ac.uk prod atlas stripInput atlasdatadisk usedsize  numberoffiles  timestamp  message The report can not be created because ", "805": "To be able to access storage at HPC centres e.g. US leadership class facilities we will need to add Globus as an option to transfer files to from the site Add globus as protocol and supporting Globus as a transfertool ", "800": "Flask is being imported in lib.rucio.common.utils file but it is not part of the pip requires clients file. This should be resolved It should not be part of it ", "799": "Fix typos in ", "796": "There is a typo in doc source overview File Dataset Container.rst where \u2018smalles\u2019 should be corrected to \u2018smallest\u2019. ", "793": "", "782": "rucio list dids allows to get a list of DIDs matching a pattern. It would be good to have an option to download by giving a metadata filter e.g. rucio download scope   filter guid  Implement a filter option in rucio download ", "769": "The output of rucio admin rse have some rst titles in it which breaks the rst rucio admin rse info JDOES TEST DATADISK Settings add proper example formatting which should be propagated to all usage examples. ", "763": "", "762": "CREATE UNIQUE INDEX ATLAS RUCIO.QUARANTINED REPLICAS PATH IDX on ATLAS RUCIO.QUARANTINED REPLICAS PATH RSE ID tablespace ATLAS RUCIO FACT  ", "761": "When developing the WebUI or running the demo it is necessary to run the webui with a modified path e.g. That introduces problems with all the links then pointing to invalid addresses. Automatically modify the links to add the necessary prefix. ", "757": "", "754": "", "752": "My conveyor transfer submitter is getting this error         WARNING Could not submit transfer to Traceback most recent call last File usr lib  site packages rucio transfertool  line  in submit bulk transfers timeout timeout File usr lib  site packages requests api.py line  in post return request post url data data json json kwargs File usr lib  site packages requests api.py line  in request return session.request method method url url kwargs File usr lib  site packages requests sessions.py line  in request resp self.send prep send kwargs File usr lib  site packages requests sessions.py line  in send r adapter.send request kwargs File usr lib  site packages requests adapters.py line  in send raise SSLError e request request SSLError HTTPSConnectionPool host  port  Max retries exceeded with url jobs Caused by SSLError SSLError bad handshake Error SSL routines  read bytes  alert unknown ca I looked at the code and I see that in  module it says do not try to verify the certificate r requests.post s jobs external host verify False cert USERCERT USERCERT data params str headers Content Type application json timeout timeout So I am puzzled why this is happening ? ", "749": "", "742": "In some cases the the DN reported by Apache to the authentication module of the webui misses the leading slash. This doesn t affect us on our production system because the DNs is reported correctly there. But in the docker demo with the self signed certificates this becomes a problem. Manually add the leading slash if it is missing. The same is already done in the authentication module in the Rucio REST interface. ", "738": "I am using rucio with Postgres  backend. I am getting the following error in the covneyor transfer submitter         CRITICAL   Traceback most recent call last File usr lib  site packages rucio daemons conveyor submitter.py line  in submitter retry other fts retry other fts File usr lib  site packages rucio daemons conveyor submitter.py line  in get transfers failover schemes failover schemes File usr lib  site packages retrying.py line  in wrapped f return Retrying dargs dkw .call f args kw File usr lib  site packages retrying.py line  in call return attempt.get self. wrap exception File usr lib  site packages retrying.py line  in get six.reraise self.value  self.value  self.value  File usr lib  site packages retrying.py line  in call attempt Attempt fn args kwargs attempt number False File usr lib  site packages rucio db sqla session.py line  in new funct raise DatabaseException str error DatabaseException Database exception. Details  function  uuid does not exist LINE  activity User Subscriptions AND mod abs x  rule i the SQL is SELECT anon  AS anon  id anon  id AS anon  rule id anon  AS anon  scope anon  AS anon  name anon  AS anon   anon  AS anon   anon  AS anon  bytes anon  AS anon  activity anon  AS anon  attributes anon  attempt id AS anon  previous attempt id anon  rse id AS anon  dest rse id replicas.rse id AS replicas rse id rses.rse AS rses rse rses.deterministic AS rses deterministic rses.rse type AS rses rse type replicas.path AS replicas path anon  count AS anon  retry count sources.url AS sources url sources.ranking AS sources ranking distances.ranking AS distances ranking nFROM SELECT requests.id AS id requests.rule id AS rule id requests.scope AS scope requests.name AS name  AS   AS  requests.bytes AS bytes requests.activity AS activity requests.attributes AS attributes requests.previous attempt id AS previous attempt id requests.dest rse id AS dest rse id requests.retry count AS retry count nFROM requests nWHERE requests.state state  s AND requests.request type request type  s AND requests.activity activity  s AND mod abs x  rule id bit  int   n LIMIT param  s AS anon  LEFT OUTER JOIN replicas ON anon  replicas.scope AND anon  replicas.name AND replicas.state state  s AND anon  rse id ! replicas.rse id LEFT OUTER JOIN rses ON rses.id replicas.rse id AND rses.staging area false AND rses.deleted false LEFT OUTER JOIN sources ON anon  sources.request id AND rses.id sources.rse id LEFT OUTER JOIN distances ON anon  rse id distances.dest rse id AND replicas.rse id distances.src rse id I think it can be fixed by changing the SQL fragment mod abs x  rule id bit  int  to mod abs x  rule id text bit  int  ", "731": "File home docs checkouts readthedocs.org user builds rucio blueprint envs latest local lib  site packages rucio   rucio common doc argparse ext.py line  in run f open os.path.abspath self.options filename IOError Errno  No such file or directory u home docs checkouts readthedocs.org user builds rucio blueprint checkouts latest doc source bin rucio ", "730": "Traceback Tue Feb      error pid  tid  Traceback most recent call last Tue Feb      error pid  tid  File usr lib  site packages rucio core replica.py line  in list replicas Tue Feb      error pid  tid  domain domain scheme Tue Feb      error pid  tid  File usr lib  site packages rucio rse rsemanager.py line  in select protocol Tue Feb      error pid  tid  candidates get possible protocols rse settings operation scheme domain Tue Feb      error pid  tid  File usr lib  site packages rucio rse rsemanager.py line  in get possible protocols Tue Feb      error pid  tid  found s. str rse settings Tue Feb      error pid  tid  RSEProtocolNotSupported RSE does not support requested protocol. Need to catch RSEProtocolNotSupported exception ", "725": "documentation for Installing dev environment ", "722": "bin rucio judge cleaner Traceback most recent call last File bin rucio judge cleaner line  in module run once args.run once threads args.threads File usr lib  site packages rucio daemons judge cleaner.py line  in run if db time client time max offset or client time db time max offset TypeError unsupported operand type s for datetime.date and datetime.datetime ", "721": "The FTS probe currently query the FTS monit page and generate quite some load on the DB. Move to Grafana json ", "718": "Add auto generated CLIs documentation for the daemons Function to get parser consistent headers ", "717": "The downloadclient and uploadclient have been already merged to the repository due to prioritised testing. The code still needs to be sanitised and documented. ", "716": "To have a structured way of importing RSEs their protocols and even distances a json based importer would be beneficial. ", "707": "domain variable is used without being declared first add variable ", "705": "from rucio.core.meta import add key from rucio.db.sqla.constants import DIDType add key datatype DIDType.FILE mysql exceptions.DataError  Data truncated for column key type at row  SQL u INSERT INTO did keys key key type value type value regexp updated at created at VALUES s s s s s s parameters datatype F None None datetime.datetime        datetime.datetime        Traceback most recent call last File stdin line  in module File usr lib  site packages rucio db sqla session.py line  in new funct raise DatabaseException str error rucio.common.exception.DatabaseException Database exception. Details mysql exceptions.DataError  Data truncated for column key type at row  SQL u INSERT INTO did keys key key type value type value regexp updated at created at VALUES s s s s s s parameters datatype F None None datetime.datetime        datetime.datetime        Probably related to str vs unicode Fit it ", "700": "All the datasets produced by Automatix follow the following naming convention dsn tests s. s. s. s. s. s metadata project metadata run number metadata stream name metadata prod step metadata datatype metadata version Provide the possibility to define different naming convention in the automatix configuration ", "697": "If there are multiple equal weight and otherwise identical protocols we should shuffle them when doing the selection. This would prevent the same protocol from being selected over and over. A use case we encountered for this is at NERSC where they offer  identical GridFTP servers all with different endpoints to utilize as part of their RSE they consider load balancing between the hosts to be part of the file transfer service s responsibility. ", "696": "Demo is empty Create RSEs DIDs ", "688": "The travis test script wrongly generates the list of changed files also including files containing py in the name e.g. aliases  ", "684": "The fix to  didn t seem to make FTS happy. Instead if space tokens are omitted from the RSE definition or are none just don t include them in the JSON sent to FTS. ", "679": "It looks like all custom rucio exceptions are calling super . init args kwargs with the wrong arguments. The syntax should be super . init args kwargs Expected behavior ", "678": "Try to improve the finisher speed Add more debug statements remove unneeded sleep ", "671": "Implement upload capabilities in uploadclient Expected behavior ", "670": "As the uploadclient is implemented now the upload code in bin rucio should use the uploadclient. ", "669": "As the downloadclient is implemented now the download code in bin rucio should use the downloadclient. ", "668": "The list replicas method orders the replicas based on the client location on the server side but then puts them into a dictionary hence the order of the replicas is lost. For each replica the dictionary should be expanded with an additional value e.g. order which represents the sorting order. This can be used by the client to order the replicas. ", "667": "The replica selection in the conveyor is based on two things ranking in the sources table and ranking in the distances table. Two things need to be changed x In certain branches of the code sources with distance ranking of  are excluded. This is wrong. Only ranking of None should be excluded. x For the tape selection the distance ranking with the highest value is used. This is wrong. The lowest value should be used. ", "666": "Enable file and dataset downloads from non WebDAV enabled RSEs. Automatically create transfer requests to move requested file or partial dataset to a browser enabled RSE. ", "665": "We want to able to monitor also downloads done directly from the WebUI. Send trace when user clicks on download link. ", "656": "We have two different ranking columns. One in the sources table where a HIGH ranking value is best and the more often a replica is unsuccessfully tried the lower the ranking gets. The source with the highest ranking is used first. The initial ranking value for a source is  But we also have a ranking column in the distances table. Here the value is similar to the agis distance.  is LAN the higher the value goes the worse the link is. Thus a LOW ranking value is best. However the sorting algorithm here also prefers a high value which is wrong. ", "646": "Currently  requires a compatibility option to authenticate with  storage. This can be removed once Davix is modified to do this automatically. Set  True in the job param ", "641": "File home docs checkouts readthedocs.org user builds rucio blueprint envs latest local lib  site packages rucio   rucio db sqla session.py line  in module DEFAULT SCHEMA NAME config get DATABASE SECTION schema File home docs checkouts readthedocs.org user builds rucio blueprint envs latest local lib  site packages rucio   rucio common config.py line  in config get return CONFIG.get section option File usr lib  ConfigParser.py line  in get raise NoSectionError section NoSectionError No section database ", "634": "FTS is currently supporting destination  transfers only from source gsiftp and source srm endpoints. The natural compatibility of source davs is not yet implement. Change SCHEME MAPPING. Once FTS supports source davs the scheme can be extended again. ", "633": "", "629": "code clean up create protocol doesn t need to check the given domain and operation since it gets checked in select protocol Expected behavior ", "626": "Add autogenerated documentation for bin rucio command line tool Based on ", "622": "Update of con.fy to get the default readthedocs template ", "619": "", "612": "The regular expression for naming convention is wrong Fix naming convention validation ", "604": "There is sometimes wrong values in the FTS json used in check rses distance instead of float sometimes current   Handling of non expected value in json in check rses distance ", "598": "If a rule is created whose size goes over the freespace secondary threshold of the RSE the rule should be rejected. ", "597": "Express all dependencies needed to build the documentation on readthedocs ", "596": "Sphinx with the autodoc module cannot import properly the client packages in the readthedocs building environment because of the missing rucio configuration file and then fails in generating the pages. Some attempt to get the configuration file distributed by a rucio clients mock package in the virtualenv of readthedocs failed. Instrument the configuration part of rucio to not fail when it is imported through sphinx to build the documentation. Expected behavior Get the documentation of the APIs. ", "587": "The FTS probe checks the busy links i.e. links with more than X files submitted . It can put some load on the FTS DB. Introduce a flag to enable disable the check of busy link in FTS probe ", "586": "Currently the REST API frontend of Rucio is provided using the web.py framework. This framework is already quite dated and not in development anymore. On the other hand Flask is popular framework that is still actively supported. Overall the effort to also add a flask frontend is not very high. Additionally flask provides the possibility to autogenerate sphinx REST API documentation directly from comments in the code. Change the structure under lib rucio web rest and add two subfolders webpy and flask . The old content goes into webpy and the flask interface will be ported to the other folder. The configuration of aliases in rucio.conf has then to be changed to the new folders. ", "576": "If there is an issue invoking the WSGI script it s possible the response will not contain a nicely formatted JSON object. In such case the Rucio base client will throw a parsing error and the HTTP status code and any other data is lost . Expected behavior Even if we can t discern an error message return the status code to the user instead of a JSON parsing error. ", "575": "The srm scheme currently requires space token as extended attribute however when space token is not set rucio complains about extended attributes and web service path not specfied. Happens in these lines Expected behavior Ideally space token would be an optional attribute and if not used no spacetoken should be passed to FTS transfer job submission command. See also  ", "574": "At many CMS sites space tokens are not used even when SRM is utilized. However it s not currently possible to skip this setting. It may be as simple as setting the space token to the empty string which could be done automatically if not specified. However there might be hidden dependencies that want a non empty string space token. Needs investigation. ", "573": "Following on from RUCIO  the only way to declare all replicas of a file lost is to find all the replicas and declare each one lost. But this fails if replicas have different protocols Detailed information in Migrated from ", "572": "This issue is used to track the changes and todos necessary for the general documentation overhaul for the workshop. General tasks General information x Concepts and Terminology   x Architecture  Depending on how much needs to be done some help might be needed here Developer documentation x Contributer guide from github should be only one line in the TOC vingar x Installing dev environment vingar Docker example written by berghaus can be used here. x REST API description tbeerman Some general information some examples rest auto generated x API description auto generated vingar x CLI description auto generated vingar cserf for rucio rucio admin utilities and daemons User documentation x Installing Rucio clients cserf Mostly already there only docker part needs to be added x Rucio Clients howto  cserf TomasJavurek Should be a generalized version of the ATLAS RuucioHowTo x Demo section based on docker and different steps  tbeerman cserf Basically installing a server daemons etc in docker and then doing some things in this env Operator documentation x General information mlassnig Different ways of deploying rucio. Dependencies DB Transfertool Messaging Monitoring Docker deployment x How to configure Rucio rses accounts etc  cserf x How to version the DB with alembic upgrade and downgrade instructions mlassnig Puppet deployment Kubernetes deployment Bits Pieces x Concepts needs to be expanded with information how a replica actually works on storage with a dataset as example how deterministic non deterministic works how scopes come into play etc.  x How to connect and configure a stroage element to Rucio cserf We also need something about dumps and ACLs in the op documentation How consistency and recovery can be done x List of return codes of bin rucio mlassnig ", "571": "Could be nice to have a countdown timer to the workshop in the main rucio webpage There is a nice clock here timezone aware Expected behavior To display the clock in the rucio webpage. ", "570": "Previously we introduced a mechanism to specify the algorithm used for  at the RSE. The options now are default and identity . The default algorithm creates subdirectories based on hashes of the LFN while identity is the identity function LFN is used directly. As new communities come in each has their own twist on the  mapping. Currently there s no good way to add community specific code for the mapping. I propose we In the Rucio server configuration provide a module that is loaded on startup which can register additional plugins mapping the algorithm name to a Python callable . Continue to allow the algorithm to be set per RSE as an attribute. In the Rucio server configuration specify the default algorithm to use if not specified as an attribute. So Rucio could continue to offer one or two stock algorithms but as experiments mature this can become part of their policies. ", "567": " test cases are parsing the output of rucio download in case of errors. The tests are failing because there are still cases in rucio download where return FAILURE is used instead of raising the appropriate exception. Change return FAILURE statements to raising the correct exceptions. Expected behavior ", "566": "Update concepts terminology section of the documentation x Rucio account x Files Datasets and Containers x Rucio Storage Element x Meta data attributes x Permission model x Replica management x Replication rule examples x RSE Expressions x Accounting and quota x Notifications x Subscriptions Policies ", "563": "The footer in the account usage table is wrong Fix footer in account usage table ", "560": "", "557": "add auto generated API description to the development section. ", "554": "rucio add rule grouping DATASET comment site replica test from Eric cms gluinoGMSB          asymptotic  TrancheIV   MINIAODSIM   US Caltech        ERROR Provided RSE expression is considered invalid. Details Expression does not comply to RSE Expression syntax The same command works if Caltech is substituted with UCSD but both are valid site names in CMS Propagate allowing lower case letters into the RSE attributes as well for the CMS schema Expected behavior ", "551": "Missing doc for the CLI Improve doc for the CLI ", "549": "It would be good to have an easy way to setup a simple Rucio instance to be able to play around with the Rucio CLI tools. Modify the dev images and add a new script to fill the database with demo DIDs and accounts. ", "548": "Currently rucio list rules account displays different rule attributes but not the creation date. Add the creation date to this list. ", "543": "If a site goes into a long downtime but many transfers are already submitted to FTS there will be a lot of failures. A probe collecting the downtimes in AGIS will cancel the FTS jobs if a site is supposed to be down for more than  hours. ", "535": "At the moment read is used for source and write is used for destination for both third party copy should be used. ", "533": "Right now the different configuration permissions atlas cms are part of the core repository. This is not sustainable in the long term. There should be a better way to manage these e.g. separate packages and inclusion via entry points etc. ", "532": "To be able to install directly from master. ", "531": "If a file is suspicious and has more than  replica it can be auto recovered. ", "530": "Rucio rule info should display the TTC. ", "529": "Full support of heartbeats and automatic partitioning for the reaper. ", "525": "To calculate the number of accesses of a file or dataset kronos should also update this information. x Schema change needed to ad nbaccesses column x Changes in Kronos needed to update the column ", "524": "At the moment there are two oracle procedures cron jobs being used to keep the data consistent. However there needs to be a solution for non oracle users. For Postgres it might be possible to also introduce PLSQL Cronjobs but for mysql this is not possible thus daemon implementations for this might be applicable. Update collection replicas Exists only as PL SQL Update of account counters Exists as PL SQL and in the Abacus daemon ", "523": "At the moment downloading and uploading data is only possible via the command line interface. For the rucio movers it is necessary that this functionality exists via python callable methods. Thus the functionality should be added to the python clients Afterwards the bin rucio method can also use these methods for downloading. ", "522": "The probe setting the naming convention check ami is broken. The MERGE INTO statement updating the regexp does not seem to work. ", "519": "Using the API methods in check rse attributes induces a lot of commits since we open a new session each time. Move the methods calls in check rse attributes from the API to the core and reuse the DB session. ", "514": "It s possible to choose the list of activities on which the conveyor will run but it s not possible to exclude some activities Will implement a skip activities opttion for the conveyor ", "513": "The conveyor receiver does not consume messages at the moment. The vo field moved from headers to messages and needs to be checked there. Also the check for false on msg job m replica and the check for true on msg job m replica needs to be lowered. ", "510": "The heartbeat live and die calls in the kronos dataset thread use different executable names and therefore the heartbeats are never removed from the table. Use the both time the same name. ", "509": "rucio list dids h usage rucio list dids h recursive filter FILTER short did List the Data IDentifiers matching certain pattern. Only the collections i.e. dataset or container are returned by default. With the filter option you can specify a list of metadata that the Data IDentifier should match. positional arguments did Data IDentifier pattern optional arguments h help show this help message and exit recursive List data identifiers recursively. filter FILTER Filter arguments in form key value another key next value . Valid keys are name type. short Just dump the list of DIDs. There is no list of available filter options rucio list dids h should expose the list of available options ", "508": "Since the introduction of domains this information is not used anymore and deprecated It was left in the rse settings but is now reason for confusion. These keys should be removed from the rse settings. ", "505": "On the client side from rucio.client.ruleclient import RuleClient r RuleClient r.update replication rule  lifetime  Traceback most recent call last File stdin line  in module File usr lib  site packages rucio client ruleclient.py line  in update replication rule exc cls exc msg self. get exception headers r.headers status code r.status code data r.content File usr lib  site packages rucio client baseclient.py line  in get exception data parse response data File usr lib  site packages rucio common utils.py line  in parse response return json.loads data object hook datetime parser File usr   json init .py line  in loads return cls encoding encoding kw .decode s File usr   json decoder.py line  in decode obj end self.raw decode s idx w s  .end File usr   json decoder.py line  in raw decode raise ValueError No JSON object could be decoded ValueError No JSON object could be decoded the JSON that cannot be decoded is internal server error Looking at the apache logs on server side Mon Jan      error pid  client   update replication rule rule id rule id options options issuer ctx.env.get issuer Mon Jan      error pid  client   File usr lib  site packages rucio api rule.py line  in update replication rule Mon Jan      error pid  client   rule.update rule rule id rule id options options Mon Jan      error pid  client   File usr lib  site packages rucio db sqla session.py line  in new funct Mon Jan      error pid  client   result function args kwargs Mon Jan      error pid  client   File usr lib  site packages rucio core rule.py line  in update rule Mon Jan      error pid  client   rule.expires at datetime.utcnow timedelta seconds lifetime if options lifetime is not None else None Mon Jan      error pid  client    PM TypeError unsupported type for timedelta seconds component NoneType Following Vincent Garonne suggestion I fill an issue as this seems a bug. Expected behavior ", "502": "In version  rucio download always uses the same protocol from an RSE Expected behavior rucio download should fail over to a different protocol when the first one fails. Fail over used to work until version  ", "501": "root  rucio v verbose upload scope user.ewv rse  US NEBRASKA name store data  SingleMuon MINIAOD PromptReco           tmp test.root        DEBUG Extracting filesize  and checksum  for file user.ewv store data  SingleMuon MINIAOD PromptReco                  DEBUG Automatically setting new GUID        DEBUG Using account ewv        DEBUG Skipping dataset registration        DEBUG Processing file user.ewv store data  SingleMuon MINIAOD PromptReco           for upload        INFO Adding replicas in Rucio catalog        INFO Replicas successfully added        INFO Adding replication rule on RSE  US NEBRASKA for the file user.ewv store data  SingleMuon MINIAOD PromptReco                  ERROR list index out of range        ERROR Rucio exited with an unexpected unknown error. Please rerun the last command with the v option and submit a ticket with all the available information to reproduce this error at        DEBUG Traceback most recent call last File usr bin rucio line  in new funct return function args kwargs File usr bin rucio line  in upload trace protocol rse settings protocols  scheme IndexError list index out of range Completed in  sec. Expected behavior ", "496": "root  rucio update rule lifetime          ERROR int object has no attribute lower        ERROR Rucio exited with an unexpected unknown error. Please rerun the last command with the v option and submit a ticket with all the available information to reproduce this error at The variable is forcefully casted to int in argparse thus the .lower of the variable fails. ", "493": "rucio set metadata returns status code  for non existing DID e.g. rucio set metadata did   non existing dataset key transient value  echo ?  Should return non  or an error message ", "490": "The shuffling makes sense if no client location can be detected to distributed the load however if a client location can be detected the list replicas call returns the replica locations already in a sorted order and they must not be shuffled. ", "487": "Approvers want to give a reason when denying a replication rule. This change needs two modifications x WebUI A website where an approver can type in a short reason when denying a replication rule. This can use the same REST call to the server just a comment is supplied as well. x Core Change of the deny method in core and change of the email templates to deliver the reason to the user. ", "486": "Currently the server and daemon images are always using a config with SSL. It should be configurable so that it is possible to easily deploy containers without SSL e.g. for pods in a Kubernetes cluster. Add an ENV variable RUCIO ENABLE SSL . The right config will be created when the container starts. ", "484": "In the method where the target rse is selected  should check if there already exists a collection replica or dataset lock and then skip this RSE. Migrated from ", "483": "Sometimes we get the error in panda for our jobs ddm  Could not add files to DDM Details u One of the PFNs provided does not match the Rucio expected PFN u gsiftp  project projectdirs  atlasdatadisk rucio    cd   vs u gsiftp   project projectdirs  atlasdatadisk rucio    cd   scope u   name u   In this message it does not make it clear which path we should be editing vs which one Rucio is expected. I found the message sitting in rucio src lib rucio core replica.py around line  raise exception.InvalidPath One of the PFNs provided does not match the Rucio expected PFN s vs s s str pfns str expected pfns str lfns So I see the first is probably what we set in AGIS and the second is what you are expecting. Can you make this clear in the error message? Thanks Taylor Migrated from ", "480": "Attempts to finish transfers end with this issue Database exception. Details  operator does not exist boolean integer LINE  WHERE rses.deleted false AND rses.deterministic  AND r HINT No operator matches the given name and argument type s . You might need to add explicit type casts. SQL SELECT rses.id AS rses id rses.rse AS rses rse rses.rse type AS rses rse type rses.deterministic AS rses deterministic rses.volatile AS rses volatile rses.staging area AS rses staging area rses.city AS rses city rses.region code AS rses region code rses.country name AS rses country name rses.continent AS rses continent rses.time zone AS rses time zone rses. ISP AS rses ISP rses. ASN AS rses ASN rses.longitude AS rses longitude rses.latitude AS rses latitude rses.availability AS rses availability rses.updated at AS rses updated at rses.created at AS rses created at rses.deleted AS rses deleted rses.deleted at AS rses deleted at nFROM rses JOIN rse attr map ON rses.id rse attr map.rse id nWHERE rses.deleted false AND rses.deterministic deterministic  s AND rses.availability availability  s OR rses.availability availability  s OR rses.availability availability  s OR rses.availability availability  s OR rses.availability availability  s OR rses.availability availability  s OR rses.availability availability  s OR rses.availability availability  s AND rses.availability availability  s OR rses.availability availability  s OR rses.availability availability  s OR rses.availability availability  s OR rses.availability availability  s OR rses.availability availability  s OR rses.availability availability  s OR rses.availability availability  s GROUP BY rses.id rses.rse rses.rse type rses.deterministic rses.volatile rses.staging area rses.city rses.region code rses.country name rses.continent rses.time zone rses. ISP rses. ASN rses.longitude rses.latitude rses.availability rses.updated at rses.created at rses.deleted rses.deleted at parameters availability   availability   availability   availability   availability   availability   availability   availability   availability   deterministic   availability   availability   availability   availability   availability   availability   availability           WARNING Traceback most recent call last File usr lib  site packages rucio daemons conveyor finisher.py line  in finisher handle requests chunk suspicious patterns File usr lib  site packages rucio daemons conveyor finisher.py line  in handle requests undeterministic rses get undeterministic rses File usr lib  site packages rucio daemons conveyor finisher.py line  in get undeterministic rses rses list list rses filters deterministic  File usr lib  site packages retrying.py line  in wrapped f return Retrying dargs dkw .call f args kw File usr lib  site packages retrying.py line  in call return attempt.get self. wrap exception File usr lib  site packages retrying.py line  in get six.reraise self.value  self.value  self.value  File usr lib  site packages retrying.py line  in call attempt Attempt fn args kwargs attempt number False File usr lib  site packages rucio db sqla session.py line  in new funct raise DatabaseException str error DatabaseException Database exception. Seems that the Postgres refuses to do an implicit cast from integer to boolean. The query in the finisher should do this before handing it to SQLAlchemy. ", "469": "We added a REST API for manipulating the distance information between two links. However we did not add the corresponding CLI. Add corresponding CLI. Expected behavior Set very basic distance information ranking and distance via CLI. More detailed attribute manipulation can remain part of the REST API. ", "468": "Similar to rucio download there should be a protocol failover mechanism in rucio upload if the process does not work. This can probably be c p in large parts. ", "467": "The fix done in  to force GSI authentication did not work for gfal. The related merge request is  ", "464": "The creation of INCOMPLETE messages for datasets whose first file was deleted does not seem to work. This is related to the development done in  There are no INCOMPLETE messages in the message history to be found. Expected behavior Generation of INCOMPLETE messages once the first file of a dataset is permanently deleted. ", "460": "From the CMS instance I noticed this exception thrown in the conveyor transfer submitter after creating some minimal RSEs and trying to trigger a transfer         CRITICAL Exception happened when trying to get transfer for request  Traceback most recent call last File usr lib  site packages rucio core transfer.py line  in get transfer requests and source replicas scheme current schemes File usr lib  site packages rucio rse rsemanager.py line  in find matching scheme dest candidates sorted dest candidates key lambda k k domains domain operation dest File usr lib  site packages rucio rse rsemanager.py line  in lambda dest candidates sorted dest candidates key lambda k k domains domain operation dest KeyError None ", "457": "declare bad file replicas crash when one declare bad file replicas already declared bad on non deterministic RSE because of the check rowcount ! len declared replicas Remove the files already declared from the declared replicas list. ", "453": "Currently in  it possible to jump directly to the RSE selection tab without selecting any DID. Then the quota check will hang without any error message. Prevent the RSE tab to be opened if no DID is selected. ", "450": "With the necessary APIs in place we can now do smart selection of WAN and LAN replicas. extend list replicas to reply with replicas across all domains select correct domain replica in clients based on location ", "447": "The change done in has changed the behaviour of the set new dids method. Before when new flag was set to None the value set in the DB was NULL now it s  It is a problem because this column is indexed. Change the set new dids method to set NULL value instead of  ", "444": "Lifetime is a valid parameter of add container but is ignored Expected behavior Should be passed through to add did ", "439": "The bootstrap procedure mistakenly sets GSS values for SSH. Fix typo ", "436": "In many Rucio REST APIs but not all! Styling is a bit inconsistent between the newest and the oldest APIs the scope name and the DID are encoded as part of the URL. This is problematic for CMS DIDs as there are HTML meta characters utilized in our naming scheme particularly and . It is probably other organizations looking to adopt Rucio will have a similar problem. The client should escape any scope and DID as a part of URL generation. Expected behavior DIDs naming should be limited by the schema in place on the Rucio server not URL rules. ", "433": "In testing of rucio upload I ve sporadically hit cases where  In a sequence of REST API calls one call requires the client to retrieve a new Rucio token.  The client will contact the token issuer endpoint to retrieve a new token.  Since the client reuses the session object an existing SSL session may be utilized.  If the existing SSL session wasn t created with an  user proxy or established via TLS session reuse then mod gridsite isn t able to pass along the appropriate headers about the client DN.  Without the client DN the issuer correctly refuses to issue a new token. Whenever the client receives an authorization failure it should create a new session object prior to retrying the token retrieval. ", "430": "The copyright footer currently reads   Change to   Expected behavior Correct copyright footer in WebUI. ", "429": "Auditor is not able to handle dumps on non SRM endpoint Enable the dump download for gsiftp and davs sites ", "426": "For rucio move rule the permission check is not working thus the default permission is used. ", "425": "automatic mode skips sites where is some active rebalancing rule in STUCK and REPLICATING status. For the moment only REPLICATING shall be used and later it shall count the number of bytes that are currently replicating. test overlap between  and Nuclei shall the rebalancing in these two groups completely seprate? development of softer conditions for rules that can be rebalanced. reduce background rebalancing optimal set of params. very low efficiency of  bg rebalancing ", "422": "After I do some studies I think python module requests can only use  certificate but can not use proxy certificate for SSL. There is no problem if I use  or userpass authentication. So it need mod gridsite for Proxy authentication. But since www.gridsite.org is no longer available I can not figure out how to use or check these setting. LocationMatch auth  proxy GridSiteIndexes on GridSiteAuth on GridSiteDNlists etc grid security dn lists GridSiteGSIProxyLimit  GridSiteEnvs on GridSiteACLPath opt rucio etc gacl LocationMatch solved this issue by pip install  secure  It seems urllib did not enable certification verification by default. According to I install the package and there is no SSL error. PS. I did not found this error by run tests.sh report from Wu Edward ", "420": "Traceback most recent call last File recreate protocol.py line  in module c.add protocol rse rse params protocol File usr lib  site packages rucio client rseclient.py line  in add protocol raise exc cls exc msg rucio.common.exception.RSEOperationNotSupported RSE does not support requested operation. Details Operation third party copy not defined in schema. Add third party copy to the list of supported operations ", "413": "set metadata run on guid only updates guid in the did table but no the content one set metadata should update guid both in did and content table ", "412": "If the computed eol at differs from the recorded one Atropos doesn t take into account the new value. It can lead to expire rules that shouldn t be expired. Check that computed eol at is expired before expiring the rule ", "411": "If we want to be a valid character in the LFN URL escaping in the client suddenly becomes more relevant. For example on the CMS test instance I noticed the following GET request in the logs GET dids user.bbockelm store mc SAM GenericTTbar AODSIM CMSSW      realistic         meta HTTP  We probably wanted to issue this request GET dids user.bbockelm            realistic         meta HTTP  ", "410": "When looking through the logs for something else I noticed the following var log rucio conveyor finisher.log Database exception. Details  column requests.estimated started at does not exist LINE  requests.submitter id AS requests submitter id requests.e SQL SELECT requests.id AS requests id requests.request type AS requests request type requests.scope AS requests scope requests.name AS requests name requests.did type AS requests did type requests.dest rse id AS requests dest rse id requests.source rse id AS requests source rse id requests.attributes AS requests attributes requests.state AS requests state requests.external id AS requests external id requests.external host AS requests external host requests.retry count AS requests retry count requests.err msg AS requests err msg requests.previous attempt id AS requests previous attempt id requests.rule id AS requests rule id requests.activity AS requests activity requests.bytes AS requests bytes  AS requests   AS requests  requests.dest url AS requests dest url requests.submitted at AS requests submitted at requests.started at AS requests started at requests.transferred at AS requests transferred at requests.estimated at AS requests estimated at requests.submitter id AS requests submitter id requests.estimated started at AS requests estimated started at requests.estimated transferred at AS requests estimated transferred at requests.account AS requests account requests.requested at AS requests requested at requests.priority AS requests priority requests.updated at AS requests updated at requests.created at AS requests created at nFROM requests nWHERE requests.state IN state  s state  s state  s state  s state  s state  s state  s AND requests.request type IN request type  s request type  s request type  s AND requests.updated at updated at  s ORDER BY requests.updated at ASC n LIMIT param  s parameters updated at  datetime.datetime        param   request type  T request type  O request type  I state  D state  L state  F state  A state  G state  O state  N         ERROR Thread   Traceback most recent call last File usr lib  site packages rucio daemons conveyor finisher.py line  in finisher thread hb assign thread total threads hb nr threads File usr lib  site packages retrying.py line  in wrapped f return Retrying dargs dkw .call f args kw File usr lib  site packages retrying.py line  in call return attempt.get self. wrap exception File usr lib  site packages retrying.py line  in get six.reraise self.value  self.value  self.value  File usr lib  site packages retrying.py line  in call attempt Attempt fn args kwargs attempt number False File usr lib  site packages rucio db sqla session.py line  in new funct raise DatabaseException str error DatabaseException Database exception. Details  column requests.estimated started at does not exist LINE  requests.submitter id AS requests submitter id requests.e SQL SELECT requests.id AS requests id requests.request type AS requests request type requests.scope AS requests scope requests.name AS requests name requests.did type AS requests did type requests.dest rse id AS requests dest rse id requests.source rse id AS requests source rse id requests.attributes AS requests attributes requests.state AS requests state requests.external id AS requests external id requests.external host AS requests external host requests.retry count AS requests retry count requests.err msg AS requests err msg requests.previous attempt id AS requests previous attempt id requests.rule id AS requests rule id requests.activity AS requests activity requests.bytes AS requests bytes  AS requests   AS requests  requests.dest url AS requests dest url requests.submitted at AS requests submitted at requests.started at AS requests started at requests.transferred at AS requests transferred at requests.estimated at AS requests estimated at requests.submitter id AS requests submitter id requests.estimated started at AS requests estimated started at requests.estimated transferred at AS requests estimated transferred at requests.account AS requests account requests.requested at AS requests requested at requests.priority AS requests priority requests.updated at AS requests updated at requests.created at AS requests created at nFROM requests nWHERE requests.state IN state  s state  s state  s state  s state  s state  s state  s AND requests.request type IN request type  s request type  s request type  s AND requests.updated at updated at  s ORDER BY requests.updated at ASC n LIMIT param  s parameters updated at  datetime.datetime        param   request type  T request type  O request type  I state  D state  L state  F state  A state  G state  O state  N         INFO Thread   Sleeping for a while  seconds Is this a new column? Is it possible some schema evolution didn t get applied at the CMS instance or maybe actually a real bug ? ", "407": "The work in  caused a regression if the permission section does not exist. From the logs mod wsgi pid  Exception occurred processing WSGI script usr lib  site packages rucio web rest did.py . Traceback most recent call last File usr lib  site packages rucio web rest did.py line  in module from rucio.api.did import add did add dids list content list content history File usr lib  site packages rucio api did.py line  in module from rucio.core import did naming convention meta as meta core File usr lib  site packages rucio core did.py line  in module import rucio.core.rule File usr lib  site packages rucio core rule.py line  in module def archive localgroupdisk datasets scope name session None File usr lib  site packages rucio common policy.py line  in policy filter policy get policy File usr lib  site packages rucio common policy.py line  in get policy policy config get permission policy File usr lib  site packages rucio common config.py line  in config get return CONFIG.get section option File usr   ConfigParser.py line  in get raise NoSectionError section NoSectionError No section permission Seems that this exception type is simply not caught. ", "406": "rucio erase user.ewv Astore        INFO CAUTION! erase operation is irreversible after  hours. To cancel this operation you can run the following command rucio erase undo user.ewv Astore Expected behavior Fail with error message ", "403": "If often happens that suspicious files have more than one replica. In that case an automatic recovery can be done without the need of a human confirmation. Automatic recovery of suspicious files that have more than one replica ", "402": "On error it s possible to get something like this        ERROR Rucio exited with an unexpected unknown error. Please rerun the last command with the v option and submit a ticket with all the available information to reproduce this error at linebreaks added by me for readability Should this be just changed to GitHub? Modify rucio CLI as needed to selectively remove references to CERN JIRA there may be some cases that are ATLAS specific where this is warranted . Probably worthwhile to grep through the entire code base to see if there s any other place where this can be done. ", "399": "Make the length of the name configurable ", "394": "add in cms regexp name ", "391": "We have to force remove the newly rolled out ssh support on the clients due to an ALRB  incompatibility. The ssh support will eventually be moved to rucio clients extras . ", "388": "One PostgreSQL test is failing. FAIL DATA IDENTIFIERS CLIENT List dids by pattern. Traceback most recent call last File usr lib  site packages nose case.py line  in runTest self.test self.arg File opt rucio lib rucio tests test did.py line  in test list dids assert equal len results  AssertionError  !  begin captured logging  DEBUG Starting new HTTPS connection  localhost  DEBUG POST accounts jdoe scopes mock  HTTP   None  DEBUG Starting new HTTPS connection  localhost  DEBUG POST replicas HTTP   None  DEBUG Starting new HTTPS connection  localhost  DEBUG POST replicas HTTP   None  DEBUG Starting new HTTPS connection  localhost  DEBUG POST replicas HTTP   None  DEBUG Starting new HTTPS connection  localhost  DEBUG GET dids mock  dids search?type file name file a  HTTP   None  DEBUG GET dids mock  dids search?type file name file a   HTTP   None  DEBUG GET dids mock  dids search?type file name file    HTTP   None end captured logging ", "383": "Passed travis tests exit with  ", "380": "In order to track all contributions to Rucio a separate file AUTHORS is included top level. It includes both individual personal contributors as well as their associated institutes or organisations. ", "377": "Currently rucio upload is a bit tied to the ATLAS concept that the filename on disk foo.root is going to match the filename in Rucio user.bbockelm foo.root . This is a bit broken by CMS where the LFN differs significantly from the name on disk. We should allow the LFN to be specified via a CLI flag just like the GUID. The rucio upload interface should by default retain the current behavior. ", "376": "rucio list files crashes if no GUID is set Protect against guid None ", "375": "rucio list files crashes if no GUID is set rucio list files mock         ERROR NoneType object has no attribute getitem Protect against guid None ", "369": "Imported the full Apache Licence  file ", "368": "Migrated from ", "367": "More detailed report on ATLAS ", "363": "Add the url and field description of the suspicious files dump to the dumps overview page of the WebUI. ", "359": "cp cannot stat opt rucio etc docker travis rucio postgresql.cfg No such file or directory cp opt rucio etc docker travis rucio postgres.cfg opt rucio etc rucio.cfg Expected behavior postgresql tested in travis ! ", "356": "Schema is not configurable per collaboration cms use case Extend the permission and schema part to allow policy permision cms schema cms from the configuration ", "351": "Sorting in case of multiple tape replicas should be done in reverse order  being best  being worst. Also cases where the ranking is  should be skipped. ", "348": "We wrongly forward to instead of davs in the metalink link follow. Change string. ", "345": "To ensure python  compatibility the package paramiko was downgraded to an older version. However it s dependencies such as Crypto need to be pinned to a Python  version as well to ensure compatibility. ", "344": "Instead of having to download a logfile archive manually the WebUI will extract and preview logfile contents below a certain filesize limit directly in a new browser tab. ", "343": "At the moment it is not possible to download entire datasets at once. To make downloading datasets possible in a single step the WebUI will be extended to create a metalink containing download links for all files contained in a dataset. ", "339": "Right now the security policy is encoded into a separate Python module the selected security policy for a given Rucio instance is part of the rucio.cfg . This allows Rucio to implement security policies that differ fairly drastically from ATLAS s default ones. Analogously the current schema is somewhat specific to ATLAS it would be useful if we had an override mechanism to provide a CMS specific schema. For example CMS site names are of the form  US Nebraska this is not currently a valid RSE as RSEs must be capitalized. Another example is CMS LFNs and dataset names which liberally utilize the character as in store generator  BprimeTToBZ    madgraph tauola GEN          and BprimeTToBZ    madgraph tauola     GEN respectively . ", "338": "Each CMS storage endpoint has a set of rules for generating their PFNs. Example With this list of regex based transform rules we can generate a PFN only knowing Desired protocol RSE LFN My understanding is that currently the input to the PFN generation function for the non deterministic case is only desired protocol and LFN . Note that only a few sites actually utilize the full power of the transform versus utilizing the prefix based approach However there s a strong overlap between important sites and complex sites . Hence for a first approximation we might be able to get away with simply marking the RSE as doing the identity transform where the PFN is generated as SCHEMA HOSTNAME PORT PREFIX LFN E.g. no hash in the component this is because the CMS LFNs are of the form store generator  BprimeTToBZ    madgraph tauola GEN          and are already appropriately hashed. Proposed We ll likely need to modify the code here Expected behavior RSEs should be able to carry an attribute describing the LFN to PFN process they utilize. ", "336": "Some modules are not necessary in the clients and should be imported only if available or installed in the environment Define a list of extra packages check for their presence and import them if there Add a new exception missingModuleException and raise it from the method which can not worked with the missing module ", "331": "From the current contributing guide it s not clear that pull requests depending on their types should go against certain branches. In addition usual and popular pull request tools like the github interface and the hub wrapper are badly covered. Few corrections for the format of the pull requests Remind the logic for patch and feature pull requests Mention the github interface and the equivalent workflow with hub ", "330": "It seems that the only way to set distances between two RSEs is to directly manipulate the database or write a python script that can execute against Rucio s DB . I would expect this to be exposed via the typical REST API Python client API perhaps requiring a new permission to be created? rucio admin CLI. ", "329": "Documentation is still missing the JSON schema is not yet self explanatory. Add general documentation and link to the ATLAS specific parts on twiki. Also change the numbers in the JSON sample file to be more realistic for real use cases to reduce the possibility of confusion of units and extend the schema file with a short description of the fields. Expected behavior Users new to this hopefully get their questions answered . This is handled in PR  . ", "327": "Currently the only way to explicitly manage protocols is to write some python code. Example Now eventually CMS or ATLAS sized VOs will probably want to use an external service such as AGIS to maintain this information. However during the evaluation phase or even steady state for VOs with a modest number of endpoints it d be really beneficial to have this piece of the API wrapped in the CLI. ", "325": "Bash completion e.g. hitting tab provides a powerful way to improve the the user experience. With argcomplete most of the static suggestions are present. However dynamic items like rucio list rse attributes tab which should suggest available RSEs don t work. Let s add some smarter auto complete logic! ", "323": "Currently direct users of the rucio tools must setup the  USER PROXY environment variable and or set a line in their rucio.cfg . There are various standard ways to auto discover the proxy in the user s environment. Let s use them! ", "322": "When developing code it is much faster to just mount the modified code in the container for testing than to rebuild the container to test every change. x Remove source code from docker image in x bin x lib x tools x Provide docker compose manifest that launches dev environment in etc docker dev x Provide docker based pre commit hook x Document usage in etc docker dev README.md Expected behavior The developer may use docker compose with the manifest to launch dev container environment. The code may be tested in the container using docker exec . The pre commit hook runs pylint analysis in a container based on the dev image. ", "321": "Migrated from ", "320": "The closeness sorter module seems to be dead code. Confirm that it is dead and remove it from the package. ", "317": "Missing cx Oracle dependency in DockerFile Add cx Oracle ", "314": "Pin the dependency paramiko to version  for python  compatibility. ", "313": "Traceback most recent call last File opt rucio lib rucio daemons  nuclei background rebalance.py line  in module rebalance rse source rse rse max bytes available target rebalance volume dry run False comment Nuclei Background rebalancing force expression destination rse rse File usr lib  site packages rucio db sqla session.py line  in new funct result function args kwargs File usr lib  site packages rucio daemons  common.py line  in rebalance rse raise error rucio.common.exception.RSEBlacklisted RSE excluded due to write blacklisting. Details RSE excluded due to write blacklisting. Catch the exception properly ", "312": "The query against the locks takes too much time and Oracle fails with snapshot too old  Execution Summary Mode DECOMISSION Dry Run False scope name rule id bytes Gb target rse child rule id cx Oracle.DatabaseError ORA  snapshot too old rollback segment number  with name   too small SQL SELECT r.scope r.name rawtohex r.id as rule id r.rse expression as rse expression r.subscription id as subscription id  as bytes  as length FROM atlas rucio.rules r nWHERE nr.id IN SELECT rule id FROM atlas rucio.locks WHERE rse id atlas  rse GROUP BY rule id and nr.state O and nr.child rule id is NULL parameters rse xxxx Use some dumps on Hadoop. The dumps must be grouped by rule id rse and state ", "307": "", "298": "append a trailing slash if missing ", "288": "SAWarning Textual SQL expression mod abs x  rule id should be explicitly declared as text ", "285": "The kerberos packages are blocking the doc generation on buildthedocs Modify the main setup.py to not include kerberos packages by default but in extra requires Expected behavior Working documentation generation on buidthedocs ", "282": "Need to provide postgres support Include postgres client into the  docker image ", "281": "Express the recommended dependencies for the db backend Change of the main setup.py script to include extra dependencies Expected behavior pip install rucio oracle pip install rucio postgresql pip install rucio mysql or maybe define later some meta packages like rucio oracle with install requires rucio oracle ", "280": "All queries should be psql compatible now so travis can also test it now. ", "279": "If multiple tape replicas are available to the conveyor for sources the conveyor should select them based not only on distance but also on the sizes of the staging queues. Expected behavior  replicas same distance the one with less staging jobs in the queue should be used. ", "272": "Test if RSEs are properly configured for upload download of files using the rucio client e.g. for stageout stagein with the rucio sitemover in the pilot Add new nagios probe Expected behavior Loops over all protocols supported by target RSE Uses rucio client to upload and download a test file for each protocol Produces a report file in the format RSE action protocol result timestamp ", "265": "Currently there are two errors with postgressql which have to be fixed to make Rucio fully postgressql compatible. Expected behavior All tests run with postgressql. ", "262": "PostgreSQL is interpreting the SQL standard correctly it s actually Oracle and MySQL which are doing non standard things here. The problem you see is that for an outer join the nullable side cannot be locked for reading so PostgreSQL stops. This is the last outstanding issue for PostgreSQL compatibility. Changing the query for add rule from select outer join for update into something like select for update union select . Expected behavior add rule will work on PostgreSQL. ", "261": "In the XENON case we have an origin server from which the files are uploaded to the source RSE. The origin server and source RSE are the same server. Rather than doing a gfal copy it would be better to do a mv rsync of the data. Add a flag to rucio upload or check the origin hostname whether the start and endpoint are the same machine. ", "258": "The installation of the Oracle instantclient is not needed anymore in the docker build for travis and breaks the whole build. It needs to be removed Expected behavior ", "255": "There are some merge leftovers in the doc source conf.py file. ", "246": "The DB part is used in server daemons and UI image. Can be factorized by moving it to  image Move the DB part to  image ", "245": "Some pages in the RucioUI are experiment specific make the generation of pages more fine grained. When generating RucioUI pages automatically include exclude pages based on the defined policy e.g. only show ATLAS pages in ATLAS instance . ", "244": "rucio v add dataset user.briedel test test test lifetime         ERROR No JSON object could be decoded        ERROR Rucio exited with an unexpected unknown error. Please rerun the last command with the v option and submit a ticket with all the necessary information at        DEBUG Traceback most recent call last File usr bin rucio line  in new funct return function args kwargs File usr bin rucio line  in add dataset client.add dataset scope scope name name statuses monotonic args.monotonic lifetime args.lifetime File usr lib  site packages rucio client didclient.py line  in add dataset lifetime lifetime dids files rse rse File usr lib  site packages rucio client didclient.py line  in add did exc cls exc msg self. get exception headers r.headers status code r.status code data r.content File usr lib  site packages rucio client baseclient.py line  in get exception data parse response data File usr lib  site packages rucio common utils.py line  in parse response return json.loads data object hook datetime parser File usr   json init .py line  in loads return cls encoding encoding kw .decode s File usr   json decoder.py line  in decode obj end self.raw decode s idx w s  .end File usr   json decoder.py line  in raw decode raise ValueError No JSON object could be decoded ValueError No JSON object could be decoded Completed in  sec. ", "243": "We should replace by the github issue link in the client code        ERROR Rucio exited with an unexpected unknown error. Please rerun the last command with the v option and submit a ticket with all the necessary information at ", "242": "The CLI examples here no longer match the rucio client So far I ve found that add and list are no longer available replaced by more specific commands Expected behavior ", "237": "", "236": "Kronos already updates the accessed at of each file. Additionally it should also update the of accesses. ", "235": "The AGIS probe doesn t remove manually added protocols in AGIS. It can lead to inconsistencies. AGIS probe will remove manually added protocols in Rucio ", "232": "get submitted at rucio function in forecast.py extension is buggy. The function have access to rucio database but the query is tricky and need testing on production to see if the time to retrieve the submitted at time stamps for a link in not an overkill. Expected behavior Should return an array on time stamps ordered descendent the oldest one at the end . ", "227": "It is not needed and crashes the setup procedure. ", "214": "Some packages appear several times in the various pip requires files. ", "213": "Script which uses the github api to compile release notes based on milestones. ", "211": "When the pilot uses the rucio mover the traces are sent out as type download and with the account pilot . This messes up the monitoring in the as they will show up as CLI download in the Dashboard and we are also losing the user information. Add two new paramters the rucio download cli command usrdn and eventType which will then be propagated to the traces. Expected behavior ", "209": "The current command to get the list of changed files for a PR which was originally taken from the old build bot script does not work with the travis workflow and has to be fixed. Expected behavior ", "205": "Minor cleanups in the repo. ", "204": "The schema.sql file is full of ATLER table statements instead of fully correct table signatures. The signatures must be corrected and the alter table statements removed. ", "199": "The probe only checks if an account has quota on some SCRATCHDISK thus for old accounts they will never get quota on new scratchdisks. This has to be changed to actually check each quota specifically. ", "196": "If a dataset is touched before the end of it s lifetime the lifetime is not extended Increase lifetime to last access extension ", "195": "", "192": "As per request from Yun Ha the updated at timestamp was added to the consistency datasets dump. The dumps description page in the WebUI now needs to be updated accordingly. Expected behavior ", "191": "The CLI command rucio list account usage does not return any output. ", "187": "", "185": "", "177": "When the dataset name is part of the file name the parse pfns method for gfal Maybe also for other protocols creates a faulty path. Fix the parse pfns method so it does not create a faulty path. ", "174": "Remove JIRA syntax from prepare commit msg ", "171": "from rucio.rse import rsemanager as rsemgr rse info rsemgr.get rse info MOCK proto rsemgr.create protocol rse info write proto.parse pfns srm locahost  srm  pnfs data atlas atlasgrouptape group phys higgs   group.phys    yt     yt   srm locahost  srm  pnfs data atlas atlasgrouptape group phys higgs   group.phys    yt     yt   name u   yt   hostname locahos prefix u pnfs data atlas atlasgrouptape path u group phys higgs   group.phys   scheme srm web service path srm  port  Expected behavior   vs.    ", "168": "If for one RSE no protocol is defined the get space throws an exception Traceback most recent call last File usr rucio tools probes common check storage space line  in module retvalue get space rsename protocol srm client CLIENT File usr rucio tools probes common check storage space line  in get space print Update RSE s space usage usedsize s freesize s rsename usedsize freesize UnboundLocalError local variable usedsize referenced before assignment Only set the usedsize if protocol is defined ", "165": "setup.py file is needed in the repo for readthedocs. Copy the setup rucio.py to setup.py and have both as duplicates ", "158": "The  command used in travis is currently wrong and excludes everything. Currently  ignore  exclude .cfg bin lib tools .py tools probes common But it should be  ignore  exclude .cfg bin lib tools .py tools probes common ", "155": "There are several  errors both on master and next which need to be fixed.  ignore  exclude .cfg bin lib tools .py tools probes common ", "148": "In the manual fix of the next branch of the repo some alembic migrate repo files are missing. Add the missing files. ", "145": "The changes in schema.sql and a alembic upgrade file is missing for the identity length changes for identity account map and tokens table. ", "142": "When the last file in a dataset is removed by the reaper the reaper also tries to delete the dataset. However in certain cases it can happen that there is a SUSPENDED Waitint for approval rule with  locks on the dataset thus the deletion always fails with a child constraint error from the database. The reaper should check for rules when it is deleting the dataset and remove them in case there are any. ", "141": "Provide Dockerfiles to create container Provide Dockerfiles to create container ", "140": "Cloud storage solutions have opted to use  to verify file integrity. To support cloud storage and ensuring file integrity the  digests of files added to the data catalogue should be computed. x Client computes  checksum on file upload and adds this to the file metadata x Client download checks the file  or  against the metadata preference of  Expected behavior The  field of the file metadata in the Rucio database will be filled with the  digest of the file for new files. ", "137": "In the get possible protocols call the filtering tbr of protocols removes too many protocols as the list is essentially done twice per domain and it looks like more is removed than is there thus an exception is raised. Make proper filtering. Split the candidates in two lists per domain and do the filtering smarter. Expected behavior Exception should not be raised. ", "136": "Add  method to extract  checksum from files ported back from gitlab next ", "133": "The idea is basically the same principle as with  A specific rule should be moved to another RSE including all it s properties. Migrated from ", "123": "configure git.sh still points to gitlab Move to github ", "122": "The partitioning in atropos is broken. The atropos workers ask for a partition before all the workers are started Introduce a sleep before starting the main loop ", "121": "For the lifetime model it would be good to expose simply who account uses a dataset did and the last time of access. Another requirement is to provide a way for users to express their interest for DIDs and use it wrt to the lifetime model and the list of future deleted data. Extend models with two tables. consumers leechers scope name account created at updated at hits to keep track of the number of access the first access and last access for an account to a specific dataset. Populated from the traces. core only needed. followers scope name account created at updated at expired at to keep track of people interest for a dataset. This will need clients rest core. ", "119": "Our setup.py files normally read the version information from the git tag with github this does not work anymore as github does not use annotated tags. Change setup .py files to remove the version generation and just use the version mentioned in the vcsversion.py file. ", "116": "Sometimes datasets are resurrected which are already expired but not deleted yet. In this case the call does not do anything and the dataset will be deleted at a later point in time. Change resurrect method to remove expiration date of dataset. ", "113": "Sometimes it happens that the origin branches are a bit out of sync with the upstream. In these cases just rebasing upstream what the script does now will not make the situation better instead it should make a full reset against upstream those making the origin upstream the same. ", "109": "Github allows to define issue template and pull request template in the repo ", "106": "", "104": "Add a new state to reflect that a dataset did can be INCOMPLETE on the system. At least one file of the content not there ", "101": "Pre filling the version file. ", "98": "Some minor fixes and links are not written consistently sometimes URL sometimes names ", "91": "", "86": "Migrated from JIRA ", "85": "Migrated from JIRA ", "84": "Migrated from JIRA ", "83": "if there are  tickets in the user environment then root server will automatically prefer this. can be circumvented by setting export XrdSecPROTOCOL gsi Migrated from JIRA ", "82": "When upload multiple files if the number of file is too much so that cause error like database too many connections or database deadlock for MySQL server or can not allocate memory on server . Some upload process may be interrupted at the middle leaving some DIDs without rule. If one want to delete these DIDs one will fail because rucio undertaker give replicas tombstone when deleting rules opt rucio lib rucio core did.py  delete dids rucio.core.rule.delete rule rule id rule id purge replicas purge replicas delete parent True nowait True session session But if a DID does not have a rule rucio undertaker will go to opt rucio lib rucio core did.py  delete dids if file clause rowcount session.query models.DataIdentifier .filter or file clause . filter models.DataIdentifier.did type DIDType.FILE . update expired at None synchronize session False and only reset expired at to None. As a result one can not delete these DIDs. Migrated from JIRA ", "81": "Migrated from JIRA ", "80": "Migrated from JIRA ", "79": "T\u00b3C service for transfer time to complete prediction. ToDo Rucio DB access to retrieve the submitted at for all the active transfers for a src dst act link. Migrated from JIRA ", "78": "Migrated from JIRA ", "77": "Hi I find a import problems about opt rucio lib rucio tests test lifetime.py This test will send request to trigger lib rucio web rest lifetime exception.py but it seems a circular import occurs in this .py ? .venv root rucio  rucio python i lib rucio web rest lifetime exception.py Traceback most recent call last File lib rucio web rest lifetime exception.py line  in module from rucio.api.lifetime exception import list exceptions add exception update exception File opt rucio lib rucio api lifetime exception.py line  in module from rucio.core import lifetime exception File opt rucio lib rucio core lifetime exception.py line  in module import rucio.common.policy File opt rucio lib rucio common policy.py line  in module import rucio.core.did File opt rucio lib rucio core did.py line  in module import rucio.core.rule File opt rucio lib rucio core rule.py line  in module import rucio.core.lock import get replica locks get files and replica locks of dataset File opt rucio lib rucio core lock.py line  in module from rucio.core.lifetime exception import define eol ImportError cannot import name define eol In python shell import rucio.core.lifetime exception Traceback most recent call last File stdin line  in module File opt rucio lib rucio core lifetime exception.py line  in module import rucio.common.policy File opt rucio lib rucio common policy.py line  in module import rucio.core.did File opt rucio lib rucio core did.py line  in module import rucio.core.rule File opt rucio lib rucio core rule.py line  in module import rucio.core.lock import get replica locks get files and replica locks of dataset File opt rucio lib rucio core lock.py line  in module from rucio.core.lifetime exception import define eol ImportError cannot import name define eol Best RegardEdward Wu ASGC Migrated from JIRA ", "76": "        CRITICAL Traceback most recent call last File usr lib  site packages rucio daemons judge injector.py line  in rule injector inject rule rule id rule id File usr lib  site packages rucio db sqla session.py line  in new funct result function args kwargs File usr lib  site packages rucio core rule.py line  in inject rule session session File usr lib  site packages rucio db sqla session.py line  in new funct result function args kwargs File usr lib  site packages rucio core rule.py line  in create locks replicas transfers session session File usr lib  site packages rucio db sqla session.py line  in new funct result function args kwargs File usr lib  site packages rucio core rule grouping.py line  in apply rule grouping session session File usr lib  site packages rucio db sqla session.py line  in new funct result function args kwargs File usr lib  site packages rucio core rule grouping.py line  in apply rule to files dataset grouping prioritize order over weight True File usr lib  site packages rucio core rse selector.py line  in select rse raise InsufficientAccountLimit There is insufficient quota on any of the target RSE s to fullfill the operation. InsufficientAccountLimit There is not enough quota left to fulfil the operation. Details There is insufficient quota on any of the target RSE s to fullfill the operation. Migrated from JIRA ", "75": "Migrated from JIRA ", "74": "Migrated from JIRA ", "73": "Migrated from JIRA ", "72": "Migrated from JIRA ", "71": "Migrated from JIRA ", "70": "Do we need two different messages? One for Dataset one for Container or is the same one sufficient? Migrated from JIRA ", "69": "Decide on Message format for ActiveMQ Message to AMI  Schema change for database to add Partially Available Imcomplete to state column Setting dataset container state to PA and send message to AMI when first file gets deleted in Dataset  Migrated from JIRA ", "68": "Existed in PandaQueues as WAN sink limits. We need a new way to do this in DDM. Migrated from JIRA ", "67": "Tracking ticket for  migration x Clients  x Daemons  x Server x REST API  x Core  ", "66": "Migrated from JIRA ", "65": "In the code it seems like this is not properly implemented. Migrated from JIRA ", "64": "For local usage a combination of wan lan attributes with rse expressions will provide the local or remote replicas to a site. added lan wan in list replicas clients rest server . default wan ", "63": "x Poller x Submitter Migrated from JIRA ", "62": "The idea is to add the domain to all method signatures so that clients conveyor can specify which domain should be used to create protocols pathes. x First iteration Add domain to method signature without implementing any functionality yet. x Second iteration The right output is generated depending on domain input. If no domain is given wan is used if wan does not exist lan is used x Third iteration Client Conveyor have to call the methods with the right domain. Migrated from JIRA ", "61": "If the src rse id is pre filled the throttler can release requests based on links and not only based on destination. Migrated from JIRA ", "60": "Set the expiration date of the rule to  in the future if the child rule is not OK yet so that there is no jam of rules in front of the queue. Migrated from JIRA ", "59": "Migrated from JIRA ", "58": "Migrated from JIRA ", "56": "Hermes does not protect against double selection of messages specifically in a phase where the partitions are not well established yet e.g. during a restart. It does retrieve the messages with a SELECT FOR UPDATE but the retrieval only takes ms and after that the row locks are given up. For it to be effective the locks have to be held until the message is removed from the table. This might not be a good idea to do. One possible solution would be to have an additional state column and the retrieve message function SELECTS the messages with for update and updates their state to SUBMITTING. In subsequent retrieve calls only messages in state WAITING or which are in the SUBMITTING state for more than  are selected. To be discussed. Migrated from JIRA ", "55": "Migrated from JIRA ", "52": "Migrated from JIRA ", "51": "Based on fts RSE attribute fts Migrated from JIRA ", "50": "Migrated from JIRA ", "49": "Migrated from JIRA ", "48": "When inserting messages to hermes which are too long this throws a DB exception DatabaseException raised as a result of Query invoked autoflush consider using a session.no autoflush block if this flush is occurring prematurely cx Oracle.DatabaseError ORA  can bind a LONG value only for insert into a LONG column SQL INSERT INTO atlas rucio.messages id event type payload updated at created at VALUES id event type payload updated at created at parameters id created at datetime.datetime        event type email updated at datetime.datetime        payload body A new rule has been requested for approval in Rucio. n nRule description n n ID   characters truncated TED MESSAG n to damian.alvarez.piqueras cern.ch subject RUCIO Request to approve replication rule  We have to look into if we can update the DB to allow longer messages but in anyway hermes should protect against this. Migrated from JIRA ", "47": "  PM Traceback most recent call last File usr lib  site packages rucio rse protocols  line  in connect calling format OrdinaryCallingFormat File usr lib  site packages boto init.py line  in connect  return  aws access key id aws secret access key kwargs File usr lib  site packages boto  connection.py line  in init validate certs validate certs profile name profile name File usr lib  site packages boto connection.py line  in init host config self.provider self. required auth capability File usr lib  site packages boto auth.py line  in get auth handler ready handlers.append handler host config provider File usr lib  site packages boto auth.py line  in init HmacKeys.init self host config provider File usr lib  site packages boto auth.py line  in init self.update provider provider File usr lib  site packages boto auth.py line  in update provider super  self .update provider provider File usr lib  site packages boto auth.py line  in update provider self. hmac hmac.new self. provider.secret key.encode utf  AttributeError tuple object has no attribute encode Migrated from JIRA ", "46": "Add a flag extract which will automatically extract compressed files. To be precise This should download a full zip file and extract a specific file needed from that archive. Migrated from JIRA ", "45": "ntplib etc Migrated from JIRA ", "44": "Hello I m the current DAST shifter and a user reported that hitting the Check quota button on  hangs forever. I checked with firefox  on ubuntu  and I have the same problem. The debug console points to a java script error option.errors s not a function . Laurent Migrated from JIRA ", "42": "It would be very convenient for this command to declare all replicas of the files lost dcameron  rucio admin replicas declare bad reason bad guid metadata         No JSON object could be decoded Rucio exited with an unexpected unknown error please provide the traceback below to the developers. Traceback most recent call last File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  bin rucio admin line  in new funct return function args kwargs File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  bin rucio admin line  in declare bad file replicas non declared client.declare bad file replicas pfns chunk reason args.reason File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  lib  site packages rucio client replicaclient.py line  in declare bad file replicas exc cls exc msg self. get exception headers r.headers status code r.status code data r.content File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  lib  site packages rucio client baseclient.py line  in get exception data parse response data File cvmfs atlas.cern.ch repo ATLASLocalRootBase   rucio clients  lib  site packages rucio common utils.py line  in parse response return json.loads data object hook datetime parser File usr   json init .py line  in loads return cls encoding encoding kw .decode s File usr   json decoder.py line  in decode obj end self.raw decode s idx w s  .end File usr   json decoder.py line  in raw decode raise ValueError No JSON object could be decoded ValueError No JSON object could be decoded At least a proper error message should be returned instead of a stacktrace. Migrated from JIRA ", "41": "Migrated from JIRA ", "40": "Migrated from JIRA ", "39": "Migrated from JIRA ", "37": "When the latest replica eligible for deletion is removed the file is removed from the content but not archived. Migrated from JIRA ", "34": "The documentation on the CLI needs to be updated e.g. Download specific files from a dataset This operation is still not supported by rucio but will be available soon. Download a sample of n random files from a dataset This operation is still not supported by rucio but will be available soon. Migrated from JIRA ", "30": "Migrated from JIRA ", "29": "Migrated from JIRA ", "28": "Migrated from JIRA ", "27": "Migrated from JIRA ", "26": "We need a protection for deleting a RSE. In particular it should fail if some rules collection replicas exist. Migrated from JIRA ", "23": "Lots of sites already support WebDAV downloads so it would be a nice feature if we would have download directly from the WebUI. So when users list the files in a dataset their can just click a button and the files one file would be directly downloaded to their machine. Migrated from JIRA ", "8": "We need a new submission script for pull requests on github. ", "5": "test! "}